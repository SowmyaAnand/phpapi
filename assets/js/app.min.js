var JSON;!function(){var s=!1,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(e){var n=this.prototype;s=!0;var t=new this;for(var i in s=!1,e)t[i]="function"==typeof e[i]&&"function"==typeof n[i]&&r.test(e[i])?function(i,a){return function(){var e=this._super;this._super=n[i];var t=a.apply(this,arguments);return this._super=e,t}}(i,e[i]):e[i];function a(){!s&&this.init&&this.init.apply(this,arguments)}return((a.prototype=t).constructor=a).extend=arguments.callee,a}}(),JSON||(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,a,n,s,r,o=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,i=0;i<s;i+=1)r[i]=str(i,l)||"null";return n=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+o+"]":"["+r.join(",")+"]",gap=o,n}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(n=str(a=rep[i],l))&&r.push(quote(a)+(gap?": ":":")+n);else for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(n=str(a,l))&&r.push(quote(a)+(gap?": ":":")+n);return n=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+o+"}":"{"+r.join(",")+"}",gap=o,n}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var a;if(indent=gap="","number"==typeof i)for(a=0;a<i;a+=1)indent+=" ";else"string"==typeof i&&(indent=i);if((rep=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var i,a,n=e[t];if(n&&"object"==typeof n)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(void 0!==(a=walk(n,i))?n[i]=a:delete n[i]);return reviver.call(e,t,n)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var i;if("object"==typeof exports){try{i=require("moment")}catch(e){}module.exports=t(i)}else"function"==typeof define&&define.amd?define(function(e){try{i=e("moment")}catch(e){}return t(i)}):e.Pikaday=t(e.moment)}(this,function(s){"use strict";var r="function"==typeof s,o=!!window.addEventListener,h=window.document,p=window.setTimeout,l=function(e,t,i,a){o?e.addEventListener(t,i,!!a):e.attachEvent("on"+t,i)},a=function(e,t,i,a){o?e.removeEventListener(t,i,!!a):e.detachEvent("on"+t,i)},n=function(e,t,i){var a;h.createEvent?((a=h.createEvent("HTMLEvents")).initEvent(t,!0,!1),a=u(a,i),e.dispatchEvent(a)):h.createEventObject&&(a=h.createEventObject(),a=u(a,i),e.fireEvent("on"+t,a))},c=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},v=function(e){return/Array/.test(Object.prototype.toString.call(e))},$=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},E=function(e,t){return[31,(i=e,i%4==0&&i%100!=0||i%400==0?29:28),31,30,31,30,31,31,30,31,30,31][t];var i},O=function(e){$(e)&&e.setHours(0,0,0,0)},I=function(e,t){return e.getTime()===t.getTime()},u=function(e,t,i){var a,n;for(a in t)(n=void 0!==e[a])&&"object"==typeof t[a]&&null!==t[a]&&void 0===t[a].nodeName?$(t[a])?i&&(e[a]=new Date(t[a].getTime())):v(t[a])?i&&(e[a]=t[a].slice(0)):e[a]=u({},t[a],i):!i&&n||(e[a]=t[a]);return e},t=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),11<e.month&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},d={field:null,bound:void 0,position:"bottom left",reposition:!0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,formatStrict:!1,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,showDaysInNextAndPreviousMonths:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,onSelect:null,onOpen:null,onClose:null,onDraw:null},f=function(e,t,i){for(t+=e.firstDay;7<=t;)t-=7;return i?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},U=function(e){var t=[],i="false";if(e.isEmpty){if(!e.showDaysInNextAndPreviousMonths)return'<td class="is-empty"></td>';t.push("is-outside-current-month")}return e.isDisabled&&t.push("is-disabled"),e.isToday&&t.push("is-today"),e.isSelected&&(t.push("is-selected"),i="true"),e.isInRange&&t.push("is-inrange"),e.isStartRange&&t.push("is-startrange"),e.isEndRange&&t.push("is-endrange"),'<td data-day="'+e.day+'" class="'+t.join(" ")+'" aria-selected="'+i+'"><button class="pika-button pika-day" type="button" data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button></td>"},g=function(e,t,i,a,n,s){var r,o,l,p,h,c=e._o,u=i===c.minYear,d=i===c.maxYear,f='<div id="'+s+'" class="pika-title" role="heading" aria-live="assertive">',g=!0,m=!0;for(l=[],r=0;r<12;r++)l.push('<option value="'+(i===n?r-t:12+r-t)+'"'+(r===a?' selected="selected"':"")+(u&&r<c.minMonth||d&&r>c.maxMonth?'disabled="disabled"':"")+">"+c.i18n.months[r]+"</option>");for(p='<div class="pika-label">'+c.i18n.months[a]+'<select class="pika-select pika-select-month" tabindex="-1">'+l.join("")+"</select></div>",v(c.yearRange)?(r=c.yearRange[0],o=c.yearRange[1]+1):(r=i-c.yearRange,o=1+i+c.yearRange),l=[];r<o&&r<=c.maxYear;r++)r>=c.minYear&&l.push('<option value="'+r+'"'+(r===i?' selected="selected"':"")+">"+r+"</option>");return h='<div class="pika-label">'+i+c.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+l.join("")+"</select></div>",c.showMonthAfterYear?f+=h+p:f+=p+h,u&&(0===a||c.minMonth>=a)&&(g=!1),d&&(11===a||c.maxMonth<=a)&&(m=!1),0===t&&(f+='<button class="pika-prev'+(g?"":" is-disabled")+'" type="button">'+c.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(f+='<button class="pika-next'+(m?"":" is-disabled")+'" type="button">'+c.i18n.nextMonth+"</button>"),f+"</div>"},N=function(e,t,i){return'<table cellpadding="0" cellspacing="0" class="pika-table" role="grid" aria-labelledby="'+i+'">'+function(e){var t,i=[];for(e.showWeekNumber&&i.push("<th></th>"),t=0;t<7;t++)i.push('<th scope="col"><abbr title="'+f(e,t)+'">'+f(e,t,!0)+"</abbr></th>");return"<thead><tr>"+(e.isRTL?i.reverse():i).join("")+"</tr></thead>"}(e)+("<tbody>"+t.join("")+"</tbody>")+"</table>"},e=function(e){var a=this,n=a.config(e);a._onMouseDown=function(e){if(a._v){var t=(e=e||window.event).target||e.srcElement;if(t)if(c(t,"is-disabled")||(!c(t,"pika-button")||c(t,"is-empty")||c(t.parentNode,"is-disabled")?c(t,"pika-prev")?a.prevMonth():c(t,"pika-next")&&a.nextMonth():(a.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),n.bound&&p(function(){a.hide(),n.field&&n.field.blur()},100))),c(t,"pika-select"))a._c=!0;else{if(!e.preventDefault)return e.returnValue=!1;e.preventDefault()}}},a._onChange=function(e){var t=(e=e||window.event).target||e.srcElement;t&&(c(t,"pika-select-month")?a.gotoMonth(t.value):c(t,"pika-select-year")&&a.gotoYear(t.value))},a._onKeyChange=function(e){if(e=e||window.event,a.isVisible())switch(e.keyCode){case 13:case 27:n.field.blur();break;case 37:e.preventDefault(),a.adjustDate("subtract",1);break;case 38:a.adjustDate("subtract",7);break;case 39:a.adjustDate("add",1);break;case 40:a.adjustDate("add",7)}},a._onInputChange=function(e){var t;e.firedBy!==a&&(t=r?(t=s(n.field.value,n.format,n.formatStrict))&&t.isValid()?t.toDate():null:new Date(Date.parse(n.field.value)),$(t)&&a.setDate(t),a._v||a.show())},a._onInputFocus=function(){a.show()},a._onInputClick=function(){a.show()},a._onInputBlur=function(){var e=h.activeElement;do{if(c(e,"pika-single"))return}while(e=e.parentNode);a._c||(a._b=p(function(){a.hide()},50)),a._c=!1},a._onClick=function(e){var t=(e=e||window.event).target||e.srcElement,i=t;if(t){!o&&c(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),l(t,"change",a._onChange)));do{if(c(i,"pika-single")||i===n.trigger)return}while(i=i.parentNode);a._v&&t!==n.trigger&&i!==n.trigger&&a.hide()}},a.el=h.createElement("div"),a.el.className="pika-single"+(n.isRTL?" is-rtl":"")+(n.theme?" "+n.theme:""),l(a.el,"mousedown",a._onMouseDown,!0),l(a.el,"touchend",a._onMouseDown,!0),l(a.el,"change",a._onChange),l(h,"keydown",a._onKeyChange),n.field&&(n.container?n.container.appendChild(a.el):n.bound?h.body.appendChild(a.el):n.field.parentNode.insertBefore(a.el,n.field.nextSibling),l(n.field,"change",a._onInputChange),n.defaultDate||(r&&n.field.value?n.defaultDate=s(n.field.value,n.format).toDate():n.defaultDate=new Date(Date.parse(n.field.value)),n.setDefaultDate=!0));var t=n.defaultDate;$(t)?n.setDefaultDate?a.setDate(t,!0):a.gotoDate(t):a.gotoDate(new Date),n.bound?(this.hide(),a.el.className+=" is-bound",l(n.trigger,"click",a._onInputClick),l(n.trigger,"focus",a._onInputFocus),l(n.trigger,"blur",a._onInputBlur)):this.show()};return e.prototype={config:function(e){this._o||(this._o=u({},d,!0));var t=u(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.theme="string"==typeof t.theme&&t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"==typeof t.disableDayFn?t.disableDayFn:null;var i=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=4<i?4:i,$(t.minDate)||(t.minDate=!1),$(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&this.setMaxDate(t.maxDate),v(t.yearRange)){var a=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||a,t.yearRange[1]=parseInt(t.yearRange[1],10)||a}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||d.yearRange,100<t.yearRange&&(t.yearRange=100);return t},toString:function(e){return $(this._d)?r?s(this._d).format(e||this._o.format):this._d.toDateString():""},getMoment:function(){return r?s(this._d):null},setMoment:function(e,t){r&&s.isMoment(e)&&this.setDate(e.toDate(),t)},getDate:function(){return $(this._d)?new Date(this._d.getTime()):new Date},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",n(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),$(e)){var i=this._o.minDate,a=this._o.maxDate;$(i)&&e<i?e=i:$(a)&&a<e&&(e=a),this._d=new Date(e.getTime()),O(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),n(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if($(e)){if(this.calendars){var i=new Date(this.calendars[0].year,this.calendars[0].month,1),a=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),n=e.getTime();a.setMonth(a.getMonth()+1),a.setDate(a.getDate()-1),t=n<i.getTime()||a.getTime()<n}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustDate:function(e,t){var i,a=this.getDate(),n=24*parseInt(t)*60*60*1e3;"add"===e?i=new Date(a.valueOf()+n):"subtract"===e&&(i=new Date(a.valueOf()-n)),r&&("add"===e?i=s(a).add(t,"days").toDate():"subtract"===e&&(i=s(a).subtract(t,"days").toDate())),this.setDate(i)},adjustCalendars:function(){this.calendars[0]=t(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=t({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){e instanceof Date?(O(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth()):(this._o.minDate=d.minDate,this._o.minYear=d.minYear,this._o.minMonth=d.minMonth,this._o.startRange=d.startRange),this.draw()},setMaxDate:function(e){e instanceof Date?(O(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth()):(this._o.maxDate=d.maxDate,this._o.maxYear=d.maxYear,this._o.maxMonth=d.maxMonth,this._o.endRange=d.endRange),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){if(this._v||e){var t,i=this._o,a=i.minYear,n=i.maxYear,s=i.minMonth,r=i.maxMonth,o="";this._y<=a&&(this._y=a,!isNaN(s)&&this._m<s&&(this._m=s)),this._y>=n&&(this._y=n,!isNaN(r)&&this._m>r&&(this._m=r)),t="pika-title-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,2);for(var l=0;l<i.numberOfMonths;l++)o+='<div class="pika-lendar">'+g(this,l,this.calendars[l].year,this.calendars[l].month,this.calendars[0].year,t)+this.render(this.calendars[l].year,this.calendars[l].month,t)+"</div>";this.el.innerHTML=o,i.bound&&"hidden"!==i.field.type&&p(function(){i.trigger.focus()},1),"function"==typeof this._o.onDraw&&this._o.onDraw(this),i.bound&&i.field.setAttribute("aria-label","Use the arrow keys to pick a date")}},adjustPosition:function(){var e,t,i,a,n,s,r,o,l,p;if(!this._o.container){if(this.el.style.position="absolute",t=e=this._o.trigger,i=this.el.offsetWidth,a=this.el.offsetHeight,n=window.innerWidth||h.documentElement.clientWidth,s=window.innerHeight||h.documentElement.clientHeight,r=window.pageYOffset||h.body.scrollTop||h.documentElement.scrollTop,"function"==typeof e.getBoundingClientRect)o=(p=e.getBoundingClientRect()).left+window.pageXOffset,l=p.bottom+window.pageYOffset;else for(o=t.offsetLeft,l=t.offsetTop+t.offsetHeight;t=t.offsetParent;)o+=t.offsetLeft,l+=t.offsetTop;(this._o.reposition&&n<o+i||-1<this._o.position.indexOf("right")&&0<o-i+e.offsetWidth)&&(o=o-i+e.offsetWidth),(this._o.reposition&&s+r<l+a||-1<this._o.position.indexOf("top")&&0<l-a-e.offsetHeight)&&(l=l-a-e.offsetHeight),this.el.style.left=o+"px",this.el.style.top=l+"px"}},render:function(e,t,i){var a=this._o,n=new Date,s=E(e,t),r=new Date(e,t,1).getDay(),o=[],l=[];O(n),0<a.firstDay&&(r-=a.firstDay)<0&&(r+=7);for(var p,h,c,u,d,f,g=0===t?11:t-1,m=11===t?0:t+1,v=0===t?e-1:e,y=11===t?e+1:e,_=E(v,g),b=s+r,w=b;7<w;)w-=7;b+=7-w;for(var P=0,C=0;P<b;P++){var x=new Date(e,t,P-r+1),F=!!$(this._d)&&I(x,this._d),k=I(x,n),S=P<r||s+r<=P,T=P-r+1,M=t,A=e,D=a.startRange&&I(a.startRange,x),R=a.endRange&&I(a.endRange,x),L=a.startRange&&a.endRange&&a.startRange<x&&x<a.endRange;S&&(P<r?(T=_+T,M=g,A=v):(T-=s,M=m,A=y));var V={day:T,month:M,year:A,isSelected:F,isToday:k,isDisabled:a.minDate&&x<a.minDate||a.maxDate&&x>a.maxDate||a.disableWeekends&&(void 0,0===(f=x.getDay())||6===f)||a.disableDayFn&&a.disableDayFn(x),isEmpty:S,isStartRange:D,isEndRange:R,isInRange:L,showDaysInNextAndPreviousMonths:a.showDaysInNextAndPreviousMonths};l.push(U(V)),7==++C&&(a.showWeekNumber&&l.unshift((h=P-r,c=t,u=e,d=void 0,d=new Date(u,0,1),'<td class="pika-week">'+Math.ceil(((new Date(u,c,h)-d)/864e5+d.getDay()+1)/7)+"</td>")),o.push((p=l,"<tr>"+(a.isRTL?p.reverse():p).join("")+"</tr>")),l=[],C=0)}return N(a,o,i)},isVisible:function(){return this._v},show:function(){var e,t,i;this.isVisible()||(e=this.el,t="is-hidden",e.className=(i=(" "+e.className+" ").replace(" "+t+" "," ")).trim?i.trim():i.replace(/^\s+|\s+$/g,""),this._v=!0,this.draw(),this._o.bound&&(l(h,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e,t,i=this._v;!1!==i&&(this._o.bound&&a(h,"click",this._onClick),this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto",e=this.el,c(e,t="is-hidden")||(e.className=""===e.className?t:e.className+" "+t),this._v=!1,void 0!==i&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),a(this.el,"mousedown",this._onMouseDown,!0),a(this.el,"touchend",this._onMouseDown,!0),a(this.el,"change",this._onChange),this._o.field&&(a(this._o.field,"change",this._onInputChange),this._o.bound&&(a(this._o.trigger,"click",this._onInputClick),a(this._o.trigger,"focus",this._onInputFocus),a(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},e}),function(e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():window.noUiSlider=e()}(function(){"use strict";function K(e,t){var i=document.createElement("div");return q(i,t),e.appendChild(i),i}function n(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function B(e,t,i){0<i&&(q(e,t),setTimeout(function(){j(e,t)},i))}function H(e){return Array.isArray(e)?e:[e]}function t(e){var t=(e=String(e)).split(".");return 1<t.length?t[1].length:0}function q(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function j(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function z(){var e=void 0!==window.pageXOffset,t="CSS1Compat"===(document.compatMode||"");return{x:e?window.pageXOffset:t?document.documentElement.scrollLeft:document.body.scrollLeft,y:e?window.pageYOffset:t?document.documentElement.scrollTop:document.body.scrollTop}}function h(e,t){return 100/(t-e)}function c(e,t){return 100*t/(e[1]-e[0])}function u(e,t){for(var i=1;e>=t[i];)i+=1;return i}function i(e,t,i){if(i>=e.slice(-1)[0])return 100;var a,n,s,r,o,l,p=u(i,e);return a=e[p-1],n=e[p],s=t[p-1],r=t[p],s+(l=i,c(o=[a,n],o[0]<0?l+Math.abs(o[0]):l-o[0])/h(s,r))}function a(e,t,i,a){if(100===a)return a;var n,s,r,o,l=u(a,e);return i?(n=e[l-1],((s=e[l])-n)/2<a-n?s:n):t[l-1]?e[l-1]+(r=a-e[l-1],o=t[l-1],Math.round(r/o)*o):a}function r(e,t,i){var a;if("number"==typeof t&&(t=[t]),"[object Array]"!==Object.prototype.toString.call(t))throw new Error("noUiSlider: 'range' contains invalid value.");if(!n(a="min"===e?0:"max"===e?100:parseFloat(e))||!n(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");i.xPct.push(a),i.xVal.push(t[0]),a?i.xSteps.push(!isNaN(t[1])&&t[1]):isNaN(t[1])||(i.xSteps[0]=t[1]),i.xHighestCompleteStep.push(0)}function o(e,t,i){if(!t)return!0;i.xSteps[e]=c([i.xVal[e],i.xVal[e+1]],t)/h(i.xPct[e],i.xPct[e+1]);var a=(i.xVal[e+1]-i.xVal[e])/i.xNumSteps[e],n=Math.ceil(Number(a.toFixed(3))-1),s=i.xVal[e]+i.xNumSteps[e]*n;i.xHighestCompleteStep[e]=s}function s(e,t,i,a){this.xPct=[],this.xVal=[],this.xSteps=[a||!1],this.xNumSteps=[!1],this.xHighestCompleteStep=[],this.snap=t,this.direction=i;var n,s=[];for(n in e)e.hasOwnProperty(n)&&s.push([e[n],n]);for(s.length&&"object"==typeof s[0][0]?s.sort(function(e,t){return e[0][0]-t[0][0]}):s.sort(function(e,t){return e[0]-t[0]}),n=0;n<s.length;n++)r(s[n][1],s[n][0],this);for(this.xNumSteps=this.xSteps.slice(0),n=0;n<this.xNumSteps.length;n++)o(n,this.xNumSteps[n],this)}s.prototype.getMargin=function(e){var t=this.xNumSteps[0];if(t&&e%t)throw new Error("noUiSlider: 'limit' and 'margin' must be divisible by step.");return 2===this.xPct.length&&c(this.xVal,e)},s.prototype.toStepping=function(e){return e=i(this.xVal,this.xPct,e)},s.prototype.fromStepping=function(e){return function(e,t,i){if(100<=i)return e.slice(-1)[0];var a,n,s,r,o,l=u(i,t);return a=e[l-1],n=e[l],s=t[l-1],r=t[l],o=[a,n],(i-s)*h(s,r)*(o[1]-o[0])/100+o[0]}(this.xVal,this.xPct,e)},s.prototype.getStep=function(e){return e=a(this.xPct,this.xSteps,this.snap,e)},s.prototype.getNearbySteps=function(e){var t=u(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t-0],step:this.xNumSteps[t-0],highestStep:this.xHighestCompleteStep[t-0]}}},s.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(t);return Math.max.apply(null,e)},s.prototype.convert=function(e){return this.getStep(this.toStepping(e))};var l={to:function(e){return void 0!==e&&e.toFixed(2)},from:Number};function p(e,t){if(!n(t))throw new Error("noUiSlider: 'step' is not numeric.");e.singleStep=t}function d(e,t){if("object"!=typeof t||Array.isArray(t))throw new Error("noUiSlider: 'range' is not an object.");if(void 0===t.min||void 0===t.max)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");if(t.min===t.max)throw new Error("noUiSlider: 'range' 'min' and 'max' cannot be equal.");e.spectrum=new s(t,e.snap,e.dir,e.singleStep)}function f(e,t){if(t=H(t),!Array.isArray(t)||!t.length)throw new Error("noUiSlider: 'start' option is incorrect.");e.handles=t.length,e.start=t}function g(e,t){if("boolean"!=typeof(e.snap=t))throw new Error("noUiSlider: 'snap' option must be a boolean.")}function m(e,t){if("boolean"!=typeof(e.animate=t))throw new Error("noUiSlider: 'animate' option must be a boolean.")}function v(e,t){if("number"!=typeof(e.animationDuration=t))throw new Error("noUiSlider: 'animationDuration' option must be a number.")}function y(e,t){var i,a=[!1];if(!0===t||!1===t){for(i=1;i<e.handles;i++)a.push(t);a.push(!1)}else{if(!Array.isArray(t)||!t.length||t.length!==e.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");a=t}e.connect=a}function _(e,t){switch(t){case"horizontal":e.ort=0;break;case"vertical":e.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function b(e,t){if(!n(t))throw new Error("noUiSlider: 'margin' option must be numeric.");if(0!==t&&(e.margin=e.spectrum.getMargin(t),!e.margin))throw new Error("noUiSlider: 'margin' option is only supported on linear sliders.")}function w(e,t){if(!n(t))throw new Error("noUiSlider: 'limit' option must be numeric.");if(e.limit=e.spectrum.getMargin(t),!e.limit||e.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function P(e,t){switch(t){case"ltr":e.dir=0;break;case"rtl":e.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function C(e,t){if("string"!=typeof t)throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var i=0<=t.indexOf("tap"),a=0<=t.indexOf("drag"),n=0<=t.indexOf("fixed"),s=0<=t.indexOf("snap"),r=0<=t.indexOf("hover");if(n){if(2!==e.handles)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");b(e,e.start[1]-e.start[0])}e.events={tap:i||s,drag:a,fixed:n,snap:s,hover:r}}function x(e,t){if(!1!==t)if(!0===t){e.tooltips=[];for(var i=0;i<e.handles;i++)e.tooltips.push(!0)}else{if(e.tooltips=H(t),e.tooltips.length!==e.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.tooltips.forEach(function(e){if("boolean"!=typeof e&&("object"!=typeof e||"function"!=typeof e.to))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")})}}function F(e,t){if("function"==typeof(e.format=t).to&&"function"==typeof t.from)return!0;throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.")}function k(e,t){if(void 0!==t&&"string"!=typeof t&&!1!==t)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");e.cssPrefix=t}function S(e,t){if(void 0!==t&&"object"!=typeof t)throw new Error("noUiSlider: 'cssClasses' must be an object.");if("string"==typeof e.cssPrefix)for(var i in e.cssClasses={},t)t.hasOwnProperty(i)&&(e.cssClasses[i]=e.cssPrefix+t[i]);else e.cssClasses=t}function T(e,t){if(!0!==t&&!1!==t)throw new Error("noUiSlider: 'useRequestAnimationFrame' option should be true (default) or false.");e.useRequestAnimationFrame=t}function W(t){var i,a={margin:0,limit:0,animate:!0,animationDuration:300,format:l},n={connect:!(i={step:{r:!1,t:p},start:{r:!0,t:f},connect:{r:!0,t:y},direction:{r:!0,t:P},snap:{r:!1,t:g},animate:{r:!1,t:m},animationDuration:{r:!1,t:v},range:{r:!0,t:d},orientation:{r:!1,t:_},margin:{r:!1,t:b},limit:{r:!1,t:w},behaviour:{r:!0,t:C},format:{r:!1,t:F},tooltips:{r:!1,t:x},cssPrefix:{r:!1,t:k},cssClasses:{r:!1,t:S},useRequestAnimationFrame:{r:!1,t:T}}),direction:"ltr",behaviour:"tap",orientation:"horizontal",cssPrefix:"noUi-",cssClasses:{target:"target",base:"base",origin:"origin",handle:"handle",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",ltr:"ltr",rtl:"rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},useRequestAnimationFrame:!0};Object.keys(i).forEach(function(e){if(void 0===t[e]&&void 0===n[e]){if(i[e].r)throw new Error("noUiSlider: '"+e+"' is required.");return!0}i[e].t(a,void 0===t[e]?n[e]:t[e])}),a.pips=t.pips;var e=[["left","top"],["right","bottom"]];return a.style=e[a.dir][a.ort],a.styleOposite=e[a.dir?0:1][a.ort],a}function M(e,u,s){var o,l,r,p,t,h,n,c=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},b=e,d=[],f=[],w=u.spectrum,g=[],m={};function v(e,t){return!!t&&K(e,u.cssClasses.connect)}function i(e,t){return!!u.tooltips[t]&&K(e.firstChild,u.cssClasses.tooltip)}function P(a,n,s){var e=document.createElement("div"),r="",o=[u.cssClasses.valueNormal,u.cssClasses.valueLarge,u.cssClasses.valueSub],l=[u.cssClasses.markerNormal,u.cssClasses.markerLarge,u.cssClasses.markerSub],p=[u.cssClasses.valueHorizontal,u.cssClasses.valueVertical],h=[u.cssClasses.markerHorizontal,u.cssClasses.markerVertical];function c(e,t,i){return'class="'+(a=i[1],s=(n=t)===u.cssClasses.value,r=s?o:l,n+" "+(s?p:h)[u.ort]+" "+r[a])+'" style="'+u.style+": "+e+'%"';var a,n,s,r}return q(e,u.cssClasses.pips),q(e,0===u.ort?u.cssClasses.pipsHorizontal:u.cssClasses.pipsVertical),Object.keys(a).forEach(function(e){var t,i;(i=a[t=e])[1]=i[1]&&n?n(i[0],i[1]):i[1],r+="<div "+c(t,u.cssClasses.marker,i)+"></div>",i[1]&&(r+="<div "+c(t,u.cssClasses.value,i)+">"+s.to(i[0])+"</div>")}),e.innerHTML=r,e}function a(e){var d,f,g,t,m,i,a,v,y,_,n=e.mode,s=e.density||1,r=e.filter||!1,o=function(e,t,i){if("range"===e||"steps"===e)return w.xVal;if("count"===e){var a,n=100/(t-1),s=0;for(t=[];(a=s++*n)<=100;)t.push(a);e="positions"}return"positions"===e?t.map(function(e){return w.fromStepping(i?w.getStep(e):e)}):"values"===e?i?t.map(function(e){return w.fromStepping(w.getStep(w.toStepping(e)))}):t:void 0}(n,e.values||!1,e.stepped||!1),l=(d=s,f=n,g=o,m={},i=w.xVal[0],a=w.xVal[w.xVal.length-1],y=v=!1,_=0,t=g.slice().sort(function(e,t){return e-t}),(g=t.filter(function(e){return!this[e]&&(this[e]=!0)},{}))[0]!==i&&(g.unshift(i),v=!0),g[g.length-1]!==a&&(g.push(a),y=!0),g.forEach(function(e,t){var i,a,n,s,r,o,l,p,h,c=e,u=g[t+1];if("steps"===f&&(i=w.xNumSteps[t]),i||(i=u-c),!1!==c&&void 0!==u)for(i=Math.max(i,1e-7),a=c;a<=u;a=(a+i).toFixed(7)/1){for(l=(r=(s=w.toStepping(a))-_)/d,h=r/(p=Math.round(l)),n=1;n<=p;n+=1)m[(_+n*h).toFixed(5)]=["x",0];o=-1<g.indexOf(a)?1:"steps"===f?2:0,!t&&v&&(o=0),a===u&&y||(m[s.toFixed(5)]=[a,o]),_=s}}),m),p=e.format||{to:Math.round};return b.appendChild(P(l,r,p))}function y(){var e=o.getBoundingClientRect(),t="offset"+["Width","Height"][u.ort];return 0===u.ort?e.width||o[t]:e.height||o[t]}function _(a,t,n,s){var i=function(e){return!b.hasAttribute("disabled")&&(t=b,i=u.cssClasses.tap,(t.classList?!t.classList.contains(i):!new RegExp("\\b"+i+"\\b").test(t.className))&&(e=function(e,t){e.preventDefault();var i,a,n=0===e.type.indexOf("touch"),s=0===e.type.indexOf("mouse"),r=0===e.type.indexOf("pointer"),o=e;0===e.type.indexOf("MSPointer")&&(r=!0);if(n){if(1<o.touches.length)return!1;i=e.changedTouches[0].pageX,a=e.changedTouches[0].pageY}t=t||z(),(s||r)&&(i=e.clientX+t.x,a=e.clientY+t.y);return o.pageOffset=t,o.points=[i,a],o.cursor=s||r,o}(e,s.pageOffset),!(a===c.start&&void 0!==e.buttons&&1<e.buttons)&&((!s.hover||!e.buttons)&&(e.calcPoint=e.points[u.ort],void n(e,s)))));var t,i},r=[];return a.split(" ").forEach(function(e){t.addEventListener(e,i,!1),r.push([e,i])}),r}function C(e){var t,i,a,n,s,r=100*(e-(t=o,i=u.ort,a=t.getBoundingClientRect(),n=t.ownerDocument.documentElement,s=z(),/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),i?a.top+s.y-n.clientTop:a.left+s.x-n.clientLeft))/y();return u.dir?100-r:r}function x(e,a,i,t){var n=i.slice(),s=[!e,e],r=[e,!e];t=t.slice(),e&&t.reverse(),1<t.length?t.forEach(function(e,t){var i=R(n,e,n[e]+a,s[t],r[t]);!1===i?a=0:(a=i-n[e],n[e]=i)}):s=r=[!0];var o=!1;t.forEach(function(e,t){o=$(e,i[e]+a,s[t],r[t])||o}),o&&t.forEach(function(e){F("update",e),F("slide",e)})}function F(i,a,n){Object.keys(m).forEach(function(e){var t=e.split(".")[0];i===t&&m[e].forEach(function(e){e.call(p,g.map(u.format.to),a,g.slice(),n||!1,d.slice())})})}function k(e,t){"mouseout"===e.type&&"HTML"===e.target.nodeName&&null===e.relatedTarget&&T(e,t)}function S(e,t){if(-1===navigator.appVersion.indexOf("MSIE 9")&&0===e.buttons&&0!==t.buttonsProperty)return T(e,t);var i=(u.dir?-1:1)*(e.calcPoint-t.startCalcPoint);x(0<i,100*i/t.baseSize,t.locations,t.handleNumbers)}function T(e,t){var i=o.querySelector("."+u.cssClasses.active);null!==i&&j(i,u.cssClasses.active),e.cursor&&(document.body.style.cursor="",document.body.removeEventListener("selectstart",document.body.noUiListener)),document.documentElement.noUiListeners.forEach(function(e){document.documentElement.removeEventListener(e[0],e[1])}),j(b,u.cssClasses.drag),V(),t.handleNumbers.forEach(function(e){F("set",e),F("change",e),F("end",e)})}function M(e,t){if(1===t.handleNumbers.length){var i=l[t.handleNumbers[0]];if(i.hasAttribute("disabled"))return!1;q(i.children[0],u.cssClasses.active)}e.preventDefault(),e.stopPropagation();var a=_(c.move,document.documentElement,S,{startCalcPoint:e.calcPoint,baseSize:y(),pageOffset:e.pageOffset,handleNumbers:t.handleNumbers,buttonsProperty:e.buttons,locations:d.slice()}),n=_(c.end,document.documentElement,T,{handleNumbers:t.handleNumbers}),s=_("mouseout",document.documentElement,k,{handleNumbers:t.handleNumbers});if(document.documentElement.noUiListeners=a.concat(n,s),e.cursor){document.body.style.cursor=getComputedStyle(e.target).cursor,1<l.length&&q(b,u.cssClasses.drag);var r=function(){return!1};document.body.noUiListener=r,document.body.addEventListener("selectstart",r,!1)}t.handleNumbers.forEach(function(e){F("start",e)})}function A(e){e.stopPropagation();var a,n,s,t=C(e.calcPoint),i=(a=t,s=!(n=100),l.forEach(function(e,t){if(!e.hasAttribute("disabled")){var i=Math.abs(d[t]-a);i<n&&(s=t,n=i)}}),s);if(!1===i)return!1;u.events.snap||B(b,u.cssClasses.tap,u.animationDuration),$(i,t,!0,!0),V(),F("slide",i,!0),F("set",i,!0),F("change",i,!0),F("update",i,!0),u.events.snap&&M(e,{handleNumbers:[i]})}function D(e){var t=C(e.calcPoint),i=w.getStep(t),a=w.fromStepping(i);Object.keys(m).forEach(function(e){"hover"===e.split(".")[0]&&m[e].forEach(function(e){e.call(p,a)})})}function R(e,t,i,a,n){var s;return 1<l.length&&(a&&0<t&&(i=Math.max(i,e[t-1]+u.margin)),n&&t<l.length-1&&(i=Math.min(i,e[t+1]-u.margin))),1<l.length&&u.limit&&(a&&0<t&&(i=Math.min(i,e[t-1]+u.limit)),n&&t<l.length-1&&(i=Math.max(i,e[t+1]-u.limit))),i=w.getStep(i),s=i,(i=Math.max(Math.min(s,100),0))!==e[t]&&i}function L(e){return e+"%"}function V(){f.forEach(function(e){var t=50<d[e]?-1:1,i=3+(l.length+t*e);l[e].childNodes[0].style.zIndex=i})}function $(e,t,i,a){return!1!==(t=R(d,e,t,i,a))&&(function(e,t){d[e]=t,g[e]=w.fromStepping(t);var i=function(){l[e].style[u.style]=L(t),E(e),E(e+1)};window.requestAnimationFrame&&u.useRequestAnimationFrame?window.requestAnimationFrame(i):i()}(e,t),!0)}function E(e){if(r[e]){var t=0,i=100;0!==e&&(t=d[e-1]),e!==r.length-1&&(i=d[e]),r[e].style[u.style]=L(t),r[e].style[u.styleOposite]=L(100-i)}}function O(e,t){null!==e&&!1!==e&&("number"==typeof e&&(e=String(e)),!1===(e=u.format.from(e))||isNaN(e)||$(t,w.toStepping(e),!1,!1))}function I(e,t){var i=H(e),a=void 0===d[0];t=void 0===t||!!t,i.forEach(O),u.animate&&!a&&B(b,u.cssClasses.tap,u.animationDuration),f.forEach(function(e){$(e,d[e],!0,!1)}),V(),f.forEach(function(e){F("update",e),null!==i[e]&&t&&F("set",e)})}function U(){var e=g.map(u.format.to);return 1===e.length?e[0]:e}function N(e,t){m[e]=m[e]||[],m[e].push(t),"update"===e.split(".")[0]&&l.forEach(function(e,t){F("update",t)})}if(b.noUiSlider)throw new Error("Slider was already initialized.");return q(t=b,u.cssClasses.target),0===u.dir?q(t,u.cssClasses.ltr):q(t,u.cssClasses.rtl),0===u.ort?q(t,u.cssClasses.horizontal):q(t,u.cssClasses.vertical),o=K(t,u.cssClasses.base),function(e,t){l=[],(r=[]).push(v(t,e[0]));for(var i=0;i<u.handles;i++)l.push((a=i,K(n=K(t,u.cssClasses.origin),u.cssClasses.handle).setAttribute("data-handle",a),n)),f[i]=i,r.push(v(t,e[i+1]));var a,n}(u.connect,o),p={destroy:function(){for(var e in u.cssClasses)u.cssClasses.hasOwnProperty(e)&&j(b,u.cssClasses[e]);for(;b.firstChild;)b.removeChild(b.firstChild);delete b.noUiSlider},steps:function(){return d.map(function(e,t){var i=w.getNearbySteps(e),a=g[t],n=i.thisStep.step,s=null;!1!==n&&a+n>i.stepAfter.startValue&&(n=i.stepAfter.startValue-a),s=a>i.thisStep.startValue?i.thisStep.step:!1!==i.stepBefore.step&&a-i.stepBefore.highestStep,100===e?n=null:0===e&&(s=null);var r=w.countStepDecimals();return null!==n&&!1!==n&&(n=Number(n.toFixed(r))),null!==s&&!1!==s&&(s=Number(s.toFixed(r))),[s,n]})},on:N,off:function(e){var a=e&&e.split(".")[0],n=a&&e.substring(a.length);Object.keys(m).forEach(function(e){var t=e.split(".")[0],i=e.substring(t.length);a&&a!==t||n&&n!==i||delete m[e]})},get:U,set:I,reset:function(e){I(u.start,e)},__moveHandles:function(e,t,i){x(e,t,d,i)},options:s,updateOptions:function(t,e){var i=U(),a=["margin","limit","range","animate","snap","step","format"];a.forEach(function(e){void 0!==t[e]&&(s[e]=t[e])});var n=W(s);a.forEach(function(e){void 0!==t[e]&&(u[e]=n[e])}),n.spectrum.direction=w.direction,w=n.spectrum,u.margin=n.margin,u.limit=n.limit,d=[],I(t.start||i,e)},target:b,pips:a},(h=u.events).fixed||l.forEach(function(e,t){_(c.start,e.children[0],M,{handleNumbers:[t]})}),h.tap&&_(c.start,o,A,{}),h.hover&&_(c.move,o,D,{hover:!0}),h.drag&&r.forEach(function(e,t){if(!1!==e&&0!==t&&t!==r.length-1){var i=l[t-1],a=l[t],n=[e];q(e,u.cssClasses.draggable),h.fixed&&(n.push(i.children[0]),n.push(a.children[0])),n.forEach(function(e){_(c.start,e,M,{handles:[i,a],handleNumbers:[t-1,t]})})}}),I(u.start),u.pips&&a(u.pips),u.tooltips&&(n=l.map(i),N("update",function(e,t,i){if(n[t]){var a=e[t];!0!==u.tooltips[t]&&(a=u.tooltips[t].to(i[t])),n[t].innerHTML=a}})),p}return{create:function(e,t){if(!e.nodeName)throw new Error("noUiSlider.create requires a single element.");var i=M(e,W(t),t);return e.noUiSlider=i}}});var nite={map:null,date:null,sun_position:null,earth_radius_meters:6371008,marker_twilight_civil:null,marker_twilight_nautical:null,marker_twilight_astronomical:null,marker_night:null,init:function(e){if("undefined"==typeof google||void 0===google.maps)throw"Nite Overlay: no google.maps detected";this.map=e,this.sun_position=this.calculatePositionOfSun();var t=this.getShadowPosition();this.marker_twilight_civil=new google.maps.Circle({map:this.map,center:t,radius:this.getShadowRadiusFromAngle(.566666),fillColor:"#000",fillOpacity:.1,strokeOpacity:0,clickable:!1,editable:!1}),this.marker_twilight_nautical=new google.maps.Circle({map:this.map,center:t,radius:this.getShadowRadiusFromAngle(6),fillColor:"#000",fillOpacity:.1,strokeOpacity:0,clickable:!1,editable:!1}),this.marker_twilight_astronomical=new google.maps.Circle({map:this.map,center:t,radius:this.getShadowRadiusFromAngle(12),fillColor:"#000",fillOpacity:.1,strokeOpacity:0,clickable:!1,editable:!1}),this.marker_night=new google.maps.Circle({map:this.map,center:t,radius:this.getShadowRadiusFromAngle(18),fillColor:"#000",fillOpacity:.1,strokeOpacity:0,clickable:!1,editable:!1})},getShadowRadiusFromAngle:function(e){return this.earth_radius_meters*Math.PI*.5-2*this.earth_radius_meters*Math.PI/360*e},getSunPosition:function(){return this.sun_position},getShadowPosition:function(){return this.sun_position?new google.maps.LatLng(-this.sun_position.lat(),this.sun_position.lng()+180):null},refresh:function(){if(this.isVisible()){this.sun_position=this.calculatePositionOfSun(this.date);var e=this.getShadowPosition();this.marker_twilight_civil.setCenter(e),this.marker_twilight_nautical.setCenter(e),this.marker_twilight_astronomical.setCenter(e),this.marker_night.setCenter(e)}},jday:function(e){return e.getTime()/864e5+2440587.5},calculatePositionOfSun:function(e){var t=.017453292519943295,i=1e3*(60*(60*(e=e instanceof Date?e:new Date).getUTCHours()+e.getUTCMinutes())+e.getUTCSeconds())+e.getUTCMilliseconds(),a=(this.jday(e)-2451545)/36525,n=(280.46646+a*(36000.76983+3032e-7*a))%360,s=357.52911+a*(35999.05029-1537e-7*a),r=n+(Math.sin(t*s)*(1.914602-a*(.004817+14e-6*a))+Math.sin(2*t*s)*(.019993-101e-6*a)+289e-6*Math.sin(3*t*s))-.00569-.00478*Math.sin(125.04*t-1934.136*a),o=23+(26+(21.448-a*(46.815+a*(59e-5-.001813*a)))/60)/60+.00256*Math.cos(125.04*t-1934.136*a),l=Math.asin(Math.sin(t*o)*Math.sin(t*r))/t,p=.016708634-a*(42037e-9+1.267e-7*a),h=Math.tan(t*(o/2))*Math.tan(t*(o/2)),c=(i+6e4*((h*Math.sin(2*t*n)-2*p*Math.sin(t*s)+4*p*h*Math.sin(t*s)*Math.cos(2*t*n)-.5*h*h*Math.sin(4*t*n)-1.25*p*p*Math.sin(2*t*s))/t*4))%864e5/24e4,u=-(c<0?c+180:c-180);return new google.maps.LatLng(l,u)},setDate:function(e){this.date=e,this.refresh()},setMap:function(e){this.map=e,this.marker_twilight_civil.setMap(this.map),this.marker_twilight_nautical.setMap(this.map),this.marker_twilight_astronomical.setMap(this.map),this.marker_night.setMap(this.map)},show:function(){this.marker_twilight_civil.setVisible(!0),this.marker_twilight_nautical.setVisible(!0),this.marker_twilight_astronomical.setVisible(!0),this.marker_night.setVisible(!0),this.refresh()},hide:function(){this.marker_twilight_civil.setVisible(!1),this.marker_twilight_nautical.setVisible(!1),this.marker_twilight_astronomical.setVisible(!1),this.marker_night.setVisible(!1)},isVisible:function(){return this.marker_night.getVisible()}};function findMarkerSourceForType(e){if(e){if(e=e.toUpperCase(),metadata.markers.longMarkerMatches[e])return metadata.markers.longMarkerMatches[e];var t=e.substring(0,3);if(metadata.markers.shortMarkerMatches[t])return metadata.markers.shortMarkerMatches[t]}return"B737"}function calculateMarkerSpriteSheetOffset(e,t){var a=["A300","A320","A321","A330","A340","A350","A380","B737","B747","B757","B767","B777","B787","RJ100","SINGLEPROP","TWINPROP","EUROCOPTER","FOKKER100","PRIVATEJET","VEHICLE","GLIDER","TRIANGLE","VOLCANO"];for(i=0;i<a.length;i++){if(a[i]==e)return[t,i]}return[0,0]}function logPlaneEvent(e){void 0!==window.ga&&(window.ga("send","pageview",e),window.ga("send",{hitType:"event",eventCategory:"pf_click",eventAction:"plane"}))}function logEvent(e,t){void 0!==window.ga&&window.ga("send",{hitType:"event",eventCategory:e,eventAction:t})}function logPageView(e){void 0!==window.ga&&window.ga("send","pageview",e)}function logMapType(e){void 0!==window.ga&&window.ga("set","dimension1",e)}function Quadtree(e,t,i,a){this.bounds=e,this.maxObjects=t,this.maxLevels=i,this.level=a,this.objects=[],this.subnodes=null}function PFQuadtreeModel(){this.totalPlanes=0;this.padding=1.2918852009607193,this.quadtree=new Quadtree({x:0,y:0,width:256,height:256},32,16)}function PFSettingsModel(e,t){if(this.persistentSettings=e,this.transientSettings=t,this.isLocalStorageAvailable=!1,"undefined"!=typeof localStorage)try{localStorage.setItem("localStorageTest",""),localStorage.removeItem("localStorageTest"),this.isLocalStorageAvailable=!0}catch(e){}}function PFAssetModel(){this.queue={},this.assets={}}function PFPlaneModel(){this.planes={},this.airlines=!1,this.liveUpdatesActive_=!1,this.hasPopulated=!1,this.lastFullUpdateTS=0,this.lastPolledBounds=null,this.lastRequestXHR=!1,this.lastPathRequestXHR=!1}function PFAirportModel(){this.airports={}}!function(r){r.fn.autocomplete=function(e){var n=this,t=!1,i=r.extend({type:0,minLength:2,pollWaitTime:.35},e),s=r('<div class="autocomplete_results"></div>');s.on("click","a",function(){return i.select(r(this).data("title"),r(this).data("value")),s.remove(),!1});var a=function(e){s.empty();for(var t=0;t<e.length;t++){var i=e[t],a=r('<a href="#" data-title="'+i.label+'" data-value="'+i.value+'">'+i.label+"</a>");s.append(a)}n.parent().append(s)};return this.on("keypress",function(){0!=t&&clearTimeout(t),n.val().length<i.minLength||(t=setTimeout(function(){i.request(n.val(),a)},1e3*i.pollWaitTime))}),this}}(jQuery),function(){for(var s=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=Date.now(),a=Math.max(0,16-(i-s)),n=window.setTimeout(function(){e(i+a)},a);return s=i+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),CanvasRenderingContext2D.prototype.roundRect=function(e,t,i,a,n,s,r){this.beginPath(),this.moveTo(e+n.upperLeft,t),this.lineTo(e+i-n.upperRight,t),this.quadraticCurveTo(e+i,t,e+i,t+n.upperRight),this.lineTo(e+i,t+a-n.lowerRight),this.quadraticCurveTo(e+i,t+a,e+i-n.lowerRight,t+a),this.lineTo(e+n.lowerLeft,t+a),this.quadraticCurveTo(e,t+a,e,t+a-n.lowerLeft),this.lineTo(e,t+n.upperLeft),this.quadraticCurveTo(e,t,e+n.upperLeft,t),this.closePath(),r&&this.stroke(),s&&this.fill()},Number.prototype.format=function(){for(var e=(this+"").split("."),t=e[0],i=1<e.length?"."+e[1]:"",a=/(\d+)(\d{3})/;a.test(t);)t=t.replace(a,"$1,$2");return t+i},Date.prototype.toUTC=function(){return Date.UTC(this.getUTCFullYear(),this.getUTCMonth(),this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds())/1e3},Date.prototype.toUTCArray=function(){var e=this;return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()]},Date.prototype.toISO=function(){var e,t=this.toUTCArray(),i=0;for(t[1]+=1;i++<7;)(e=t[i])<10&&(t[i]="0"+e);return t.splice(0,3).join("-")+"T"+t.join(":")+"%20UTC"},Date.prototype.toHumanReadable=function(){var e,t=this.toUTCArray(),i=0;for(t[1]+=1;i++<7;)(e=t[i])<10&&(t[i]="0"+e);return t.splice(0,3).join("-")+" "+t.join(":")+" UTC"},Quadtree.prototype.subnodeAtPoint=function(e){var t=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2;return this.subnodes[2*(e.y>i)+(e.x>t)]},Quadtree.prototype.subnodeForRect=function(e){var t=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,a=e.y>=i,n=e.y<i&&e.y+e.height<i;if(e.x<=t&&e.x+e.width<t){if(n)return this.subnode[0];if(a)return this.subnode[2]}else if(e.x>=t){if(n)return this.subnode[1];if(a)return this.sudnode[3]}return null},Quadtree.prototype.rectContainsPoint=function(e,t){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},Quadtree.prototype.rectContainsRect=function(e,t){var i=e.x+e.width,a=t.x+t.width,n=e.y+e.height,s=t.y+t.height;return!(i<t.x||e.x>a||n<t.y||e.y>s)},Quadtree.prototype.clear=function(){if(null!==this.subnodes)for(var e=0;e<4;e++)this.subnodes[e].clear();this.objects=[],this.subnodes=null},Quadtree.prototype.retrieve=function(e){var t=[];if(null!==this.subnodes)for(var i=0;i<4;i++)t=t.concat(this.subnodes[i].retrieve(e));if(this.rectContainsRect(this.bounds,e))for(i=0;i<this.objects.length;i++){var a=this.objects[i];this.rectContainsRect(e,a)&&t.push(a)}return t},Quadtree.prototype.insert=function(e){if(null===this.subnodes){if(this.objects.push(e),this.level<this.maxLevels&&this.objects.length<this.maxObjects){null===this.subnodes&&this.split();for(var t=this.objects.length-1;0<=t;t--){var i,a=this.objects[t];null!==(i=this.subnodeAtRect(e))&&(i.insert(a),this.objects.splice(t,1))}}}else(i=this.subnodeForRect(e)).insert(e)},Quadtree.prototype.split=function(){for(var e={width:this.bounds.width/2,height:this.bounds.height/2},t=0;t<4;t++){var i={x:this.bounds.x+(t%2==1?e.width:0),y:this.bounds.y+(1<t?e.height:0),width:e.width,height:e.height};this.subnodes[t]=new Quadtree(i,this.maxObjects,this.maxLevels,this.level+1)}},PFQuadtreeModel.prototype.fetch=function(e,t){var i=e;return t&&(i.x-=this.padding,i.y-=this.padding,i.width+=2*this.padding,i.height+=2*this.padding),this.quadtree.retrieve(i)},PFQuadtreeModel.prototype.rebuild=function(e){for(var t in this.clear(),pf.airportController.airports){var i=pf.airportController.airports[t],a=i.worldPosition();this.quadtree.insert({x:a.x,y:a.y,width:0,height:0,marker:i,type:1})}for(var t in this.totalPlanes=0,pf.planeController.planes){var n=pf.planeController.planes[t];if(e){var s=n.worldPositionForLatLng(n.playbackLastAccuratePosition),r=n.worldPositionForLatLng(n.playbackDestinationPosition);this.quadtree.insert({x:Math.min(s.x,r.x),y:Math.min(s.y,r.y),width:Math.abs(s.x-r.x),height:Math.abs(s.y-r.y),marker:n,type:0})}else{a=n.worldPosition();this.quadtree.insert({x:a.x,y:a.y,width:0,height:0,marker:n,type:0})}n.isVisible()&&this.totalPlanes++}},PFQuadtreeModel.prototype.clear=function(){this.quadtree.clear()},PFSettingsModel.prototype.init=function(){this.restore();var e=this;$(window).unload(function(){e.save()}),this.save(),this.deleteOldCookie()},PFSettingsModel.prototype.valueForKey=function(e){return e in this.transientSettings?this.transientSettings[e]:e in this.persistentSettings&&this.persistentSettings[e]},PFSettingsModel.prototype.transientValueForKey=function(e,t){return e in this.transientSettings&&this.transientSettings[e]},PFSettingsModel.prototype.setValue=function(e,t){this.persistentSettings[e]=t,this.handleSettingUpdate(e,t)},PFSettingsModel.prototype.setTransientValue=function(e,t){this.transientSettings[e]=t,this.handleSettingUpdate(e,t)},PFSettingsModel.prototype.restore=function(){if(!this.valueForKey("internalEmbed")&&this.isLocalStorageAvailable)for(var t in localStorage)try{var e=localStorage[t];e=JSON.parse(e),this.setValue(t,e)}catch(e){localStorage.removeItem(t)}},PFSettingsModel.prototype.save=function(){if(!this.valueForKey("internalEmbed")&&this.isLocalStorageAvailable)for(var e in localStorage.clear(),this.valueForKey("restoreView")&&(this.persistentSettings.center=pf.map.getCenter().toUrlValue(),this.persistentSettings.zoom=pf.map.getZoom()),this.persistentSettings){var t=this.persistentSettings[e];localStorage[e]=JSON.stringify(t)}},PFSettingsModel.prototype.handleSettingUpdate=function(e,t){if("center"==e){var i=t.split(",");pf.map.setCenter(new google.maps.LatLng(i[0],i[1]))}else"zoom"==e?(t=parseInt(t),pf.map.setZoom(t)):"mapTypeV2"==e?pf.setMapType(t):"showPersistentFlightPaths"==e?t||pf.planeController.hideAllFlightPaths():"showAirports"==e?pf.canvasOverlay.render():"showDayNightOverlay"==e?pf.setDayNightOverlayActive(t):"mapFadeValue"==e&&(pf.dimmerOverlay.opacity=t,pf.dimmerOverlay.setMap(null),pf.dimmerOverlay.setMap(pf.map))},PFSettingsModel.prototype.deleteOldCookie=function(){try{var e=document.cookie.split(";"),t=null;for(i=0;i<e.length;i++){var a=e[i].replace(/^\s\s*/,"").replace(/\s\s*$/,"");if("pf"==a.substring(0,2)){t=a;break}}t&&(date=new Date,date.setDate(date.getDate()-1),document.cookie="pf=;expires="+date+";domain=.planefinder.net;path=/")}catch(e){console.log("Failed to remove old cookie")}},PFAssetModel.prototype.removeURL=function(e){delete this.queue[e]},PFAssetModel.prototype.fetchImage=function(e,t){var i=this,a=$("<img/>");a.attr("src",e),a.on("error",function(){i.removeURL(e)}),a.on("load",function(){i.assets[e]=a.get(0),i.removeURL(e),t&&t()}),this.queue[e]=!0},PFAssetModel.prototype.fetchImage=function(e,t){var i=this,a=$("<img/>");a.attr("src",e),a.on("error",function(){i.removeURL(e)}),a.on("load",function(){i.assets[e]=a.get(0),i.removeURL(e),t&&t()}),this.queue[e]=!0},PFAssetModel.prototype.imageForURL=function(e,t){return t=t||null,this.assets[e]?this.assets[e]:!this.queue[e]&&void this.fetchImage(e,t)},PFPlaneModel.prototype.init=function(){var a=this;google.maps.event.addListener(pf.map,"idle",function(){if(null!==a.lastPolledBounds&&a.liveUpdatesActive()){var e=pf.map.getBounds();if(e){var t=e.getNorthEast(),i=e.getSouthWest();a.lastPolledBounds.contains(t)&&a.lastPolledBounds.contains(i)||a.requestManualUpdate()}}})},PFPlaneModel.prototype.startAccuratePollingTimer=function(e){this.stopAccuratePollingTimer();var t=this;this.updateInterval=window.setInterval(function(){t.requestUpdate()},1e3*e)},PFPlaneModel.prototype.stopAccuratePollingTimer=function(){this.updateInterval&&(window.clearInterval(this.updateInterval),this.updateInterval=null)},PFPlaneModel.prototype.getEstimationInterval=function(){var e=pf.map.getZoom(),t=pf.settings.valueForKey("flightPathEstimationInterval");return void 0!==t[e-2]?t[e-2]:.5},PFPlaneModel.prototype.startEstimationTimer=function(){this.updatePlanesWithEstimatedPositions()},PFPlaneModel.prototype.stopEstimationTimer=function(){this.estimationInterval&&(window.clearTimeout(this.estimationInterval),this.estimationInterval=null)},PFPlaneModel.prototype.removeAllPlanes=function(){for(id in this.planes)void 0!==this.planes[id]&&(this.planes[id].willRemove(),delete this.planes[id])},PFPlaneModel.prototype.hideAllFlightPaths=function(){var e;for(e in pf.planeController.planes)pf.planeController.planes[e]&&pf.planeController.planes[e].hideFlightPath()},PFPlaneModel.prototype.updatePlanesWithEstimatedPositions=function(){if(this.liveUpdatesActive()){pf.canvasOverlay.needsRedraw=!0;var e=1e3*this.getEstimationInterval(),t=this;this.estimationInterval=window.setTimeout(function(){t.updatePlanesWithEstimatedPositions()},e)}},PFPlaneModel.prototype.requestManualUpdate=function(){this.startAccuratePollingTimer(pf.settings.valueForKey("planePollInterval")),this.requestUpdate()},PFPlaneModel.prototype.requestUpdate=function(){var t=this,e={},i=pf.unixTimestamp();if(e.faa=1,pf.settings.valueForKey("airportUnit")&&(e.routetype=pf.settings.valueForKey("airportUnit")),i-this.lastFullUpdateTS<pf.settings.valueForKey("fullPlanePollInterval")){var a=pf.boundsExtendedBy(pf.map.getBounds(),256,pf.settings.valueForKey("cloudflareCachePartial"));e.cfCache=pf.settings.valueForKey("cloudflareCachePartial"),a&&(this.lastPolledBounds=a,e.bounds=this.lastPolledBounds.toUrlValue(),e._=5*Math.round(new Date/1e3/5))}else e._=10*Math.round(new Date/1e3/10);this.lastRequestXHR&&this.lastRequestXHR.abort(),this.lastRequestXHR=$.ajax({type:"GET",cache:!0,url:pf.settings.valueForKey("baseURL")+"endpoints/update.php",data:e,dataType:"jsonp",jsonpCallback:"planeDataCallback",timeout:pf.settings.valueForKey("planePollTimeout"),success:function(e){t.handleUpdateSuccess(e)},error:function(){}}),this.fetchFlightPaths()},PFPlaneModel.prototype.fetchFlightPaths=function(){var e=[];for(var t in this.planes)if(this.planes[t]){var a=this.planes[t];a.flightPath&&(e[e.length]=a)}if(0<e.length)for(i=0;i<e.length;i++)e[i].fetchFlightPath()},PFPlaneModel.prototype.handleUpdateSuccess=function(e){var t=pf.unixTimestamp();if(e.planes){var i=e.isEncoded;for(var a in e.planes){var n=parseInt(a);for(var s in e.planes[a]){var r=e.planes[a][s],o=r[8],l=r[3],p=r[4];if(i){var h=parseInt(o.substring(o.length-1));l=this.decryptEncodedValue(l,h),p=this.decryptEncodedValue(p,h)}var c=this.planes[s];c||(c=new PFPlaneMarker(),this.planes[s]=c),c.info.type=r[0],c.info.reg=r[1],c.info.callsign=r[2],c.info.flightno=r[10],c.info.adshex=s,c.info.altitude=parseInt(r[5]),c.info.heading=parseInt(r[6]),c.info.speed=parseInt(r[7]),c.info.mtime=parseInt(o);var u=r[11];u!==c.info.route_raw&&(c.info.route_raw=u,c.info.route_array=u?u.split("-"):[]),c.info.airline=3==r[9].length?r[9]:this.fetchAirlineFromCallsign(r[2]),c.info.planeType=n,c.info.markerType=findMarkerSourceForType(r[0]),c.info.squawk=r[12],c.info.decimalAdshex=parseInt(s,16);var d=new google.maps.LatLng(parseFloat(l),parseFloat(p));c.lastAccuratePosition=d,c.lastAccuratelyUpdatedTS=c.info.mtime,c.setPosition(d),c.handleDataUpdate(t)}}if(!e.isPartial){for(s in this.planes){this.planes[s].isFAA();var f=!1;for(var a in e.planes)if(e.planes[a].hasOwnProperty(s)){f=!0;break}if(!f){this.planes[s].willRemove();var g=s;delete this.planes[g]}}this.lastFullUpdateTS=t}}this.applyUserFilters();var m=!1;if(!this.hasPopulated){var v=pf.settings.valueForKey("selectedFlightNo");if(v){for(var s in this.planes)if(null!=this.planes[s]&&(this.planes[s].info.flightno==v||this.planes[s].info.callsign==v)){m=!0,pf.uiController.setSelectedMarker(this.planes[s],!0);break}if(!m&&!pf.settings.valueForKey("isEmbedded")){var y=new PFPreviousFlightsViewController($("div#page_container_modal"),{flightNo:v,height:"500px"});pf.uiController.presentModalViewController(y)}}this.hasPopulated=!0}pf.canvasOverlay.needsRedraw=!0,this.lastRequestXHR=null},PFPlaneModel.prototype.handleFlightPathUpdateSuccess=function(e){if(void 0!==e.paths){for(id in e.paths)void 0!==this.planes[id]&&this.planes[id].parseFlightPath(e.paths[id]);pf.canvasOverlay.needsRedraw=!0}this.lastPathRequestXHR=null},PFPlaneModel.prototype.applyUserFilters=function(){var e=pf.settings.valueForKey("filters"),t=0;if(e.length)for(var i=0;i<e.length;i++){if(void 0===(o=e[i]).fleet&&(o.fleet=[]),void 0===o.excludedTrafficSources&&(o.excludedTrafficSources=[]),o.active){var a=0;for(var n in pf.planeController.planes){(r=pf.planeController.planes[n]).matchesFilter(o)&&a++}o.numMatches=a,t++}}for(var n in pf.planeController.planes){var s=!1,r=pf.planeController.planes[n];if(t)for(i=0;i<e.length;i++){var o;if((o=e[i]).active&&r.matchesFilter(o)){s=!0;break}}else s=!0;r.setVisible(s)}pf.quadtreeController.rebuild(!1),$(document).trigger("PFFiltersReapplied",null),pf.canvasOverlay.needsRedraw=!0},PFPlaneModel.prototype.decryptEncodedValue=function(e,t){for(var i=".-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@£$%^&*()_+=[]{}'/?<>,|",a="",n=0;n<e.length;n++){var s=e.substring(n,n+1),r=i.indexOf(s)^t;a+=i.substring(r,r+1)}return a},PFPlaneModel.prototype.liveUpdatesActive=function(){return this.liveUpdatesActive_},PFPlaneModel.prototype.setLiveUpdatesActive=function(e){var t=this.liveUpdatesActive_;this.liveUpdatesActive_=e,this.removeAllPlanes(),e&&t!=e?(this.lastFullUpdateTS=0,this.startAccuratePollingTimer(pf.settings.valueForKey("planePollInterval")),this.startEstimationTimer(),this.requestUpdate()):e||t==e||(this.stopAccuratePollingTimer(),this.stopEstimationTimer())},PFPlaneModel.prototype.fetchAirlineFromCallsign=function(e){var t;try{t=e.substr(0,3).toUpperCase()}catch(e){t=""}return t},PFAirportModel.prototype.init=function(){var e=pf.settings.valueForKey("selectedAirport");for(iata in metadata.airports){var t=new PFAirportMarker(metadata.airports[iata]);this.airports[iata]=t,e&&iata==e&&pf.uiController.setSelectedMarker(this.airports[iata],!0)}};var PFViewController=Class.extend({init:function(){},load:function(){},unload:function(){},viewWillAppear:function(){},viewDidAppear:function(){},viewWillDisappear:function(){},viewDidDisappear:function(){},injectTemplateContent:function(e){var t=$("div#"+e+"_template").clone();t.attr("id",e+"_live");var i=$("div#sidebar_container");return i.empty().append(t),$("[placeholder]",i).blur(),t},dismissViewController:function(e){e()},isEqualTo:function(e){return!1}}),PFModalViewController=PFViewController.extend({init:function(e,t){this._super(),this.container=e,this.closeButtonCallback=null;var i=$("div#modal_view_template").clone().removeAttr("id");if(this.container.removeClass("loading").empty().append(i),$("div.modal_header_container").attr("style",""),$("a.close_button_large").attr("style",""),$("div.modal_content").attr("style",""),$("div.modal_title").attr("style",""),t.width||(t.width="480px"),t.height||(t.height="300px"),0<=t.width.indexOf("px")){var a=t.width.substring(0,t.width.length-2);a>$(window).width()&&(t.width=$(window).width()-100),t.width=a}else if(0<=t.width.indexOf("%")){var n=parseInt(t.width.substring(0,t.width.length-1));t.width=$(window).width()/100*n}if(0<=t.height.indexOf("px")){var s=t.height.substring(0,t.height.length-2);s>$(window).height()&&(t.height=$(window).height()-100),t.height=s}else if(0<=t.height.indexOf("%")){n=parseInt(t.height.substring(0,t.height.length-1));t.height=$(window).height()/100*n}if(this.container.css({width:t.width+"px",height:t.height+"px","margin-top":-t.height/2+"px","margin-left":-t.width/2+"px"}),t.hideBar)$("div.modal_title",this.container).css({display:"none"}),$("div.modal_header_container",this.container).css({"z-index":"1","border-bottom":"none"}),$("div.modal_content",this.container).css({top:"0px"});else{var r=t.title?t.title:"";$("div.modal_title",this.container).text(r)}t.hideCloseButton?$("a#modal_close_button").css("display","none"):$("a#modal_close_button").css("display","block");var o=this;i.on("click","a.close_button",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(o,o.closeButtonCallback),!1})},unload:function(){this._super(),this.container.empty()},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")}),this.container.animate({opacity:1,"margin-top":this.container.height()+"px"},500,function(){e()})}}),PFWebViewController=PFModalViewController.extend({init:function(e,t){this._super(e,t),this.iframe=$("<iframe></iframe>"),this.container.addClass("loading");var i=this;t.url&&(this.iframe.attr("src",t.url),$("div.modal_content",this.container).empty().append(this.iframe)),this.iframe.on("load",function(){i.container.removeClass("loading")})}}),PFTimeoutViewController=PFModalViewController.extend({init:function(e,t){t.hideBar=!0,t.hideCloseButton=!0,this._super(e,t),this.iframe=$("<iframe></iframe>"),this.container.addClass("loading");var i=this;this.iframe.load(function(){i.container.removeClass("loading")}),t.url&&(this.iframe.attr("src",t.url),$("div.modal_content",this.container).empty().append(this.iframe))}}),PFImageGalleryViewController=PFModalViewController.extend({init:function(e,t){this._super(e,t),this.currentPhoto=0,this.container=e,this.photos=t.photos,this.container.addClass("loading");var i=$("div#image_gallery_view_template").clone().removeAttr("id");$("div.modal_content",this.container).append(i);var a=this;i.on("click","a.close_button_large",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(a),!1}),i.on("click","a.prev",function(e){return e.stopPropagation(),$(this).hasClass("disabled")||(a.currentPhoto--,a.currentPhoto<0&&(a.currentPhoto=a.photos.length-1),a.showPhoto(a.currentPhoto)),!1}),i.on("click","a.next",function(e){return e.stopPropagation(),$(this).hasClass("disabled")||(a.currentPhoto++,a.currentPhoto>a.photos.length-1&&(a.currentPhoto=0),a.showPhoto(a.currentPhoto)),!1}),this.showPhoto(0)},unload:function(){this._super(),this.container.removeClass("image_gallery").empty()},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")}),this.container.animate({opacity:1,"margin-top":this.container.height()+"px"},500,function(){e()})},showPhoto:function(e){var t=this.photos[e],i=$("a.img",this.container),a=$("div.gallery_footer span.gallery_image_credit",this.container);i.prop("href",t.ningURL),i.css("background-image","url("+t.fullPath+")"),a.html("&copy; "+t.authorText),this.currentPhoto=e,this.currentPhoto==this.photos.length-1?$("a.next",this.container).addClass("disabled"):$("a.next",this.container).removeClass("disabled"),0<this.currentPhoto?$("a.prev",this.container).removeClass("disabled"):$("a.prev",this.container).addClass("disabled"),$("div.modal_title",this.container).text("Photo "+(this.currentPhoto+1)+" of "+this.photos.length)}}),PFPreviousFlightsViewController=PFModalViewController.extend({init:function(e,t){this._super(e,t),this.flightNo=t.flightNo,this.container=e;var i=$("div#previous_flights_view_template").clone().removeAttr("id");$("div.modal_content",this.container).append(i),$("div.modal_title",this.container).text("Flight not found"),this.fetchPreviousFlightsData();var a=this;i.on("click","a.close_button_large",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(a),!1}),i.on("click","ul.previous_flights_list a",function(e){e.stopPropagation();var t=parseInt($(this).data("timestamp"));return pf.uiController.dismissViewController(a,function(){pf.settings.setTransientValue("playbackSelectedFlightNo",a.flightNo),pf.uiController.presentViewController(pf.uiController.playbackViewController),pf.uiController.playbackViewController.startPlaybackAtDate(t)}),!1})},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")}),this.container.animate({opacity:1,"margin-top":this.container.height()+"px"},500,function(){e()})},fetchPreviousFlightsData:function(){$(".loading",this.container).css("display","block");var c=$("ul",this.container),u=this;$.ajax({type:"GET",cache:!1,url:pf.settings.valueForKey("baseURL")+"endpoints/playback/previousFlights.php",data:{fn:this.flightNo},dataType:"jsonp",success:function(e){$(".loading, .error",u.container).css("display","none");var t=e.flights;if(0<e.flights.length)for(var i in t){var a=new Date(1e3*t[i].first_seen_ts),n=a.getFullYear(),s=a.getDate()<10?"0"+a.getDate():a.getDate(),r=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,o=a.getHours()<10?"0"+a.getHours():a.getHours(),l=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),p=(a.getSeconds()<10?a.getSeconds():a.getSeconds(),300*Math.round(t[i].first_seen_ts/300));p<t[i].first_seen_ts&&(p+=300),t[i].best_start_ts&&(p=t[i].best_start_ts);var h=$('<li id="previous-flight-'+i+'"><a href="#" data-timestamp="'+p+'">Flight starting on '+s+"/"+r+"/"+n+" at "+o+":"+l+"</a></li>");c.append(h)}else $(".error",u.container).css("display","block")}})}}),PFPlaneHistoryViewController=PFModalViewController.extend({init:function(e,t){this._super(e,t),this.adshex=t.adshex,this.container=e;var i=$("div#plane_history_view_template").clone().removeAttr("id");$("div.modal_content",this.container).append(i),$("div.modal_title",this.container).text("Plane history"),this.fetchPlaneHistoryData();var a=this;i.on("click","a.close_button_large",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(a),!1}),i.on("click","ul.plane_history_list a",function(e){e.stopPropagation();var t=$(this).data("flightno"),i=parseInt($(this).data("timestamp"));return pf.uiController.dismissViewController(a,function(){pf.settings.setTransientValue("playbackSelectedFlightNo",t),pf.uiController.presentViewController(pf.uiController.playbackViewController),pf.uiController.playbackViewController.startPlaybackAtDate(i)}),!1})},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")}),this.container.animate({opacity:1,"margin-top":this.container.height()+"px"},500,function(){e()})},fetchPlaneHistoryData:function(){$(".loading",this.container).css("display","block");var c=$("ul",this.container),u=this;$.ajax({type:"GET",cache:!1,url:pf.settings.valueForKey("baseURL")+"endpoints/playback/planeHistory.php",data:{adshex:this.adshex},dataType:"jsonp",success:function(e){$(".loading, .error",u.container).css("display","none");var t=e.flights;if(0<e.flights.length)for(var i in t){var a=new Date(1e3*t[i].first_seen_ts),n=a.getFullYear(),s=a.getDate()<10?"0"+a.getDate():a.getDate(),r=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,o=a.getHours()<10?"0"+a.getHours():a.getHours(),l=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),p=(a.getSeconds()<10?a.getSeconds():a.getSeconds(),300*Math.round(t[i].first_seen_ts/300));p<t[i].first_seen_ts&&(p+=300),t[i].best_start_ts&&(p=t[i].best_start_ts);var h=$('<li id="previous-flight-'+i+'"><a href="#" data-flightno="'+t[i].flight_number+'" data-timestamp="'+p+'">Flight starting on '+s+"/"+r+"/"+n+" at "+o+":"+l+"</a></li>");c.append(h)}else $(".error",u.container).css("display","block")}})}}),PFShareViewController=PFModalViewController.extend({init:function(e,t){this._super(e,t);var i=$("div#share_view_template").clone().removeAttr("id");this.container.removeClass("loading").empty().append(i);var a=this;i.on("click","a.close_button_large",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(a),!1});var n=pf.settings.valueForKey("https")?"https://planefinder.net/":"http://planefinder.net/",s="Link to this website",r=n+"location/"+pf.map.center.toUrlValue()+","+pf.map.getZoom(),o="I'm using Plane Finder to track live flights",l="I'm using @planefinder to track a flight, why not check it out yourself?";t.plane&&(o="I'm tracking a live flight on Plane Finder",s="Link to this plane",r=n+"flight/"+t.plane.info.callsign,l="Spotted! "+t.plane.info.callsign+" ("+t.plane.info.flightno+") using",pf.uiController.playbackViewController.playbackActive()&&(r+="/time/"+new Date(1e3*pf.uiController.playbackViewController.currentTS).toISO()+"/speed/"+pf.uiController.playbackViewController.playbackSpeed()));var p="//twitter.com/intent/tweet/?text="+encodeURIComponent(l)+"&url="+encodeURIComponent(r)+"&related="+encodeURIComponent("planefinder"),h="//www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(r);$("div.social_buttons a.icon-twitter").prop("href",p),$("div.social_buttons a.icon-facebook").prop("href",h),$("div.social_buttons a.icon-mail").prop("href","mailto:?to=&subject="+encodeURIComponent(o)+"&body="+encodeURIComponent(l)+" "+encodeURIComponent(r)),$("h2.link_title",this.container).text(s),$("div.code_container.link_code input",this.container).val(r)},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")}),this.container.animate({opacity:1,"margin-top":this.container.height()+"px"},500,function(){e()})}}),PFMobileViewController=PFViewController.extend({init:function(e,t){this.container=e;var i="/views/templates/mobile/modal.view.php";t.isRoute?i+="?isRoute=1":t.flightNo&&(logEvent("mobile-modal",t.flightNo),i+="?flightno="+encodeURIComponent(t.flightNo),t.isPlayback&&(i+="&isPlayback=1",void 0!==t.speed&&(i+="&speed="+encodeURIComponent(t.speed)),void 0!==t.time&&(i+="&time="+encodeURIComponent(t.time)))),$("div.modal_content",this.container).load(i);var a=$(window).width(),n=$(window).height();this.fullscreen=!1,a<480||n<480?(this.fullscreen=!0,this.container.css({top:"100%"})):this.container.css({width:"370px",height:"550px","margin-top":"-260px","margin-left":"-160px",top:"100%",left:"50%"}),this.fullscreen?this.container.addClass("fullscreen"):this.container.removeClass("fullscreen");var s=this;this.container.on("click","a.close_button",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(s),!1})},unload:function(){$("div.modal_content",this.container).empty(),this._super()},present:function(){var e=this.container;this.fullscreen?(e.css({top:$(window).height()+"px",bottom:"0px",left:"0px",right:"0px",display:"block"}),e.animate({top:"0px"},500)):(e.css({display:"block"}),e.animate({top:"50%"},500))},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")});var t=this.fullscreen?"100%":$(window).height()+"px";this.container.animate({top:t},500,function(){e()})}}),PFLoginViewController=PFModalViewController.extend({init:function(e,t){this._super(e,t);var i=$("div#login_view_template").clone().removeAttr("id");this.container.removeClass("loading").empty().append(i);var a=this;i.on("click","a.close_button_large",function(e){return e.stopPropagation(),pf.uiController.dismissViewController(a),!1}),i.on("submit","form",function(e){return e.stopPropagation(),$('button[type="submit"]',a.container).text("Loading...").attr("disabled","disabled"),$.ajax({type:"POST",url:$("form",a.container).attr("action"),data:$("form",a.container).serialize()}).done(function(e,t,i){e.success&&!0===e.success?location.reload():(a.showError(e.payload),$('button[type="submit"]',a.container).text("Login").removeAttr("disabled"))}).fail(function(e,t,i){a.showError("An unspecified error occurred"),$('button[type="submit"]',a.container).text("Login").removeAttr("disabled")}),!1})},showError:function(e){$(".alert-danger",this.container).text(e).css("display","block")},dismissViewController:function(e){$("div#modal_overlay").css("display","block").animate({opacity:.5},500,function(){$(this).css("display","none")}),this.container.animate({opacity:1,"margin-top":this.container.height()+"px"},500,function(){e()})}}),PFSearchViewController=PFViewController.extend({init:function(){this._super(),this.searchTimer=null,this.searchResults=null,this.searchActive=null,this.remoteFlightSearch=null,this.load()},load:function(){this._super();var r=this,e=$("input#map_search_box");e.on("keyup",function(){clearTimeout(r.searchTimer),r.searchTimer=setTimeout(function(){r.performSearch(e.val())},500)}),$(document).mousedown(function(e){r.searchActive&&($(e.target).closest("#map_search_container").length||r.hideSearchResults())});$("div#map_search_container");$("div#map_search_results").on("click","a.result",function(e){e.stopPropagation();var t=$(this).attr("id").substring(7).split("-"),i=r.searchResults[t[0]].items[t[1]].object,a=r.searchResults[t[0]].items[t[1]].title;if(i)if(i.geometry){a&&logEvent("search_location_success",a);var n=pf.uiController.sidebarViewController?pf.settings.valueForKey("sidebarWidth")/2:0;pf.map.setZoom(8),pf.map.setCenterWithOffset(i.geometry.location,n,0),r.hideSearchResults()}else if(i.flightNo){a&&logEvent("search_flight_failed",a),r.hideSearchResults();var s=new PFPreviousFlightsViewController($("div#page_container_modal"),{flightNo:i.flightNo,height:"500px"});pf.uiController.presentModalViewController(s)}else if(i.adshex){a&&logEvent("search_plane_failed",a),r.hideSearchResults();s=new PFPlaneHistoryViewController($("div#page_container_modal"),{adshex:i.adshex,height:"500px"});pf.uiController.presentModalViewController(s)}else a&&logEvent("search_success",a),pf.uiController.setSelectedMarker(i,!0),r.hideSearchResults();return!1}),$("div#map_search_container a.close_button_large").on("click",function(e){return e.stopPropagation(),r.hideSearchResults(),!1})},performSearch:function(e){if(e.length){for(var t in e=e.toLowerCase(),this.searchResults=[{title:"Flight numbers",items:[]},{title:"Callsigns",items:[]},{title:"Registration numbers",items:[]},{title:"Hex codes",items:[]},{title:"Airports",items:[]},{title:"Locations",items:[]},{title:"Not currently tracked",items:[]},{title:"Codeshares",items:[]}],pf.planeController.planes){var i=pf.planeController.planes[t];i&&(i.info.callsign.substring(0,e.length).toLowerCase()==e?this.searchResults[1].items[this.searchResults[1].items.length]={title:i.info.callsign,subtitle:i.info.reg+", "+i.info.route_raw,object:i}:i.info.flightno.substring(0,e.length).toLowerCase()==e?this.searchResults[0].items[this.searchResults[0].items.length]={title:i.info.flightno,subtitle:i.info.reg+", "+i.info.route_raw,object:i}:i.info.reg.substring(0,e.length).toLowerCase()==e?this.searchResults[2].items[this.searchResults[2].items.length]={title:i.info.reg,subtitle:i.info.flightno+", "+i.info.route_raw,object:i}:i.info.adshex.substring(0,e.length).toLowerCase()==e&&(this.searchResults[3].items[this.searchResults[3].items.length]={title:i.info.adshex,subtitle:i.info.flightno+", "+i.info.route_raw,object:i}))}for(var a in pf.airportController.airports){var n=pf.airportController.airports[a];n&&n.info.name&&(n.info.name.substring(0,e.length).toLowerCase()==e?this.searchResults[4].items[this.searchResults[4].items.length]={title:n.info.name,subtitle:n.info.city+", "+n.info.country,object:n}:n.info.icao.substring(0,e.length).toLowerCase()==e?this.searchResults[4].items[this.searchResults[4].items.length]={title:n.info.icao,subtitle:n.info.name,object:n}:n.info.iata.substring(0,e.length).toLowerCase()==e&&(this.searchResults[4].items[this.searchResults[4].items.length]={title:n.info.iata,subtitle:n.info.name,object:n}))}var s=this;this.remoteFlightSearch&&(this.remoteFlightSearch.abort(),this.remoteFlightSearch=null),this.remoteFlightSearch=$.ajax({type:"GET",url:pf.settings.valueForKey("baseURL")+"endpoints/flightSearch.php",data:{queryText:e},dataType:"jsonp",success:function(e){s.parseRemoteFlightSearchResponse(e)}}),this.generateSearchResultHTML(),this.showSearchResults()}else this.hideSearchResults()},parseRemoteFlightSearchResponse:function(e){if(e.aircraft&&0<e.aircraft.length)for(var t=0;t<e.aircraft.length;t++){var i=e.aircraft[t],a=!1;for(var n in pf.planeController.planes){if((l=pf.planeController.planes[n])&&l.info.adshex==i.adshex){a=!0;break}}a||(this.searchResults[6].items[this.searchResults[6].items.length]={title:i.reg,subtitle:i.type+" - "+i.adshex,object:{adshex:i.adshex}})}if(e.flights&&0<e.flights.length)for(t=0;t<e.flights.length;t++){var s=e.flights[t],r=!1,o=s[4];for(var n in pf.planeController.planes){var l;if((l=pf.planeController.planes[n])&&(o&&(l.info.callsign==o||l.info.flightno==o)||l.info.callsign==s[0]||l.info.flightno==s[0])){o&&(this.searchResults[7].items[this.searchResults[7].items.length]={title:s[0],subtitle:"Operating as "+o,object:l}),r=!0;break}}r||(this.searchResults[6].items[this.searchResults[6].items.length]={title:s[0],subtitle:s[2]+" - "+s[3],object:{flightNo:s[0]}})}this.generateSearchResultHTML()},generateSearchResultHTML:function(){for(var e="",t=0;t<this.searchResults.length;t++)if(this.searchResults[t].items.length){e+='<h1 class="header">'+this.searchResults[t].title+"</h1>",e+='<div class="result_group">';for(var i=0;i<this.searchResults[t].items.length;i++){var a="";a+='<a href="#" id="result-'+t+"-"+i+'" class="result">',a+='<span class="title">'+this.searchResults[t].items[i].title+"</span>",a+='<span class="subtitle">'+this.searchResults[t].items[i].subtitle+"</span>",e+=a+="</a>"}e+="</div>"}$("div.results","#map_search_results").html(e),this.showSearchResults()},showSearchResults:function(){var e=$("div.results","#map_search_results").innerHeight();$("#map_search_container").addClass("showing_results"),$("#map_search_results").css({height:(e<400?e:400)+"px"}),this.searchActive=!0},hideSearchResults:function(){$("#map_search_container").removeClass("showing_results"),$("input#map_search_box").val(""),this.searchActive=!1}});function PFAirportBoardItem(e,t,i,a,n,s,r,o,l,p){return{flightNo:e,depApt:t,arrApt:i,terminal:r,gate:o,active:!1,statusInfo:PFFlightStatus(a,n,s,p,l)}}var PFAirportDetailViewController=PFViewController.extend({init:function(e){this._super(),this.airport=e.airport,this.data=null,this.expandedADSHEX=null},load:function(){this._super(),this.container=this.injectTemplateContent("airport_view"),this.listingTemplate=$("a.flight_listing.template",this.container).clone().removeClass("template"),this.departuresContainer=$('div.airport_board_list[data-id="departures"]',this.container),this.arrivalsContainer=$('div.airport_board_list[data-id="arrivals"]',this.container);var n=this;this.container.on("click","a.sidebar_close",function(e){return e.stopPropagation(),pf.uiController.hideSidebar(),!1}),this.container.on("click","a.flight_listing",function(e){e.stopPropagation();var t=$(this).data("flightno");for(var i in pf.planeController.planes){var a=pf.planeController.planes[i];if(a&&a.info.flightno==t)return pf.uiController.setSelectedMarker(a,!0),!1}var n=new PFPreviousFlightsViewController($("div#page_container_modal"),{flightNo:t,height:"500px"});return pf.uiController.presentModalViewController(n),!1}),this.container.on("click","div.settings_pillbox a",function(e){e.stopPropagation();var t=$(this).data("value"),i=$(this),a=i.parent();return $("a",a).removeClass("active"),i.addClass("active"),"arrivals"==t?(n.departuresContainer.removeClass("active"),n.arrivalsContainer.addClass("active")):(n.departuresContainer.addClass("active"),n.arrivalsContainer.removeClass("active")),!1}),this.updateTimer=setInterval(function(){n.fetchAirportData()},6e4),this.fetchAirportData()},unload:function(){this._super(),clearInterval(this.updateTimer)},viewWillAppear:function(){this._super()},viewDidAppear:function(){this._super(),pf.supportsHistory()&&window.history.replaceState("airport","Viewed airport","/airport/"+this.airport.info.iata),$("body").addClass("airport_view")},viewWillDisappear:function(){this._super(),$("body").removeClass("airport_view"),pf.uiController.selectedMarker()==this.airport&&pf.uiController.setSelectedMarker(!1,!1,!1)},viewDidDisappear:function(){this._super()},fetchAirportData:function(){var t=this;$.ajax({type:"GET",cache:!1,url:pf.settings.valueForKey("baseURL")+"api/api.php",data:{r:"airport",airportCode:this.airport.info.iata},dataType:"json",success:function(e){!0===e.success&&t.updateBoards(e.payload)},error:function(){}})},updateBoards:function(a){this.departuresContainer.empty(),this.arrivalsContainer.empty();var n=this,e=function(e,t){if($("div.no_flight_listing_message",e).remove(),a[t])n.processBoardItems(t,e,a[t]);else{var i=$("div#airport_view_live div.no_flight_listing_message.template").clone().removeClass("template");$("span.icon",i).addClass("departures"==t?"icon-outbound":"icon-inbound"),$("span.message",i).text("departures"==t?"No outbound flights found":"No inbound flights found"),e.append(i)}};e(this.departuresContainer,"departures"),e(this.arrivalsContainer,"arrivals")},processBoardItems:function(e,t,i){for(var a=[],n=0;n<i.length;n++){var s=i[n],r=PFAirportBoardItem(s.flightNumber,s.depApt,s.arrApt,"arrivals"==e?s.scheduledArrivalTime:s.scheduledDepartureTime,"arrivals"==e?s.estimatedArrivalTime:s.estimatedDepartureTime,s.actualArrivalTime,s.arrivalTerminal,s.arrivalGate,s.offset,s.cancelled);a[n]=r}for(var o in pf.planeController.planes){var l=pf.planeController.planes[o];for(n=0;n<a.length;n++)if(l.info.flightno==a[n].flightNo){a[n].active=!0;break}}a.sort(function(e,t){return parseInt(e.statusInfo.bestTime)-parseInt(t.statusInfo.bestTime)});for(n=0;n<a.length;n++){r=a[n];var p="departures"==e?r.arrApt:r.depApt,h=pf.airportController.airports[p];if(h){var c=r.flightNo;if(c){r.terminal&&(c+=" &middot; Terminal "+r.terminal,r.gate&&(c+=" (Gate "+r.gate+")"));var u=this.listingTemplate.clone();u.attr("data-flightno",r.flightNo),r.active&&u.addClass("live");var d="";if("cancelled"!=r.statusInfo.status){if(r.statusInfo.actualTime){var f=r.statusInfo.actualTime;if("ontime"==r.statusInfo.status)d="departures"==e?"Departed on-time":"Arrived on-time";else if("early"==r.statusInfo.status){d=("departures"==e?"Departed":"Arrived")+" "+Math.abs(parseInt((f-r.statusInfo.scheduledTime)/60))+" mins early"}else if("late"==r.statusInfo.status){d=("departures"==e?"Departed":"Arrived")+" "+Math.abs(parseInt((f-r.statusInfo.scheduledTime)/60))+" mins late"}}else if(r.statusInfo.estimatedTime){f=r.statusInfo.estimatedTime;if("ontime"==r.statusInfo.status)d="departures"==e?"Due to depart on-time":"Due to arrive on-time";else if("early"==r.statusInfo.status){d=("departures"==e?"Departing":"Arriving")+" "+Math.abs(parseInt((f-r.statusInfo.scheduledTime)/60))+" mins early"}else if("late"==r.statusInfo.status){d=("departures"==e?"Departing":"Arriving")+" "+Math.abs(parseInt((f-r.statusInfo.scheduledTime)/60))+" mins late"}}else d="Due to "+("departures"==e?"depart":"arrive")+" on-time";"late"==r.statusInfo.status&&$(u).addClass("late")}else d="Flight has been cancelled",$("*",u).css("opacity","0.3");$("span.airport",u).text(h.info.city+" ("+p+")"),$("span.flight-info",u).html(c),$("span.status",u).text(d),$("span.time",u).text(r.statusInfo.formattedBestTime()),t.append(u)}}}},isEqualTo:function(e){return e instanceof PFAirportDetailViewController&&e.airport==this.airport}});function PFFlightStatus(i,a,n,e,s){var r,t="cancelled";return e||(t=n?i+900<n?"late":n<i-900?"early":"ontime":a?i+900<a?"late":a<i-900?"early":"ontime":"ontime"),{formattedBestTime:function(){var e="airport"==pf.settings.valueForKey("airportTZUnit"),t=new Date(1e3*(r+(e?s:0)));return pf.getFormattedHHMMTime(t,e)},formattedScheduledTime:function(){var e="airport"==pf.settings.valueForKey("airportTZUnit"),t=new Date(1e3*(i+(e?s:0)));return pf.getFormattedHHMMTime(t,e)},formattedEstimatedTime:function(){var e="airport"==pf.settings.valueForKey("airportTZUnit"),t=new Date(1e3*(a+(e?s:0)));return pf.getFormattedHHMMTime(t,e)},formattedActualTime:function(){var e="airport"==pf.settings.valueForKey("airportTZUnit"),t=new Date(1e3*(n+(e?s:0)));return pf.getFormattedHHMMTime(t,e)},status:t,bestTime:r=n||(a||i),scheduledTime:i,estimatedTime:a,actualTime:n,cancelled:e}}var PFPlaneDetailViewController=PFViewController.extend({init:function(e){this._super(),this.backgroundJingle=null,this.dynamicTimer=null,this.uiTimer=null,this.photos=[],this.arrAirport=null,this.depAirport=null,this.depStatus=null,this.arrStatus=null,this.container=null,this.plane=e.plane},load:function(){if(this._super(),this.container=this.injectTemplateContent("plane_details_view"),"S4NTA1"==this.plane.adshex){var e=$(".sidebar_section_hidden",this.container),t=0;e.each(function(){0<t&&$(this).addClass("showing_content"),t++})}var i=this;this.container.on("click",".sidebar_section_hidden a",function(e){e.stopPropagation(),$(this).parent().toggleClass("showing_content")}),this.container.on("click",".flight_map_preview_container a",function(e){e.stopPropagation(),location.href="https://planefinder.net/endpoints/exportKML.php?adshex="+i.plane.info.adshex}),this.container.on("click","a.sidebar_close",function(e){return e.stopPropagation(),pf.uiController.hideSidebar(),!1}),this.container.on("click","a.sidebar_share",function(e){e.stopPropagation();var t=new PFShareViewController($("div#page_container_modal"),{plane:i.plane,height:"400px"});return pf.uiController.presentModalViewController(t),!1}),this.container.on("click","div.plane_photograph_thumbnail_container a",function(e){if(e.stopPropagation(),$(this).parent().hasClass("no_image"))window.location.href="http://my.pinkfroot.com";else{var t=new PFImageGalleryViewController($("div#page_container_modal"),{photos:i.photos,width:"640px",height:"480px"});pf.uiController.presentModalViewController(t)}return!1}),this.dynamicTimer=setInterval(function(){pf.settings.transientValueForKey("isMobile")||i.fetchData(!0)},2e4),this.uiTimer=setInterval(function(){i.updateDynamicValues()},1e3),this.fetchData(!1)},unload:function(){this._super(),clearInterval(this.dynamicTimer),this.dynamicTimer=null,clearInterval(this.uiTimer),this.uiTimer=null},viewWillAppear:function(){this._super(),pf.isBlockingAds()&&($("ins.adsbygoogle",this.container).css("display","none"),$(".pf_block_message",this.container).css("display","block")),$("#map_zoom_controls").addClass("show_flightpath_button")},viewDidAppear:function(){if(this._super(),pf.supportsHistory()){var e="/flight/"+this.plane.info.callsign;if(pf.uiController.playbackViewController.playbackActive())e+="/time/"+new Date(1e3*pf.uiController.playbackViewController.currentTS).toISO()+"/speed/"+pf.uiController.playbackViewController.playbackSpeed();window.history.replaceState("flight","Viewed flight",e)}logPlaneEvent("/flight/"+this.plane.info.callsign),this.plane.isSanta&&pf.playSantaClauseAudio()},viewWillDisappear:function(){this._super(),this.plane.isSanta&&pf.stopSantaClauseAudio(),$("#map_zoom_controls").removeClass("show_flightpath_button"),pf.uiController.selectedMarker()==this.plane&&pf.uiController.setSelectedMarker(!1,!1,!1),pf.setFocusModeEnabled(!1)},fetchData:function(t){var e={r:"aircraftMetadata",adshex:this.plane.info.adshex,flightno:this.plane.info.flightno,callsign:this.plane.info.callsign,type:this.plane.info.planeType,isPlayback:0,isPoll:t?1:0},i=this;$.ajax({type:"GET",cache:!0,url:pf.settings.valueForKey("baseURL")+"api/api.php",data:e,dataType:"json",timeout:pf.settings.valueForKey("planePollTimeout"),success:function(e){!0===e.success&&(t?i.parseStatusData(e.payload):i.parseData(e.payload))},error:function(){}})},parseBasicPlaneData:function(){var e=this.plane.info,t=e.reg&&"z.NO-REG"!=e.reg&&"zNO-REG"!=e.reg?e.reg:null,i=e.flightno&&0<e.flightno.length?e.flightno:null,a=e.callsign&&0<e.callsign.length&&"z.NO-"!=e.callsign.substr(0,"z.NO-".length)?e.callsign:null,n="";i&&(n+=i),a&&(n+=(0<n.length?" / ":"")+a),this.setValue('[data-id="title"]',n,void 0,!1),this.setValue('[data-id="callsign_value"]',a,void 0,!1),this.setValue('[data-id="flightno_value"]',i,void 0,!1),this.setValue('[data-id="reg_value"]',t,void 0,!1),this.setValue('[data-id="speed_value"]',pf.getFormattedSpeed(e.speed),void 0,!1),this.setValue('[data-id="altitude_value"]',pf.getFormattedAltitude(e.altitude),void 0,!1),this.setValue('[data-id="course_value"]',pf.getFormattedHeading(e.heading),void 0,!1);var s="ADS-B";1==e.planeType?s="MLAT":11==e.planeType?s="FLARM":12==e.planeType?s="FAA":80==e.planeType&&(s="Estimated"),this.setValue('[data-id="source_value"]',s)},parseData:function(e){var t=this.plane.info;if(this.parseBasicPlaneData(),e.photos&&0<e.photos.length){var i=e.photos[0].thumbnailPath;$(".plane_photograph_thumbnail_container").removeClass("no_image").css("background-image","url("+i+")"),this.photos=e.photos}else $(".plane_photograph_thumbnail_container").addClass("no_image");if(e.statusData){var a=e.statusData.departureApt;a||e.flightData.routing&&1<e.flightData.routing.length&&(a=e.flightData.routing[0]),this.depAirport=pf.airportController.airports[a],null!=this.depAirport&&(this.setValue('[data-id="dep_apt_code"]',this.depAirport.info.iata,"N/A",!1),this.setValue('[data-id="dep_apt_city"]',this.depAirport.info.city,"N/A",!1));var n=e.statusData.arrivalApt;n||e.flightData.routing&&1<e.flightData.routing.length&&(n=e.flightData.routing[e.flightData.routing.length-1]),this.arrAirport=pf.airportController.airports[n],this.arrAirport&&(this.setValue('[data-id="arr_apt_code"]',this.arrAirport.info.iata,"N/A",!1),this.setValue('[data-id="arr_apt_city"]',this.arrAirport.info.city,"N/A",!1))}if(e.aircraftData){var s=e.aircraftData.airlineICAO,r="https://flightstat.planefinder.net/v1/getImage.php?airlineCode="+s+"&aircraftType="+e.aircraftData.typeCode+"&skipFuzzy=1";$(".aircraft_technical_image",this.container).css("background-image","url("+r+")");var o="https://flightstat.planefinder.net/v2/getLogo3x.php?airlineCode="+s+"&requestThumb=0&hex="+this.plane.info.adshex;$(".airline_logo",this.container).css("background-image","url("+o+")"),this.setValue('[data-id="aircraft_type_value"]',e.aircraftData.aircraftFullType),this.setValue('[data-id="age_value"]',e.aircraftData.aircraftAgeString),this.setValue('[data-id="first_flight_value"]',e.aircraftData.firstFlightDate);var l=t.adshex&&t.adshex.length<=6?t.adshex:null;this.setValue('[data-id="adshex_value"]',l),this.setValue('[data-id="rollout_value"]',e.aircraftData.rolloutDate),this.setValue('[data-id="delivered_value"]',e.aircraftData.deliveredDate),this.setValue('[data-id="registered_value"]',e.aircraftData.registeredDate),this.setValue('[data-id="type_value"]',e.aircraftData.typeCode),this.setValue('[data-id="con_no_value"]',e.aircraftData.constructionNumber),this.setValue('[data-id="line_no_value"]',e.aircraftData.lineNumber),this.setValue('[data-id="engines_value"]',e.aircraftData.engineString),this.setValue('[data-id="operator_value"]',e.aircraftData.aicraftOperator),this.setValue('[data-id="itc_callsign_value"]',e.aircraftData.airlineATCCallsign)}if(e.flightData&&(this.setValue('[data-id="freight_capacity_value"]',e.flightData.freightCapacity?e.flightData.freightCapacity+" tonnes":null),this.setValue('[data-id="seats_value"]',e.flightData.seats),this.setValue('[data-id="freight_class_value"]',e.flightData.freightClass),this.setValue('[data-id="service_type_value"]',e.flightData.serviceType),e.flightData.passengerClasses&&this.setValue('[data-id="passenger_classes_value"]',e.flightData.passengerClasses.join(", ")),e.flightData.codeshares&&this.setValue('[data-id="codeshares_value"]',e.flightData.codeshares.join(", ")),$(".day_of_operation",this.container).removeClass("active open_cap close_cap middle single"),!pf.settings.transientValueForKey("isNativelySupportedMobile")&&e.flightData.daysOfOperation)){for(var p=[!1,!1,!1,!1,!1,!1,!1],h=e.flightData.daysOfOperation,c=0;c<h.length;c++){p[h.substring(c,c+1)-1]=!0}var u=-1;for(c=0;c<p.length;c++){if(p[c]){var d=c+1;if(-1==u){u=c;var f="open_cap";(d>=p.length||d<p.length&&!p[d])&&(f="single",u=-1),$('.day_of_operation[data-day="'+(c+1)+'"]',this.container).addClass("active "+f)}else{f="middle";(d>=p.length||d<p.length&&!p[d])&&(f="close_cap",u=-1),$('.day_of_operation[data-day="'+(c+1)+'"]',this.container).addClass("active "+f)}}}}this.parseStatusData(e),$(".sidebar_content_container",this.container).removeClass("loading")},parseStatusData:function(e){if(e.dynamic&&(this.setValue('[data-id="tas_value"]',e.dynamic.trueAirSpeed?pf.getFormattedSpeed(e.dynamic.trueAirSpeed):null),this.setValue('[data-id="ias_value"]',e.dynamic.indicatedAirSpeed?pf.getFormattedSpeed(e.dynamic.indicatedAirSpeed):null),this.setValue('[data-id="mach_value"]',e.dynamic.mach),this.setValue('[data-id="vert_rate_value"]',e.dynamic.vertRate?e.dynamic.vertRate+"ft/min":null),this.setValue('[data-id="selected_alt_value"]',e.dynamic.selectedAltitude?pf.getFormattedAltitude(e.dynamic.selectedAltitude):null),this.setValue('[data-id="roll_angle_value"]',e.dynamic.rollAngle?e.dynamic.rollAngle+"°":null),this.setValue('[data-id="mag_heading_value"]',e.dynamic.magneticHeading?e.dynamic.magneticHeading+"°":null),this.setValue('[data-id="target_heading_value"]',e.dynamic.targetHeading?e.dynamic.targetHeading+"°":null),this.setValue('[data-id="track_angle_value"]',e.dynamic.trackAngle?e.dynamic.trackAngle+"°":null),this.setValue('[data-id="wind_direction_value"]',e.dynamic.windDirection?e.dynamic.windDirection+"°":null),this.setValue('[data-id="wind_speed_value"]',e.dynamic.windSpeed?pf.getFormattedSpeed(e.dynamic.windSpeed):null),this.setValue('[data-id="air_temp_value"]',e.dynamic.outsideAirTemperature?e.dynamic.outsideAirTemperature+"°C":null),this.setValue('[data-id="squawk_value"]',this.plane.info.squawk),this.setValue('[data-id="barometer_value"]',e.dynamic.barometer?e.dynamic.barometer+" hPa":null)),e.statusData&&e.statusData.arrSchdUTC){this.arrStatus=PFFlightStatus(e.statusData.arrSchdUTC,e.statusData.arrEstUTC,e.statusData.arrActUTC,!1,e.statusData.arrOffset);var t=null;this.arrStatus.actualTime?t=this.arrStatus.formattedActualTime():this.arrStatus.estimatedTime&&(t=this.arrStatus.formattedEstimatedTime()),$('[data-id="arr_time_act_label"]',this.container).text(this.arrStatus.actualTime?"ACT":"EST"),this.setValue('[data-id="arr_time_act_value"]',t,"N/A",!1),this.setValue('[data-id="arr_time_schd_value"]',this.arrStatus.formattedScheduledTime(),"N/A",!1),this.arrStatus&&"late"==this.arrStatus.status?$("#plane_details_view_live").addClass("late"):$("#plane_details_view_live").removeClass("late"),this.arrStatus&&(this.arrStatus.estimatedTime||this.arrStatus.actualTime)&&$('[data-id="arr_time_act_dot"]',this.container).css({display:"inline-block","background-image":"late"==this.arrStatus.status||"cancelled"==this.arrStatus.status?"url(/public/img/ui/late-dot.png)":"url(/public/img/ui/ontime-dot.png)"})}if(e.statusData&&e.statusData.depSchdUTC){this.depStatus=PFFlightStatus(e.statusData.depSchdUTC,e.statusData.depEstUTC,e.statusData.depActUTC,!1,e.statusData.depOffset);t=null;this.depStatus.actualTime?t=this.depStatus.formattedActualTime():this.depStatus.estimatedTime&&(t=this.depStatus.formattedEstimatedTime()),$('[data-id="dep_time_act_label"]',this.container).text(this.depStatus.actualTime?"ACT":"EST"),this.setValue('[data-id="dep_time_act_value"]',t,"N/A",!1),this.setValue('[data-id="dep_time_schd_value"]',this.depStatus.formattedScheduledTime(),"N/A",!1),this.depStatus&&(this.depStatus.estimatedTime||this.depStatus.actualTime)&&$('[data-id="dep_time_act_dot"]',this.container).css({display:"inline-block","background-image":"late"==this.depStatus.status||"cancelled"==this.depStatus.status?"url(/public/img/ui/late-dot.png)":"url(/public/img/ui/ontime-dot.png)"})}e.statusData&&(e.statusData.depSchdUTC||e.statusData.arrSchdUTC)||$(".status_data",this.container).css({display:"none"}),this.updateDynamicValues()},updateDynamicValues:function(){var e=0;if(this.arrAirport&&this.depAirport){var t=google.maps.geometry.spherical.computeDistanceBetween(this.plane.getPosition(),this.depAirport.getPosition()),i=google.maps.geometry.spherical.computeDistanceBetween(this.plane.getPosition(),this.arrAirport.getPosition()),a=google.maps.geometry.spherical.computeDistanceBetween(this.arrAirport.getPosition(),this.depAirport.getPosition()),n=621371e-9*t,s=621371e-9*i;this.setValue('[data-id="distance_flown_value"]',pf.getFormattedDistance(n,1),"N/A",!1),this.setValue('[data-id="distance_remaining_value"]',pf.getFormattedDistance(s,1),"N/A",!1),this.depStatus&&this.arrStatus&&(this.setValue('[data-id="departure_countdown_value"]',pf.getFormattedTimeDiff(this.depStatus.bestTime)+" ago","N/A",!1),this.setValue('[data-id="arrival_countdown_value"]',"in "+pf.getFormattedTimeDiff(this.arrStatus.bestTime),"N/A",!1)),e=100*(1-t/a)}else e=100;e<0&&(e=0),100<e&&(e=100),$(".progress-bar",this.container).css("right",e+"%")},setValue:function(e,t,i,a){i=void 0===i?"Unknown":i,(a=void 0===a||a)&&pf.settings.transientValueForKey("isNativelySupportedMobile")&&(t="&#128274;");var n=i;t&&0<t.length?n=t:$(e,this.container).parent().addClass("no_data"),$(e,this.container).html(n)},update:function(){this.parseBasicPlaneData()},isEqualTo:function(e){return e instanceof PFPlaneDetailViewController&&e.plane==this.plane}}),PFSettingsViewController=PFViewController.extend({init:function(e){this._super()},load:function(){this._super(),this.container=this.injectTemplateContent("settings_view"),this.container.on("click","a.sidebar_close",function(e){return e.stopPropagation(),pf.uiController.hideSidebar(),!1}),this.container.on("click","a.settings_tickbox",function(e){e.stopPropagation();var t=!$(this).hasClass("on"),i=t?"off":"on",a=t?"on":"off";return $(this).removeClass(i).addClass(a),pf.settings.setValue($(this).data("setting-key"),t),!1}),this.container.on("click","div.settings_pillbox a",function(e){e.stopPropagation();var t=$(this),i=t.parent();return $("a",i).removeClass("active"),t.addClass("active"),pf.settings.setValue(i.data("setting-key"),t.data("setting-value")),"planeLabelContent"==i.data("setting-key")&&$("#plane_label_text_content").css("display","text"==t.data("setting-value")?"block":"none"),!1}),this.container.on("change","select",function(e){pf.settings.setValue($(this).data("setting-key"),$(this).val())}),this.mapDimSlider=noUiSlider.create($("div.map_dim_slider",this.container).get(0),{start:100*parseFloat(pf.settings.valueForKey("mapFadeValue")),orientation:"horizontal",connect:[!0,!1],range:{min:pf.settings.valueForKey("mapMinFadeValue"),max:pf.settings.valueForKey("mapMaxFadeValue")}}),this.mapDimSlider.on("update",function(e,t){pf.settings.setValue("mapFadeValue",parseFloat(e[0]/100))}),pf.settings.valueForKey("showAirports")&&$("a.settings_tickbox[data-setting-key=showAirports]",this.container).removeClass("off").addClass("on"),pf.settings.valueForKey("showDayNightOverlay")&&$("a.settings_tickbox[data-setting-key=showDayNightOverlay]",this.container).removeClass("off").addClass("on"),pf.settings.valueForKey("showPersistentFlightPaths")&&$("a.settings_tickbox[data-setting-key=showPersistentFlightPaths]",this.container).removeClass("off").addClass("on"),pf.settings.valueForKey("followSelectedPlane")&&$("a.settings_tickbox[data-setting-key=followSelectedPlane]",this.container).removeClass("off").addClass("on"),pf.settings.valueForKey("disableFlightEstimation")&&$("a.settings_tickbox[data-setting-key=disableFlightEstimation]",this.container).removeClass("off").addClass("on");var e=pf.settings.valueForKey("planeLabelContent");e&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=planeLabelContent]",this.container),e),pf.settings.valueForKey("planeLabelLine1Item1")&&$("select[data-setting-key=planeLabelLine1Item1] option",this.container).each(function(){this.selected=$(this).val()==pf.settings.valueForKey("planeLabelLine1Item1")}),pf.settings.valueForKey("planeLabelLine1Item2")&&$("select[data-setting-key=planeLabelLine1Item2] option",this.container).each(function(){this.selected=$(this).val()==pf.settings.valueForKey("planeLabelLine1Item2")}),pf.settings.valueForKey("planeLabelLine2Item1")&&$("select[data-setting-key=planeLabelLine2Item1] option",this.container).each(function(){this.selected=$(this).val()==pf.settings.valueForKey("planeLabelLine2Item1")}),pf.settings.valueForKey("planeLabelLine2Item2")&&$("select[data-setting-key=planeLabelLine2Item2] option",this.container).each(function(){this.selected=$(this).val()==pf.settings.valueForKey("planeLabelLine2Item2")}),pf.settings.valueForKey("planeLabelLine3Item1")&&$("select[data-setting-key=planeLabelLine3Item1] option",this.container).each(function(){this.selected=$(this).val()==pf.settings.valueForKey("planeLabelLine3Item1")}),pf.settings.valueForKey("planeLabelLine3Item2")&&$("select[data-setting-key=planeLabelLine3Item2] option",this.container).each(function(){this.selected=$(this).val()==pf.settings.valueForKey("planeLabelLine3Item2")}),$("#plane_label_text_content",this.container).css("display","text"==pf.settings.valueForKey("planeLabelContent")?"block":"none");var t=pf.settings.valueForKey("markerColor");t&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=markerColor]",this.container),t);var i=pf.settings.valueForKey("mapTypeV2");i&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=mapTypeV2]",this.container),i);var a=pf.settings.valueForKey("speedUnit");a&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=speedUnit]",this.container),a);var n=pf.settings.valueForKey("altitudeUnit");n&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=altitudeUnit]",this.container),n);var s=pf.settings.valueForKey("distanceUnit");s&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=distanceUnit]",this.container),s);var r=pf.settings.valueForKey("airportUnit");r&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=airportUnit]",this.container),r);var o=pf.settings.valueForKey("airportTZUnit");o&&this.setPillboxValue($("div.settings_pillbox[data-setting-key=airportTZUnit]",this.container),o)},setPillboxValue:function(e,t){$("a",e).removeClass("active"),$("a[data-setting-value="+t+"]").addClass("active")},isEqualTo:function(e){return e instanceof PFSettingsViewController}}),PFBookmarksViewController=PFViewController.extend({init:function(e){this._super()},load:function(){this._super(),this.container=this.injectTemplateContent("bookmark_view"),this.template=$("li.bookmark_list_item_template",this.container).clone().removeClass("bookmark_list_item_template"),this.bookmarkList=$("div.bookmarks_list ul",this.container),this.constructBookmarkList();var s=this;this.container.on("click","a.sidebar_close",function(e){return e.stopPropagation(),pf.uiController.hideSidebar(),!1}),this.container.on("click","a.create_button",function(e){return e.stopPropagation(),s.showCreateScreen(),$("input.bookmark_create_name",this.container).focus(),!1}),this.container.on("click","a.save_button",function(e){e.stopPropagation();var t=pf.settings.valueForKey("bookmarks"),i=pf.map.getCenter();return t[t.length]=[$("input.bookmark_create_name",this.container).val(),i.lat().toFixed(2),i.lng().toFixed(2),pf.map.getZoom(),0],s.constructBookmarkList(),s.showListScreen(),pf.settings.save(),!1}),this.container.on("click","a.hover_delete_button",function(e){e.stopPropagation();var t=$(this).parent().attr("data-bookmark-id");return pf.settings.valueForKey("bookmarks").splice(t,1),s.constructBookmarkList(),pf.settings.save(),!1}),this.container.on("click","a.bookmark_default_toggle",function(e){e.stopPropagation();for(var t=$(this).parent().attr("data-bookmark-id"),i=pf.settings.valueForKey("bookmarks"),a=i[t][4],n=0;n<i.length;n++)i[n][4]=0;return a||(i[t][4]=1),s.constructBookmarkList(),pf.settings.save(),!1}),this.container.on("click","a.bookmark_info",function(e){e.stopPropagation();var t=$(this).parent().attr("data-bookmark-id"),i=pf.settings.valueForKey("bookmarks");return pf.map.setCenter(new google.maps.LatLng(i[t][1],i[t][2])),pf.map.setZoom(i[t][3]),!1})},isEqualTo:function(e){return e instanceof PFBookmarksViewController},showCreateScreen:function(){$("input.bookmark_create_name",this.container).val(""),$("div.bookmarks_list",this.container).css("display","none"),$("div.bookmark_create_form",this.container).css("display","block")},showListScreen:function(){$("div.bookmarks_list",this.container).css("display","block"),$("div.bookmark_create_form",this.container).css("display","none")},constructBookmarkList:function(){this.bookmarkList.empty();var e=pf.settings.valueForKey("bookmarks");if(e.length){e.sort(function(e,t){var i=e[0].toUpperCase(),a=t[0].toUpperCase();return i<a?-1:a<i?1:0});for(var t=0;t<e.length;t++){var i=e[t],a=this.template.clone();a.attr("data-bookmark-id",t),$("span.bookmark_name",a).text(i[0]),$("span.bookmark_coords",a).text(i[1]+", "+i[2]),i[4]&&$("a.bookmark_default_toggle",a).addClass("active"),this.bookmarkList.append(a)}}}}),PFFiltersViewController=PFViewController.extend({init:function(e){this._super(),this.speedSlider=!1,this.altitudeSlider=!1},load:function(){this._super();var s=this;this.container=this.injectTemplateContent("filters_view"),this.filtersList=$("div.filters_list ul",this.container),this.filtersListItemTemplate=$("li.filters_list_item_template",this.container).clone().removeClass("filters_list_item_template"),this.editingFilterId=!1,this.speedSlider=noUiSlider.create($("div.speed_slider",this.container).get(0),{start:[pf.settings.valueForKey("minSpeedFilterValue"),pf.settings.valueForKey("maxSpeedFilterValue2")],orientation:"horizontal",connect:!0,range:{min:pf.settings.valueForKey("minSpeedFilterValue"),max:pf.settings.valueForKey("maxSpeedFilterValue2")}}),this.speedSlider.on("update",function(e,t){s.updateSpeedSliderValue(e)}),this.altitudeSlider=noUiSlider.create($("div.altitude_slider",this.container).get(0),{start:[pf.settings.valueForKey("minAltitudeFilterValue"),pf.settings.valueForKey("maxAltitudeFilterValue2")],orientation:"horizontal",connect:!0,range:{min:pf.settings.valueForKey("minAltitudeFilterValue"),max:pf.settings.valueForKey("maxAltitudeFilterValue2")}}),this.altitudeSlider.on("update",function(e,t){s.updateAltitudeSliderValue(e)}),this.updateAltitudeSliderValue([pf.settings.valueForKey("minAltitudeFilterValue"),pf.settings.valueForKey("maxAltitudeFilterValue2")]),this.updateSpeedSliderValue([pf.settings.valueForKey("minSpeedFilterValue"),pf.settings.valueForKey("maxSpeedFilterValue2")]),this.container.on("click","a.create_button",function(e){return e.stopPropagation(),s.showCreateScreen(!1),!1}),this.container.on("click","a.hover_delete_button",function(e){e.stopPropagation();var t=$(this).parent().attr("data-filter-id");return pf.settings.valueForKey("filters").splice(t,1),pf.planeController.applyUserFilters(),pf.settings.save(),s.constructFiltersList(),!1}),this.container.on("click","a.filter_active_toggle",function(e){e.stopPropagation();var t=$(this).parent().attr("data-filter-id"),i=pf.settings.valueForKey("filters");return i[t].active=!i[t].active,pf.settings.save(),pf.planeController.applyUserFilters(),s.constructFiltersList(),!1}),this.container.on("click","a.filter_info",function(e){e.stopPropagation();var t=$(this).parent().attr("data-filter-id");return s.showCreateScreen(t),!1}),this.container.on("click","a.save_button",function(e){return e.stopPropagation(),s.saveFilter(s.editingFilterId),pf.settings.save(),pf.planeController.applyUserFilters(),!1}),this.container.on("click","a.cancel_button",function(e){return e.stopPropagation(),s.showListScreen(),!1}),this.container.on("click","a.add_field",function(e){e.stopPropagation();var t=$(this).parents("li"),i=$("li.template",t).clone();i.removeClass("template").addClass("live"),$("ul.options",t).append(i);var a=$("input",i),n=a.attr("data-filter-key");return"airline"!=n&&"aircraft"!=n&&"airport"!=n||(s.addAutocompleteForField(i),a.focus()),!1}),this.container.on("click","a.remove_field",function(e){return e.stopPropagation(),$(this).parent().remove(),!1}),this.container.on("click","div.settings_pillbox a",function(e){e.stopPropagation();var t=$(this),i=t.parent();return $("a",i).removeClass("active"),t.addClass("active"),!1}),$(document).on("PFFiltersReapplied",function(e,t){s.constructFiltersList()});s=this;this.container.on("click","a.sidebar_close",function(e){return e.stopPropagation(),pf.uiController.hideSidebar(),!1}),this.showListScreen()},isEqualTo:function(e){return e instanceof PFFiltersViewController},loadFilter:function(e){var t=pf.settings.valueForKey("filters")[e];if(void 0===t.fleet&&(t.fleet=[]),void 0===t.excludedTrafficSources&&(t.excludedTrafficSources=[]),t.airlines.length)for(var i=$("ul.airline_filter_list",this.container),a=$("li.template",i),n=0;n<t.airlines.length;n++){var s=t.airlines[n],r=a.clone().removeClass("template").addClass("live");$("input[data-filter-key=airline]",r).val(s),i.append(r),this.addAutocompleteForField(r)}if(t.aircrafts.length)for(i=$("ul.aircraft_filter_list",this.container),a=$("li.template",i),n=0;n<t.aircrafts.length;n++){var o=t.aircrafts[n];r=a.clone().removeClass("template").addClass("live");$("input[data-filter-key=aircraft]",r).val(o),i.append(r),this.addAutocompleteForField(r)}if(t.airports.length)for(i=$("ul.airport_filter_list",this.container),a=$("li.template",i),n=0;n<t.airports.length;n++){var l=t.airports[n];r=a.clone().removeClass("template").addClass("live");$("input[data-filter-key=airport]",r).val(l[0]),$(".settings_pillbox a",r).removeClass("active"),$(".settings_pillbox a[data-setting-value="+l[1]+"]",r).addClass("active"),i.append(r),this.addAutocompleteForField(r)}if(t.squawks.length)for(i=$("ul.squawk_filter_list",this.container),a=$("li.template",i),n=0;n<t.squawks.length;n++){var p=t.squawks[n];r=a.clone().removeClass("template").addClass("live");$("input[data-filter-key=squawk]",r).val(p),i.append(r)}if(t.fleet.length)for(i=$("ul.fleet_filter_list",this.container),a=$("li.template",i),n=0;n<t.fleet.length;n++){var h=t.fleet[n];r=a.clone().removeClass("template").addClass("live");$("input[data-filter-key=fleet]",r).val(h),i.append(r)}if($(".excluded_traffic_source_container input").prop("checked",!0),t.excludedTrafficSources.length)for(var n in t.excludedTrafficSources){var c=t.excludedTrafficSources[n];$(".excluded_traffic_source_container input[name=traffic-source-"+c+"]").prop("checked",!1)}this.speedSlider.set(t.speed),this.altitudeSlider.set(t.altitude),$("input[data-filter-key=filter_name]",this.container).removeClass("placeholder").val(t.name)},saveFilter:function(e){var t=$("input[data-filter-key=filter_name]",this.container),i=$("li.live input[data-filter-key=airline]",this.container),a=$("li.live input[data-filter-key=aircraft]",this.container),n=$("li.live div.airport_listing",this.container),s=$("li.live input[data-filter-key=squawk]",this.container),r=$("li.live input[data-filter-key=fleet]",this.container),o=$(".excluded_traffic_source_container input",this.container),l=this.speedSlider.get(),p=this.altitudeSlider.get(),h=[],c=[],u=[],d=[],f=[],g=[];i.length&&i.each(function(){var e=$(this).val();$.trim(e).length&&(h[h.length]=e)}),a.length&&a.each(function(){var e=$(this).val();$.trim(e).length&&(c[c.length]=e)}),n.length&&n.each(function(){var e=$("input[data-filter-key=airport]",$(this)).val();if($.trim(e).length){var t=e,i=$("div.settings_pillbox a.active",$(this)).data("setting-value");f[f.length]=[t,parseInt(i)]}}),s.length&&s.each(function(){var e=$(this).val();$.trim(e).length&&(u[u.length]=e)}),r.length&&r.each(function(){var e=$(this).val();$.trim(e).length&&(d[d.length]=e)}),o.length&&o.each(function(){if(!$(this).is(":checked")){var e=$(this).attr("name"),t=parseInt(e.substring(e.lastIndexOf("-")+1));g[g.length]=t}});var m=!0;e&&(m=(y=pf.settings.valueForKey("filters")[e]).active);var v=t.val();$.trim(v).length||(v="Untitled");var y={name:v,airlines:h,aircrafts:c,airports:f,squawks:u,fleet:d,excludedTrafficSources:g,speed:l,altitude:p,active:m,numMatches:0},_=pf.settings.valueForKey("filters");e?_[this.editingFilterId]=y:_[_.length]=y,pf.settings.setValue("filters",_),pf.settings.save(),this.showListScreen()},addAutocompleteForField:function(e){var i=$("input",e),t=i.attr("data-filter-key"),a=0;"aircraft"==t?a=1:"airport"==t&&(a=2),i.autocomplete({minLength:2,request:function(e,i){$.ajax({url:pf.settings.valueForKey("baseURL")+"endpoints/autocomplete.php",dataType:"jsonp",data:{searchType:a,searchText:e},success:function(e){var t=$.map(e,function(e){return{label:e.title,value:e.data}});i(t)}})},select:function(e,t){i.focus().val(t)}})},constructFiltersList:function(){this.filtersList.empty();var e=pf.settings.valueForKey("filters");if(0<e.length){e.sort(function(e,t){var i=e.name,a=t.name;return i<a?-1:a<i?1:0});for(var t=0;t<e.length;t++){var i=e[t],a=this.filtersListItemTemplate.clone();a.attr("data-filter-id",t),$("span.filter_name",a).text(i.name),$("span.filter_matches",a).text(i.numMatches+" planes matching"),i.active&&$("a.filter_active_toggle",a).addClass("active"),this.filtersList.append(a)}this.filtersList.css("display","block"),$(".info_message",this.container).css("display","none")}else this.filtersList.css("display","none"),$(".info_message",this.container).css("display","block")},resetCreateScreen:function(){$("input[data-filter-key=filter_name]",this.container).val(""),$("li.live",this.container).remove(),$(".excluded_traffic_source_container input").prop("checked",!0),this.speedSlider.set([pf.settings.valueForKey("minSpeedFilterValue"),pf.settings.valueForKey("maxSpeedFilterValue2")]),this.altitudeSlider.set([pf.settings.valueForKey("minAltitudeFilterValue"),pf.settings.valueForKey("maxAltitudeFilterValue2")])},showCreateScreen:function(e){this.resetCreateScreen(),this.editingFilterId=e,$("div.filters_list",this.container).css("display","none"),$("div.filter_create_form",this.container).css("display","block"),this.editingFilterId&&this.loadFilter(this.editingFilterId)},showListScreen:function(){this.editingFilter=!1,this.constructFiltersList(),$("div.filters_list",this.container).css("display","block"),$("div.filter_create_form",this.container).css("display","none")},updateSpeedSliderValue:function(e){var t=pf.getFormattedSpeed(e[0]),i=pf.getFormattedSpeed(e[1]);$("div.speed_slider_container div.slider_value",this.container).text(t+" - "+i)},updateAltitudeSliderValue:function(e){var t=pf.getFormattedAltitude(e[0]),i=pf.getFormattedAltitude(e[1]);$("div.altitude_slider_container div.slider_value",this.container).text(t+" - "+i)}});function PFPlaybackViewController(){this.playbackControl=null,this.playbackActive_=!1,this.playbackPaused_=!1,this.datePicker=!1,this.hasPopulated=!1,this.hasLoaded=!1,this.hasChangedDateTime=!1,this.renderingEnabled=!1,this.renderRequestID=null,this.speedSlider=!1;var e=Math.round((new Date).getTime()/1e3)-86400;e-=e%300,this.startDate=new Date(1e3*e),this.playbackSpeed_=1,this.lastRemoteUpdateTS=this.lastRemoteRequestTS=this.lastUpdateTS=this.timelineTS=this.currentTS=pf.unixTimestamp(),this.container=$("div.playback_controls_template").clone(),this.container.removeClass("playback_controls_template").attr("id","playback_controls"),$("div#ui_container").append(this.container)}PFPlaybackViewController.prototype.load=function(){if(!this.hasLoaded){var a=this;this.playbackHourSelector=$("select[name=playback_time_hour]",this.container),this.playbackHourSelector.val(this.startDate.getHours()),this.playbackMinuteSelector=$("select[name=playback_time_mins]",this.container),this.playbackMinuteSelector.val(this.startDate.getMinutes());this.speedSlider=noUiSlider.create($("div.playback_speed_slider",this.container).get(0),{start:15,orientation:"horizontal",connect:[!0,!1],range:{min:pf.settings.valueForKey("minPlaybackSpeed"),max:pf.settings.valueForKey("maxPlaybackSpeed")}}),this.speedSlider.on("update",function(e,t){a.playbackSpeed_=e[0];var i=parseInt(e[0]/pf.settings.valueForKey("maxPlaybackSpeed")*116);$("div#playback_speed_helper").html('<span class="value">'+e[0]+"X Speed</span>Drag to change").css("left",i+"px")});var e=parseInt(15/pf.settings.valueForKey("maxPlaybackSpeed")*116);$("div#playback_speed_helper").html('<span class="value">15X Speed</span>Drag to change').css("left",e+"px"),$("input.playback_date").on("focus",function(e){$(this).addClass("showing")}),$("input.playback_date").on("blur",function(e){$(this).removeClass("showing")}),$("select",this.container).on("change",function(e){a.hasChangedDateTime=!0});var t=$("input.playback_date",this.container).get(0);this.datePicker=new Pikaday({field:t,minDate:new Date(1301616e6),maxDate:new Date,onSelect:function(e){t.value=a.datePicker.toString(),a.hasChangedDateTime=!0,t.blur()}}),this.datePicker.setDate(this.startDate),$(this.container).on("click","a.icon-close",function(e){e.stopPropagation(),a.playbackActive()&&a.stopPlayback(!0),pf.uiController.dismissViewController(a)}),$(this.container).on("click","a.playback_control",function(e){e.stopPropagation();var t=!0;Math.floor(Date.now()/1e3)-a.tsRepresentedByUI()<600&&(console.log("Can't start future playback!"),t=!1),1==t&&(a.playbackPaused()?a.hasChangedDateTime?a.startPlaybackAtDate(a.tsRepresentedByUI()):a.setPlaybackPaused(!1):a.playbackActive()?a.setPlaybackPaused(!0):(a.startPlaybackAtDate(a.tsRepresentedByUI()),a.setPlaybackPaused(!1)),a.hasChangedDateTime=!1)}),this.hasLoaded=!0}},PFPlaybackViewController.prototype.unload=function(){this.playbackControl&&(this.playbackControl.unload(),delete this.playbackControl,this.playbackControl=null)},PFPlaybackViewController.prototype.viewWillAppear=function(){$("body").addClass("playback_visible")},PFPlaybackViewController.prototype.dismissViewController=function(e){$("body").removeClass("playback_visible"),e()},PFPlaybackViewController.prototype.tsRepresentedByUI=function(){var e=this.datePicker.getDate(),t=$("select[name=playback_time_hour]",this.container).val(),i=$("select[name=playback_time_mins]",this.container).val();return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t,i,0,0).getTime()/1e3},PFPlaybackViewController.prototype.startPlaybackAtDate=function(e){var t=e-e%300;this.currentTS=e,this.hasPopulated=!1,pf.planeController.setLiveUpdatesActive(!1),this.setPlaybackActive(!0),this.setPlaybackPaused(!1),$("#visible_planes_counter").addClass("playback_active"),this.startRendering(),this.requestRemoteUpdate(t)},PFPlaybackViewController.prototype.stopPlayback=function(e){this.setPlaybackActive(!1),e&&pf.planeController.setLiveUpdatesActive(!0),this.stopRendering(),pf.updateDayNightOverlay(),$("#visible_planes_counter").removeClass("playback_active")},PFPlaybackViewController.prototype.queueRenderRequest=function(){var a=this;this.renderRequestID=window.requestAnimationFrame(function(e){if(a.renderingEnabled){var t=Date.now(),i=parseFloat(t-a.lastRenderTS)/1e3;a.render(i),a.lastRenderTS=t,a.queueRenderRequest()}})},PFPlaybackViewController.prototype.requestRemoteUpdate=function(e){var t=this,i={utc:new Date(1e3*e).toUTC(),loc:e},a=!0;Math.floor(Date.now()/1e3)-i.utc<600&&t.playbackActive()&&(a=!1,t.stopPlayback(!0),pf.uiController.dismissViewController(t)),1==a&&$.ajax({type:"GET",cache:!0,url:pf.settings.valueForKey("baseURL")+"endpoints/playback/update.php",data:i,jsonpCallback:"planePlaybackDataCallbackV2",dataType:"jsonp",success:function(e){t.handleRemoteData(e)},error:this.handleUpdateError}),this.lastRemoteRequestTS=e},PFPlaybackViewController.prototype.handleRemoteData=function(e){this.lastRemoteUpdateTS=e.locTS,this.currentTS=e.locTS;var t=$("input.playback_date",this.container).get(0),i=new Date(1e3*this.currentTS).toLocaleDateString("UTC",{day:"numeric",weekday:"short",year:"numeric",month:"short"});for(var a in t.value=i,e.planes)if(void 0!==e.planes[a]){var n=e.planes[a],s=n[9];null!=n[16]&&(s=google.maps.geometry.spherical.computeHeading(new google.maps.LatLng(n[6],n[7]),new google.maps.LatLng(n[16][0],n[16][1])))<0&&(s=360+s);var r=new google.maps.LatLng(n[6],n[7]),o=pf.planeController.planes[a];o||(o=new PFPlaneMarker(data),pf.planeController.planes[a]=o),o.lastAccuratePosition=r,o.lastAccuratelyUpdatedTS=n,o.setPosition(r),o.info.flight_id=n[0],o.info.type=n[1],o.info.adshex=n[2],o.info.reg=n[3],o.info.callsign=n[4],o.info.flightno=n[5],o.info.altitude=parseInt(n[8]),o.info.heading=Math.round(s),o.info.speed=parseInt(n[10]),o.info.mtime=parseInt(n[11]);var l=n[14];l!==o.info.route_raw&&(o.info.route_raw=l,o.info.route_array=l?l.split("-"):[]),o.info.airline=n[13],o.info.planeType=n[15],o.info.markerType=findMarkerSourceForType(n[1]),o.info.squawk=n[12],o.info.decimalAdshex=parseInt(a,16),o.playbackLastAccuratePosition=o.getPosition(),o.playbackDestinationPosition=null!=n[16]?new google.maps.LatLng(n[16][0],n[16][1]):null,o.handleDataUpdate(this.currentTS)}for(var a in pf.planeController.planes)pf.planeController.planes[a]&&pf.planeController.planes[a].flightPath&&pf.planeController.planes[a].parseFlightPath(pf.planeController.planes[a].flightPath);var p=[];for(a in pf.planeController.planes)void 0===e.planes[a]&&(p[p.length]=a);for(var h=0;h<p.length;h++)pf.planeController.planes[p[h]].willRemove(),delete pf.planeController.planes[p[h]];if(pf.quadtreeController.rebuild(!0),pf.planeController.applyUserFilters(),!this.hasPopulated){var c=pf.settings.valueForKey("playbackSelectedFlightNo"),u=pf.settings.valueForKey("playbackSelectedHex");if(c){for(var a in pf.planeController.planes)if(null!=pf.planeController.planes[a]&&(pf.planeController.planes[a].info.flightno==c||pf.planeController.planes[a].info.callsign==c)){pf.uiController.setSelectedMarker(pf.planeController.planes[a],!0);break}}else if(u)for(var a in pf.planeController.planes)if(null!=pf.planeController.planes[a]&&a==u){pf.uiController.setSelectedMarker(pf.planeController.planes[a],!0);break}this.hasPopulated=!0}pf.updateDayNightOverlay(),pf.canvasOverlay.needsRedraw=!0},PFPlaybackViewController.prototype.startRendering=function(){this.renderingEnabled=!0,this.lastRenderTS=Date.now(),this.queueRenderRequest()},PFPlaybackViewController.prototype.stopRendering=function(){this.renderingEnabled=!1,this.renderRequestID&&window.cancelAnimationFrame(this.renderRequestID)},PFPlaybackViewController.prototype.render=function(e){if(this.playbackActive()&&!this.playbackPaused()){pf.unixTimestamp();var t=e*this.playbackSpeed();this.currentTS+=t,300<this.currentTS-this.lastRemoteRequestTS&&this.requestRemoteUpdate(this.lastRemoteRequestTS+300);var i=new Date(1e3*this.currentTS);this.playbackHourSelector.val(i.getHours());var a=i.getMinutes();a%5==0&&this.playbackMinuteSelector.val(a);var n=(this.currentTS-this.lastRemoteUpdateTS)/300;for(var s in 1<n&&(n=1),pf.planeController.planes)if(pf.planeController.planes[s]){var r=pf.planeController.planes[s];if(null!==r.playbackLastAccuratePosition&&null!==r.playbackDestinationPosition){var o=google.maps.geometry.spherical.interpolate(r.playbackLastAccuratePosition,r.playbackDestinationPosition,n);r.setPosition(o)}}var l=i.toHumanReadable();$("span.playback_time").text(l),pf.canvasOverlay.needsRedraw=!0}},PFPlaybackViewController.prototype.playbackActive=function(){return this.playbackActive_},PFPlaybackViewController.prototype.setPlaybackActive=function(e){pf.quadtreeController.clear(),(this.playbackActive_=e)?($("a.playback_control",this.container).addClass("paused"),$("select, input",this.container).prop("disabled","disabled")):(this.setPlaybackPaused(!1),$("a.playback_control",this.container).removeClass("paused"),$("select, input",this.container).prop("disabled",!1))},PFPlaybackViewController.prototype.playbackPaused=function(){return this.playbackPaused_},PFPlaybackViewController.prototype.setPlaybackPaused=function(e){(this.playbackPaused_=e)?($("a.playback_control",this.container).removeClass("paused"),$("select, input",this.container).prop("disabled",!1)):($("a.playback_control",this.container).addClass("paused"),$("select, input",this.container).prop("disabled","disabled"))},PFPlaybackViewController.prototype.playbackSpeed=function(){return this.playbackSpeed_},PFPlaybackViewController.prototype.setPlaybackSpeed=function(e){e=parseInt(e);var t=pf.settings.valueForKey("minPlaybackSpeed"),i=pf.settings.valueForKey("maxPlaybackSpeed");e<t&&(e=t),i<e&&(e=i),this.playbackSpeed_=e,this.speedSlider.set(e)};var PFUIController=Class.extend({init:function(){this.selectedMarker_=!1,this.highlightedMarker_=!1,this.isShowingDropdownMenu=!1,this.sidebarViewController=!1,this.modalViewController=!1,this.tooltip=$("#tooltip"),this.searchViewController=new PFSearchViewController,this.playbackViewController=new PFPlaybackViewController,pf.settings.valueForKey("newsDisabled")||(this.newsFlashController=new PFNewsFlashController)},start:function(){this.setupMapControls()},setupMapControls:function(){var i=this;if($("#cookie_warning a.dismiss-btn").on("click",function(e){e.stopPropagation(),$("body").removeClass("show_cookie_warning"),pf.settings.setValue("hasDismissedCookieWarning",!0)}),!pf.settings.valueForKey("isEU")||pf.settings.valueForKey("isInternallyEmbedded")||pf.settings.valueForKey("isEmbedded")||pf.settings.valueForKey("hasDismissedCookieWarning")||$("body").addClass("show_cookie_warning"),pf.settings.valueForKey("isWanted")&&!pf.settings.valueForKey("isInternallyEmbedded")&&!pf.settings.valueForKey("isEmbedded")&&!pf.settings.valueForKey("hasDismissedReceiverOffer")){var e=new PFWebViewController($("div#page_container_modal"),{title:"Can you help?",url:"/public/messaging/receiver-help.php?countryCode="+pf.settings.valueForKey("countryCode"),width:"470px",height:"470px"});pf.settings.setValue("hasDismissedReceiverOffer",!0),pf.uiController.presentModalViewController(e)}$("a#login_button").on("click",function(e){e.stopPropagation();var t=new PFLoginViewController($("div#page_container_modal"),{height:"375px"});return i.presentModalViewController(t),!1}),$("a#map_zoom_in").on("click",function(e){e.stopPropagation();var t=pf.map.getZoom()+1;return t>pf.mapOpts.maxZoom&&(t=pf.mapOpts.maxZoom),pf.map.setZoom(t),!1}),$("a#map_zoom_out").on("click",function(e){e.stopPropagation();var t=pf.map.getZoom()-1;return t<pf.mapOpts.minZoom&&(t=pf.mapOpts.minZoom),pf.map.setZoom(t),!1}),$("a#map_zoom_route").on("click",function(e){return e.preventDefault(),pf.setFocusModeEnabled(!pf.focusModeEnabled),!1}),$(".navigation_dropdown > ul > li > a").on("click",function(e){var t=$(this).parent();if(0<$("ul",t).length)return $(this).parent().addClass("expand"),!(i.isShowingDropdownMenu=!0)}),$(".navigation_dropdown > ul > li").on("mouseleave",function(e){return $(this).removeClass("expand"),i.isShowingDropdownMenu=!1}),$(".navigation_dropdown > ul > li > ul > li > a").on("click",function(e){$(this).parent().parent().parent().removeClass("expand")}),$("a#map_settings").on("click",function(e){e.stopPropagation();var t=new PFSettingsViewController(null);return i.showSidebar(t),!1}),$("a#map_bookmarks").on("click",function(e){e.stopPropagation();var t=new PFBookmarksViewController(null);return i.showSidebar(t),!1}),$("a#map_playback").on("click",function(e){return e.stopPropagation(),i.presentViewController(i.playbackViewController),!1}),$("a#map_filters").on("click",function(e){e.stopPropagation();var t=new PFFiltersViewController(null);return i.showSidebar(t),!1}),$("a#map_sharing").on("click",function(e){e.stopPropagation();var t=new PFShareViewController($("div#page_container_modal"),{height:"400px"});return i.presentModalViewController(t),!1})},highlightedMarker:function(){return this.highlightedMarker_},setHighlightedMarker:function(e){this.highlightedMarker_!==e&&(this.highlightedMarker_&&(this.highlightedMarker_.setHighlighted(!1),this.highlightedMarker_=!1),e&&(e.setHighlighted(!0),this.highlightedMarker_=e),pf.canvasOverlay.needsRedraw=!0)},selectedMarker:function(){return this.selectedMarker_},setSelectedMarker:function(e,t,i){if(arguments.length<2&&(t=!1),arguments.length<3&&(i=!0),e!==this.selectedMarker_){if(this.selectedMarker_&&(this.selectedMarker_.setSelected(!1),e&&this.selectedMarker_ instanceof PFPlaneMarker&&(this.selectedMarker_.lastSelectedTS=0)),e){if(e.setSelected(!0),!t)pf.mapProjectionOverlay.getProjection().fromLatLngToContainerPixel(e.getPosition()).x<300&&600<$(window).width()&&pf.map.setCenterWithOffset(e.getPosition(),pf.settings.valueForKey("sidebarWidth")/2,0)}else i&&this.hideSidebar();t&&(pf.map.setZoom(e instanceof PFAirportMarker?14:10),pf.map.setCenterWithOffset(e.getPosition(),pf.settings.valueForKey("sidebarWidth")/2,0)),this.selectedMarker_=e}},deselectAllMarkers:function(){this.hideSidebar(),this.setSelectedMarker(null),pf.planeController.hideAllFlightPaths()},showSidebar:function(e){this.sidebarViewController&&this.sidebarViewController.isEqualTo(e)||(e.load(),e.viewWillAppear&&e.viewWillAppear(),this.sidebarViewController?(e.viewWillDisappear&&this.sidebarViewController.viewWillDisappear(),e.viewWillAppear&&e.viewWillAppear(),e.viewDidDisappear&&this.sidebarViewController.viewDidDisappear(),e.viewDidAppear&&e.viewDidAppear(),this.sidebarViewController.unload()):($("body").addClass("sidebar_visible"),e.viewDidAppear&&e.viewDidAppear(),$(document).trigger("PFSidebarDidAppear",null)),this.sidebarViewController=e)},hideSidebar:function(){if(this.sidebarViewController){var e=this.sidebarViewController;e.viewWillDisappear&&e.viewWillDisappear(),$("body").removeClass("sidebar_visible"),e.viewDidDisappear(),e.unload(),$("div#sidebar_container").removeClass("active").empty(),$(document).trigger("PFSidebarDidDisappear",null)}pf.updateURLWithBounds(!0),this.sidebarViewController=!1},presentViewController:function(e){e.load(),e.viewWillAppear&&e.viewWillAppear(),e.viewDidAppear&&e.viewDidAppear()},presentModalViewController:function(e){e.load(),e.viewWillAppear&&e.viewWillAppear(),e.viewDidAppear&&e.viewDidAppear();var t=e.container;t.css({"margin-top":$(window).height()+"px",display:"block"}),$("div#modal_overlay").css("display","block").animate({opacity:.5},500),t.animate({opacity:1,"margin-top":-$(t).height()/2+"px"},500),this.modalViewController=e},presentMobileViewController:function(e){e.load(),e.viewWillAppear(),e.viewDidAppear(),$("div#modal_overlay").css("display","block").animate({opacity:.5},500),e.present(),this.modalViewController=e},dismissViewController:function(e,t){t=t||null;var i=this;e.viewWillDisappear&&e.viewWillDisappear(),e.dismissViewController(function(){e.viewDidDisappear&&e.viewDidDisappear(),e.unload(),i.modalViewController==e&&(i.modalViewController.container.css("display","none"),i.modalViewController=!1),t&&t()})}});function PFNewsFlashController(){this.container=$("div#map_footer_social_updates"),this.template=$(".template",this.container),this.isInitialNewsLoad=!0,this.currentIndex=0,this.items=[],this.requestLatestNewsUpdate();var e=this;if(this.updateInterval=setInterval(function(){e.requestLatestNewsUpdate()},PFNewsFlashController.kUpdateTime),$("body").on("click","a.hide_ads_btn",function(e){e.preventDefault(),PFPresentSubscriptionPurchaseModal()}),pf.isBlockingAds())return $("#map_banner_ad").css("display","none"),void $("#map_mobile_ad_button").css("display","block");$("#map_banner_ad").length&&$("#map_banner_ad").css("display","block")}function PFNewAshCloudOverlay(e){function t(e){google.maps.OverlayView.call(this),this.info=e,this.setMap(pf.map)}return(t.prototype=new google.maps.OverlayView).onAdd=function(){this.div=document.createElement("div"),this.div.className="volcano",this.getPanes().overlayImage.appendChild(this.div);for(var e=0;e<this.info.coords.length;e++){for(var t=[],i=0;i<this.info.coords[e].length;i++)t.push(new google.maps.LatLng(this.info.coords[e][i][0],this.info.coords[e][i][1]));t.length&&(this.polygon=new google.maps.Polygon({paths:t,strokeColor:"#424242",strokeOpacity:.8,strokeWeight:2,fillColor:"#6c6c6c",fillOpacity:.35,clickable:!1}),this.polygon.setMap(pf.map))}this.position=new google.maps.LatLng(this.info.position[0],this.info.position[1]),this.draw()},t.prototype.draw=function(){if(this.div&&null!==this.getMap()){var e=this.getProjection().fromLatLngToDivPixel(this.position),t=parseInt(e.x)-16+"px",i=parseInt(e.y)-16+"px";this.div.style.left=t,this.div.style.top=i}},new t(e)}function PFPlaneMarker(){this.info={},this.lastUpdatedTS=null,this.lastAccuratePosition=null,this.lastAccuratelyUpdatedTS=null,this.playbackLastAccuratePosition=null,this.playbackDestinationPosition=null,this.hasFetchedMetadata=!1,this.tooltip=!1,this.cachedFlightPathData=!1,this.flightPath=!1,this.flightPathBounds=!1,this.lastFlightPathPointTS=0,this.estimatedFlightPath=!1,this.flightPathAttached=!1,this.position=null,this.highlighted_=!1,this.selected_=!1,this.visible_=!0,this.screenPosition={x:0,y:0},this.size={w:0,h:0},this.cachedLabelMetrics_=null;var e="@"+Math.min(2,pf.canvasOverlay.pixelScale)+"x";this.spritesheetURL=pf.settings.valueForKey("baseURL")+"public/img/markers/atlas"+e+".png?v="+pf.settings.valueForKey("deploymentVersion"),this.lastSelectedTS=0,this.headingRad=0,this.clampRotation=!1,this.canShowAirlineLogo=!1}function PFAirportMarker(e){this.info={name:e[0],city:e[1],country:e[2],iata:e[3],icao:e[4],altitude:0},this.position=new google.maps.LatLng(e[5],e[6]),this.popularAirport=parseInt(e[7]),this.visible=parseInt(e[9]),this.selected=!1,this.highlighted=!1,this.decimalAdshex=0,this.screenPosition={x:0,y:0},this.size={x:38,y:38},this.cachedLabelMetrics=null}function PFMat4(e){function t(e){for(i=0;i<16;i++)M[i]=e[i]}var M=new Float32Array(16);return e&&t(e),{v:M,set:t,inverse:function(){var e=M[0],t=M[1],i=M[2],a=M[3],n=M[4],s=M[5],r=M[6],o=M[7],l=M[8],p=M[9],h=M[10],c=M[11],u=M[12],d=M[13],f=M[14],g=M[15],m=e*s-t*n,v=e*r-i*n,y=e*o-a*n,_=t*r-i*s,b=t*o-a*s,w=i*o-a*r,P=l*d-p*u,C=l*f-h*u,x=l*g-c*u,F=p*f-h*d,k=p*g-c*d,S=h*g-c*f,T=m*S-v*k+y*F+_*x-b*C+w*P;return T?(T=1/T,M[0]=(s*S-r*k+o*F)*T,M[1]=(-t*S+i*k-a*F)*T,M[2]=(d*w-f*b+g*_)*T,M[3]=(-p*w+h*b-c*_)*T,M[4]=(-n*S+r*x-o*C)*T,M[5]=(e*S-i*x+a*C)*T,M[6]=(-u*w+f*y-g*v)*T,M[7]=(l*w-h*y+c*v)*T,M[8]=(n*k-s*x+o*P)*T,M[9]=(-e*k+t*x-a*P)*T,M[10]=(u*b-d*y+g*m)*T,M[11]=(-l*b+p*y-c*m)*T,M[12]=(-n*F+s*C-r*P)*T,M[13]=(e*F-t*C+i*P)*T,M[14]=(-u*_+d*v-f*m)*T,M[15]=(l*_-p*v+h*m)*T,this):null}}}function PFTexture(e,t){var i=e.context;function a(e){return 0==(e&e-1)}var n=i.createTexture();return n?(i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),a(t.width)&&a(t.height)?i.generateMipmap(i.TEXTURE_2D):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)),{bind:function(){i.bindTexture(i.TEXTURE_2D,n)}}):null}function PFShader(e,t,i){var a=e.context;function n(e,t){var i=a.createShader(t);return e="precision mediump float;\n"+e,a.shaderSource(i,e),a.compileShader(i),a.getShaderParameter(i,a.COMPILE_STATUS)?i:(a.deleteShader(i),null)}var s=n(t,a.VERTEX_SHADER),r=n(i,a.FRAGMENT_SHADER),o=a.createProgram();return a.attachShader(o,s),a.attachShader(o,r),a.linkProgram(o),a.getProgramParameter(o,a.LINK_STATUS)?{bind:function(){o&&a.useProgram(o)},attribute:function(e){if(o)return a.getAttribLocation(o,e)},uniform:function(e){if(o)return a.getUniformLocation(o,e)}}:(console.error("Failed to link shader"),null)}function PFCanvasRendererGL(e,u){var t=u.getContext("webgl");if(t){var i="        varying mediump vec2 v_uv;        varying mediump vec2 v_uvSize;        varying mat2 v_rot;        uniform sampler2D u_tex;        const vec2 center = vec2(0.5, 0.5);                void main() {            mediump vec2 rot_coord = v_rot * (gl_PointCoord - center) + center;            gl_FragColor = texture2D(u_tex, (rot_coord * v_uvSize + v_uv));        }    ",a="        attribute vec2 a_position;        attribute float a_size;        attribute vec2 a_uv;        attribute vec3 a_sizeAndRotation;        uniform mat4 u_viewMat;        uniform mat4 u_projMat;        varying mediump vec2 v_uv;        varying mediump vec2 v_uvSize;        varying mat2 v_rot;        void main() {            mediump float angle = a_sizeAndRotation.z;            v_rot = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));            v_uv = a_uv;            v_uvSize = a_sizeAndRotation.xy;                        gl_PointSize = a_size;            gl_Position = u_projMat * u_viewMat * vec4(a_position, 0.0, 1.0);        }    ",n=null,d=null,s=PFMat4.orthographic(0,u.clientWidth,u.clientHeight,0,.1,100),r=PFMat4.translation(0,0,1).inverse(),o=t.createBuffer(),f=(t.createBuffer(),0),g=0,m=new Float32Array(16e4),l=0,p=0;return t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.disable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),{beginFrame:function(){if(g=f=0,markersRendered=0,u.width==l&&u.height==p||(l=u.width,p=u.height,s=PFMat4.orthographic(0,u.width,0,u.height,.1,100),t.viewport(0,0,u.width,u.height)),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),null===n){n=PFShader(this,a,i),t.bindBuffer(t.ARRAY_BUFFER,o);var e=n;t.vertexAttribPointer(e.attribute("a_position"),2,t.FLOAT,!1,32,0),t.enableVertexAttribArray(e.attribute("a_position")),t.vertexAttribPointer(e.attribute("a_size"),1,t.FLOAT,!1,32,8),t.enableVertexAttribArray(e.attribute("a_size")),t.vertexAttribPointer(e.attribute("a_uv"),2,t.FLOAT,!1,32,12),t.enableVertexAttribArray(e.attribute("a_uv")),t.vertexAttribPointer(e.attribute("a_sizeAndRotation"),3,t.FLOAT,!1,32,20),t.enableVertexAttribArray(e.attribute("a_sizeAndRotation"))}},endFrame:function(){if(null!==d&&0!=f){t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,m,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,o);var e=n;n.bind(),t.uniformMatrix4fv(e.uniform("u_projMat"),!1,s.v),t.uniformMatrix4fv(e.uniform("u_viewMat"),!1,r.v),t.uniform1i(e.uniform("u_tex"),0),t.activeTexture(t.TEXTURE0),d.bind(),t.drawArrays(t.POINTS,0,g)}},saveState:function(){},restoreState:function(){},drawImage:function(e,t,i,a,n,s,r,o,l,p,h,c){null===d&&(d=PFTexture(this,e)),g+=1,r=u.height-r,m[f+0]=s,m[f+1]=r,m[f+2]=Math.max(o*p,l*h),m[f+3]=t,m[f+4]=i,m[f+5]=a,m[f+6]=n,m[f+7]=-c,f+=8},isGL:!0,context:t}}console.error("Failed to find WebGL context")}function PFCanvasRenderer2D(e,t){this.layer=e,this.canvas=t,this.context=t.getContext("2d")}function PFInputHandler(e){this.body=$("body"),this.validClick=!1,this.clickTimeout=null,this.canvas=e,this.touches={startX:0,startY:0,currentX:0,currentY:0,lastTS:null,reset:function(){this.startX=0,this.startY=0,this.currentX=0,this.currentY=0}}}function PFCanvasOverlayFactory(e){function t(e){var t=document.createElement("canvas");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.right=0,t.style.bottom=0,t.style.zIndex=5,t.style.pointerEvents="none",this.canvas=t,this.markerAtlasMetadata={A300_R:{px_rect:[0,0,36,43],gl_coords:[0,0,.0703125,.083984375]},A300_R_S:{px_rect:[46,0,26,31],gl_coords:[.08984375,0,.05078125,.060546875]},A300_B:{px_rect:[82,0,36,43],gl_coords:[.16015625,0,.0703125,.083984375]},A300_B_S:{px_rect:[128,0,26,31],gl_coords:[.25,0,.05078125,.060546875]},A320_R:{px_rect:[164,0,28,30],gl_coords:[.3203125,0,.0546875,.05859375]},A320_R_S:{px_rect:[202,0,21,21],gl_coords:[.39453125,0,.041015625,.041015625]},A320_B:{px_rect:[233,0,29,30],gl_coords:[.455078125,0,.056640625,.05859375]},A320_B_S:{px_rect:[272,0,21,22],gl_coords:[.53125,0,.041015625,.04296875]},A321_R:{px_rect:[303,0,29,34],gl_coords:[.591796875,0,.056640625,.06640625]},A321_R_S:{px_rect:[342,0,21,25],gl_coords:[.66796875,0,.041015625,.048828125]},A321_B:{px_rect:[373,0,29,34],gl_coords:[.728515625,0,.056640625,.06640625]},A321_B_S:{px_rect:[412,0,21,25],gl_coords:[.8046875,0,.041015625,.048828125]},A330_R:{px_rect:[443,0,38,40],gl_coords:[.865234375,0,.07421875,.078125]},A330_R_S:{px_rect:[0,53,28,29],gl_coords:[0,.103515625,.0546875,.056640625]},A330_B:{px_rect:[38,53,38,40],gl_coords:[.07421875,.103515625,.07421875,.078125]},A330_B_S:{px_rect:[86,53,28,29],gl_coords:[.16796875,.103515625,.0546875,.056640625]},A340_R:{px_rect:[124,53,36,42],gl_coords:[.2421875,.103515625,.0703125,.08203125]},A340_R_S:{px_rect:[170,53,26,30],gl_coords:[.33203125,.103515625,.05078125,.05859375]},A340_B:{px_rect:[206,53,35,42],gl_coords:[.40234375,.103515625,.068359375,.08203125]},A340_B_S:{px_rect:[251,53,26,30],gl_coords:[.490234375,.103515625,.05078125,.05859375]},A350_R:{px_rect:[287,53,38,38],gl_coords:[.560546875,.103515625,.07421875,.07421875]},A350_R_S:{px_rect:[335,53,27,27],gl_coords:[.654296875,.103515625,.052734375,.052734375]},A350_B:{px_rect:[372,53,38,38],gl_coords:[.7265625,.103515625,.07421875,.07421875]},A350_B_S:{px_rect:[420,53,27,27],gl_coords:[.8203125,.103515625,.052734375,.052734375]},A380_R:{px_rect:[457,53,41,37],gl_coords:[.892578125,.103515625,.080078125,.072265625]},A380_R_S:{px_rect:[0,105,30,27],gl_coords:[0,.205078125,.05859375,.052734375]},A380_B:{px_rect:[40,105,41,38],gl_coords:[.078125,.205078125,.080078125,.07421875]},A380_B_S:{px_rect:[91,105,29,27],gl_coords:[.177734375,.205078125,.056640625,.052734375]},B737_R:{px_rect:[130,105,30,32],gl_coords:[.25390625,.205078125,.05859375,.0625]},B737_R_S:{px_rect:[170,105,22,23],gl_coords:[.33203125,.205078125,.04296875,.044921875]},B737_B:{px_rect:[202,105,30,32],gl_coords:[.39453125,.205078125,.05859375,.0625]},B737_B_S:{px_rect:[242,105,22,23],gl_coords:[.47265625,.205078125,.04296875,.044921875]},B747_R:{px_rect:[274,105,37,44],gl_coords:[.53515625,.205078125,.072265625,.0859375]},B747_R_S:{px_rect:[321,105,27,32],gl_coords:[.626953125,.205078125,.052734375,.0625]},B747_B:{px_rect:[358,105,37,44],gl_coords:[.69921875,.205078125,.072265625,.0859375]},B747_B_S:{px_rect:[405,105,26,32],gl_coords:[.791015625,.205078125,.05078125,.0625]},B757_R:{px_rect:[441,105,32,38],gl_coords:[.861328125,.205078125,.0625,.07421875]},B757_R_S:{px_rect:[483,105,23,27],gl_coords:[.943359375,.205078125,.044921875,.052734375]},B757_B:{px_rect:[0,159,32,38],gl_coords:[0,.310546875,.0625,.07421875]},B757_B_S:{px_rect:[42,159,22,27],gl_coords:[.08203125,.310546875,.04296875,.052734375]},B767_R:{px_rect:[74,159,38,43],gl_coords:[.14453125,.310546875,.07421875,.083984375]},B767_R_S:{px_rect:[122,159,28,31],gl_coords:[.23828125,.310546875,.0546875,.060546875]},B767_B:{px_rect:[160,159,38,43],gl_coords:[.3125,.310546875,.07421875,.083984375]},B767_B_S:{px_rect:[208,159,27,31],gl_coords:[.40625,.310546875,.052734375,.060546875]},B777_R:{px_rect:[245,159,38,44],gl_coords:[.478515625,.310546875,.07421875,.0859375]},B777_R_S:{px_rect:[293,159,27,32],gl_coords:[.572265625,.310546875,.052734375,.0625]},B777_B:{px_rect:[330,159,38,44],gl_coords:[.64453125,.310546875,.07421875,.0859375]},B777_B_S:{px_rect:[378,159,27,32],gl_coords:[.73828125,.310546875,.052734375,.0625]},B787_R:{px_rect:[415,159,42,39],gl_coords:[.810546875,.310546875,.08203125,.076171875]},B787_R_S:{px_rect:[467,159,31,28],gl_coords:[.912109375,.310546875,.060546875,.0546875]},B787_B:{px_rect:[0,213,43,39],gl_coords:[0,.416015625,.083984375,.076171875]},B787_B_S:{px_rect:[53,213,30,28],gl_coords:[.103515625,.416015625,.05859375,.0546875]},EUROCOPTER_R:{px_rect:[93,213,25,29],gl_coords:[.181640625,.416015625,.048828125,.056640625]},EUROCOPTER_R_S:{px_rect:[128,213,18,21],gl_coords:[.25,.416015625,.03515625,.041015625]},EUROCOPTER_B:{px_rect:[156,213,24,29],gl_coords:[.3046875,.416015625,.046875,.056640625]},EUROCOPTER_B_S:{px_rect:[190,213,19,21],gl_coords:[.37109375,.416015625,.037109375,.041015625]},FOKKER100_R:{px_rect:[219,213,24,28],gl_coords:[.427734375,.416015625,.046875,.0546875]},FOKKER100_R_S:{px_rect:[253,213,18,21],gl_coords:[.494140625,.416015625,.03515625,.041015625]},FOKKER100_B:{px_rect:[281,213,24,28],gl_coords:[.548828125,.416015625,.046875,.0546875]},FOKKER100_B_S:{px_rect:[315,213,18,21],gl_coords:[.615234375,.416015625,.03515625,.041015625]},GLIDER_R:{px_rect:[343,213,31,17],gl_coords:[.669921875,.416015625,.060546875,.033203125]},GLIDER_R_S:{px_rect:[384,213,22,12],gl_coords:[.75,.416015625,.04296875,.0234375]},GLIDER_B:{px_rect:[416,213,31,17],gl_coords:[.8125,.416015625,.060546875,.033203125]},GLIDER_B_S:{px_rect:[457,213,23,12],gl_coords:[.892578125,.416015625,.044921875,.0234375]},RJ100_R:{px_rect:[0,262,22,25],gl_coords:[0,.51171875,.04296875,.048828125]},RJ100_R_S:{px_rect:[32,262,17,19],gl_coords:[.0625,.51171875,.033203125,.037109375]},RJ100_B:{px_rect:[59,262,22,25],gl_coords:[.115234375,.51171875,.04296875,.048828125]},RJ100_B_S:{px_rect:[91,262,16,19],gl_coords:[.177734375,.51171875,.03125,.037109375]},PRIVATEJET_R:{px_rect:[117,262,26,24],gl_coords:[.228515625,.51171875,.05078125,.046875]},PRIVATEJET_R_S:{px_rect:[153,262,19,18],gl_coords:[.298828125,.51171875,.037109375,.03515625]},PRIVATEJET_B:{px_rect:[182,262,25,24],gl_coords:[.35546875,.51171875,.048828125,.046875]},PRIVATEJET_B_S:{px_rect:[217,262,19,18],gl_coords:[.423828125,.51171875,.037109375,.03515625]},SINGLEPROP_R:{px_rect:[246,262,23,16],gl_coords:[.48046875,.51171875,.044921875,.03125]},SINGLEPROP_R_S:{px_rect:[279,262,16,13],gl_coords:[.544921875,.51171875,.03125,.025390625]},SINGLEPROP_B:{px_rect:[305,262,22,16],gl_coords:[.595703125,.51171875,.04296875,.03125]},SINGLEPROP_B_S:{px_rect:[337,262,17,13],gl_coords:[.658203125,.51171875,.033203125,.025390625]},TRIANGLE_R:{px_rect:[364,262,18,14],gl_coords:[.7109375,.51171875,.03515625,.02734375]},TRIANGLE_R_S:{px_rect:[392,262,14,11],gl_coords:[.765625,.51171875,.02734375,.021484375]},TRIANGLE_B:{px_rect:[416,262,19,14],gl_coords:[.8125,.51171875,.037109375,.02734375]},TRIANGLE_B_S:{px_rect:[445,262,14,11],gl_coords:[.869140625,.51171875,.02734375,.021484375]},TWINPROP_R:{px_rect:[469,262,20,17],gl_coords:[.916015625,.51171875,.0390625,.033203125]},TWINPROP_R_S:{px_rect:[0,297,15,13],gl_coords:[0,.580078125,.029296875,.025390625]},TWINPROP_B:{px_rect:[25,297,20,17],gl_coords:[.048828125,.580078125,.0390625,.033203125]},TWINPROP_B_S:{px_rect:[55,297,14,13],gl_coords:[.107421875,.580078125,.02734375,.025390625]},VEHICLE_R:{px_rect:[79,297,10,16],gl_coords:[.154296875,.580078125,.01953125,.03125]},VEHICLE_R_S:{px_rect:[99,297,8,12],gl_coords:[.193359375,.580078125,.015625,.0234375]},VEHICLE_B:{px_rect:[117,297,10,16],gl_coords:[.228515625,.580078125,.01953125,.03125]},VEHICLE_B_S:{px_rect:[137,297,8,12],gl_coords:[.267578125,.580078125,.015625,.0234375]},BALLOON_R:{px_rect:[155,297,24,34],gl_coords:[.302734375,.580078125,.046875,.06640625]},BALLOON_R_S:{px_rect:[189,297,18,24],gl_coords:[.369140625,.580078125,.03515625,.046875]},BALLOON_B:{px_rect:[217,297,25,34],gl_coords:[.423828125,.580078125,.048828125,.06640625]},BALLOON_B_S:{px_rect:[252,297,18,24],gl_coords:[.4921875,.580078125,.03515625,.046875]},VOLCANO:{px_rect:[280,297,24,27],gl_coords:[.546875,.580078125,.046875,.052734375]},AIRPORT_SMALL:{px_rect:[314,297,18,18],gl_coords:[.61328125,.580078125,.03515625,.03515625]},AIRPORT_LARGE:{px_rect:[342,297,28,28],gl_coords:[.66796875,.580078125,.0546875,.0546875]},SANTA:{px_rect:[380,297,22,63],gl_coords:[.7421875,.580078125,.04296875,.123046875]}},this.inputHandler=new PFInputHandler(this),this.renderer=new PFCanvasRenderer2D(this,t),this.pixelScale=parseInt(this.getPixelScale()),this.pixelScale<1&&(this.pixelScale=1),2<this.pixelScale&&(this.pixelScale=2),this.viewportSize={x:0,y:0},this.labelRenderRequests=[],this.needsRedraw=!1,this.panning=!1,this.validClick=!1,this.clickTimeout=null,this.worldWidth=0,this.visiblePlaneMarkers=0,this.totalPlaneMarkers=0,this.visiblePlaneCounter=$("div#visible_planes_counter span.num_planes"),this.isAdded=!1,this.resizeListener=null,this.centerListener=null,this.setMap(e.map)}return(t.prototype=new google.maps.OverlayView).init=function(){this.queueRenderRequest()},t.prototype.getPixelScale=function(){return"devicePixelRatio"in window&&1<window.devicePixelRatio?window.devicePixelRatio:1},t.prototype.onAdd=function(){if(!this.isAdded){this.isAdded=!0,$("#map > div > .gm-style").get(0).appendChild(this.canvas);var t=this;this.idleListener=google.maps.event.addListener(this.getMap(),"idle",function(){t.panning=!1,t.needsRedraw=!0,pf.updateURLWithBounds(!1)}),this.boundsListener=google.maps.event.addListener(this.getMap(),"dragstart",function(){t.panning=!0}),this.resizeListener=google.maps.event.addListener(this.getMap(),"resize",function(){t.handleViewportResize()}),$(window).bind("orientationchange resize",function(e){t.handleViewportResize()}),this.inputHandler.addListeners(),this.handleViewportResize()}},t.prototype.onRemove=function(){this.isAdded&&(this.isAdded=!1,this.canvas.parentElement.removeChild(this.canvas),this.resizeListener&&(google.maps.event.removeListener(this.resizeListener),this.resizeListener=null),this.idleListener&&(google.maps.event.removeListener(this.idleListener),this.idleListener=null),this.boundsListener&&(google.maps.event.removeListener(this.boundsListener),this.boundsListener=null),this.inputHandler.removeListeners())},t.prototype.performHitTest=function(e,t){1<this.pixelScale&&(e*=this.pixelScale,t*=this.pixelScale);var i=pf.uiController.selectedMarker(),a=this.fetchObjectsInViewport();for(var n in a){var s=a[n].marker;if((!pf.focusModeEnabled||i&&i.constructor==PFPlaneMarker&&s.isSelected())&&(s.isVisible()&&s.collidesWithPoint(e,t)))return s}return null},t.prototype.handleViewportResize=function(){if(this.isAdded){var e=this.getMap().getDiv(),t=e.offsetWidth,i=e.offsetHeight;this.viewportSize.x=t*this.pixelScale,this.viewportSize.y=i*this.pixelScale,this.canvas.width=t*this.pixelScale,this.canvas.height=i*this.pixelScale,this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.needsRedraw=!0}},t.prototype.draw=function(){this.render(0)},t.prototype.queueRenderRequest=function(){var t=this,e=function(){if(t.needsRedraw){var e=(new Date).getTime()/1e3;t.lastRenderTS;t.render(e-t.lastRenderTS),t.lastRenderTS=e}t.queueRenderRequest()};window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(renderCallbackthis.render):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):setTimeout(e,1e3/60)},t.prototype.fetchObjectsInViewport=function(){var e=[];if(!pf.quadtreeController||!pf.quadtreeController.quadtree)return e;var t=this.getMap();if(!t)return e;if(!t.getProjection())return e;var i=t.getBounds();if(!i)return e;var a=i.getNorthEast(),n=this.latLngToPoint(a),s=i.getSouthWest(),r=this.latLngToPoint(s),o={x:Math.min(n.x,r.x),y:Math.min(n.y,r.y),width:Math.abs(n.x-r.x),height:Math.abs(n.y-r.y)};r.x>n.x&&(o.x=0,o.width=n.x,e=pf.quadtreeController.fetch(o,!0),o.x=r.x,o.width=Math.max(0,256-r.x));var l=pf.quadtreeController.fetch(o,!0);return e.concat(l)},t.prototype.render=function(e){if(this.needsRedraw=!1,this.getMap()){var t=this.getProjection();t&&(this.worldWidth=t.getWorldWidth()*this.pixelScale),this.renderer.beginFrame(),this.clearAllLabelRenderRequests(),this.renderer.saveState(),this.renderMarkers(this.renderer),this.renderer.restoreState(),this.renderer.isGL||this.renderLabels(this.renderer.context),this.renderer.endFrame()}},t.prototype.clearAllLabelRenderRequests=function(){this.labelRenderRequests=[]},t.prototype.requestLabelRender=function(e,t){this.labelRenderRequests.push({marker:e,forceDisplay:t})},t.prototype.renderMarkers=function(e){var t=this.getMap();if(t){var i=t.getProjection();if(i&&pf.quadtreeController&&pf.quadtreeController.quadtree){this.canvas;for(var a=5<t.getZoom(),n=null,s=0,r=this.fetchObjectsInViewport(),o=Math.pow(2,t.getZoom()),l=this.getProjection().getWorldWidth()*o,p=Math.ceil(l/10),h=(Math.ceil(l/10),t.getZoom()<7),c=new google.maps.Point(0,0),u={},d=this.getProjection(),f=t.getBounds(),g=0;g<r.length;g++){if((P=r[g].marker).screenPosition.x=null,P.screenPosition.y=null,1!=r[g].type||a){var m=P.isSelected();if((!pf.focusModeEnabled||m)&&P&&P.isVisible()){P.isSelected()&&(n=P);var v=P.getPosition();if(0==r[g].type&&f.contains(v)&&(s+=1),h){i.fromLatLngToPoint(v,c),c.x*=o,c.y*=o;var y=Math.floor(c.x/10),_=Math.floor(c.y/10)*p+y;if(!(!u[_]||m||u[_].decimalAdshex>P.decimalAdshex))continue;u[_]=P}if(!h){var b=d.fromLatLngToContainerPixel(v);P.screenPosition.x=Math.floor(b.x*this.pixelScale),P.screenPosition.y=Math.floor(b.y*this.pixelScale),P.drawRepeating(e,P.screenPosition.x,P.screenPosition.y)}}}}if(h)for(var w in u)if(u.hasOwnProperty(w)){var P=u[w];b=d.fromLatLngToContainerPixel(P.position);P.screenPosition.x=Math.floor(b.x*this.pixelScale),P.screenPosition.y=Math.floor(b.y*this.pixelScale),P.drawRepeating(e,P.screenPosition.x,P.screenPosition.y)}if(n){b=d.fromLatLngToContainerPixel(P.position);P.screenPosition.x=Math.floor(b.x*this.pixelScale),P.screenPosition.y=Math.floor(b.y*this.pixelScale),n.drawRepeating(e,n.screenPosition.x,n.screenPosition.y)}var C=pf.quadtreeController.totalPlanes;this.visiblePlaneCounter.text(s+" of "+C+" visible"),this.visiblePlaneMarkers=s,this.totalPlaneMarkers=C}}},t.prototype.renderLabels=function(e){if(e&&0<this.labelRenderRequests.length){this.renderer.saveState();var t=[],i=pf.settings.valueForKey("allowLabelOverlap"),a=pf.uiController.selectedMarker();a&&a.constructor==PFPlaneMarker&&(t[t.length]={x:a.screenPosition.x-a.size.w/2,y:a.screenPosition.y-a.size.h/2,w:a.size.w,h:a.size.h}),e.font="bold 12px sans-serif",e.textAlign="left";for(var n=0;n<this.labelRenderRequests.length;n++){var s=this.labelRenderRequests[n],r=s.marker.metricsForLabel(e);if(null!=r){var o={x:s.marker.screenPosition.x+r.rect.x+-5,y:s.marker.screenPosition.y+r.rect.y+-5,w:r.rect.w+10,h:r.rect.h+10},l=!1;if(!s.forceDisplay&&!i)for(var p=0;p<t.length;p++){var h=t[p];if(!(o.x>h.x+h.w-1||o.y>h.y+h.h-1||h.x>o.x+o.w-1||h.y>o.y+o.h-1)){l=!0;break}}l||(s.marker.drawLabel(e,s.marker.screenPosition.x,s.marker.screenPosition.y,r),t[t.length]=o)}}this.renderer.restoreState()}},t.prototype.drawLabelBackground=function(e,t,i,a,n,s,r){var o=10,l=5,p=3;1<this.pixelScale&&(o*=this.pixelScale,l*=this.pixelScale,p*=this.pixelScale),e.save(),s&&(e.shadowColor="rgba(0, 0, 0, 0.1)",e.shadowBlur=10,e.shadowOffsetX=0,e.shadowOffsetY=0),e.beginPath(),e.moveTo(t+p,i),e.lineTo(t+a-p,i),e.quadraticCurveTo(t+a,i,t+a,i+p),e.lineTo(t+a,i+n-p),e.quadraticCurveTo(t+a,i+n,t+a-p,i+n),s&&(e.lineTo(t+(a/2+o/2),i+n),e.lineTo(t+a/2,i+n+l),e.lineTo(t+(a/2-o/2),i+n)),e.lineTo(t+p,i+n),e.quadraticCurveTo(t,i+n,t,i+n-p),e.lineTo(t,i+p),e.quadraticCurveTo(t,i,t+p,i),e.lineWidth=2,e.fillStyle=r,e.fill(),e.restore()},t.prototype.latLngToPoint=function(e){var t=Math.sin(e.lat()*Math.PI/180);return t=Math.min(Math.max(t,-.9999),.9999),new google.maps.Point(256*(.5+e.lng()/360),256*(.5-Math.log((1+t)/(1-t))/(4*Math.PI)))},new t(e)}function PFMapDimmerOverlayFactory(e){function t(e){this.map_=e,this.div_=null,this.opacity=pf.settings.valueForKey("mapFadeValue"),this.setMap(e)}return(t.prototype=new google.maps.OverlayView).onAdd=function(){var e=document.createElement("div");e.style.backgroundColor="black",e.style.opacity=this.opacity,e.style.position="absolute",this.div_=e,this.getPanes().overlayLayer.appendChild(e)},t.prototype.draw=function(){var e=this.getProjection(),t=this.map.getBounds(),i=e.fromLatLngToDivPixel(t.getSouthWest()),a=e.fromLatLngToDivPixel(t.getNorthEast()),n=pf.canvasOverlay.viewportSize.x,s=pf.canvasOverlay.viewportSize.y,r=this.div_;r.style.left=i.x-n+"px",r.style.top=a.y-s+"px",r.style.width=a.x-i.x+2*n+"px",r.style.height=i.y-a.y+2*s+"px",r.style.opacity=this.opacity},t.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},new t(e)}function PFCore(e,t,i){function a(){}this.supportsCanvas()?(this.settings=new PFSettingsModel(e,t),this.mapOpts=i,this.hasShownIdleTimeout=!1,this.idleTimeoutCounter=0,this.previousMapCenter=!1,this.previousMapZoom=!1,this.focusModeEnabled=!1,this.dayNightOverlayTimer=null,this.lastDayNightUpdateTS=0,this.scAudio=!1,this.setupPlaceholderHandler(),((a.prototype=new google.maps.OverlayView).constructor=a).prototype.onAdd=function(){},a.prototype.draw=function(){},a.prototype.onRemove=function(){},google.maps.visualRefresh=!0,this.geocoder=new google.maps.Geocoder,this.map=new google.maps.Map(document.getElementById("map"),this.mapOpts),this.mapProjectionOverlay=new a,this.mapProjectionOverlay.setMap(this.map),this.setupMapsAfterAsyncLoad()):window.location="/mobile.php"}function PFPresentSubscriptionPurchaseModal(){pf.uiController.hideSidebar();var e=function(){var e=new PFWebViewController($("div#page_container_modal"),{title:null,url:"/subscription.php",width:"470px",height:"600px"});e.closeButtonCallback=function(){pf.planeController.setLiveUpdatesActive(!0),pf.hasShownIdleTimeout=!1,pf.idleTimeoutCounter=0},pf.uiController.presentModalViewController(e)};pf.uiController.modalViewController?pf.uiController.dismissViewController(pf.uiController.modalViewController,e):e()}function PFInitSubscriptionPurchase(e,t,i){Paddle.Setup({vendor:32908}),pf.uiController.dismissViewController(pf.uiController.modalViewController,function(){Paddle.Checkout.open({product:e,email:t,passthrough:i,disableLogout:!0,successCallback:function(){window.location.replace("/")},closeCallback:function(){window.location.replace("/")}})})}PFNewsFlashController.prototype.pushNextItem=function(){if(this.items.length){$(".active",this.container).animate({top:"-60px"},500,function(){$(this).remove()});var e=this.items[this.currentIndex],t=this.template.clone().removeClass("template").css("top","60px"),i=$("a",t);i.prop("title",e.message),i.prop("href",e.link),i.html(e.message),this.container.append(t),t.animate({top:"0px"},500,function(){t.addClass("active")}),e.isSticky||(this.currentIndex++,this.currentIndex>=this.items.length&&(this.currentIndex=0))}},PFNewsFlashController.prototype.requestLatestNewsUpdate=function(){var s=this;$.ajax({type:"GET",cache:!0,url:"//planefinder.net/social/social.json",dataType:"jsonp",jsonpCallback:"socialDataCallbackV1",success:function(e){if(s.currentIndex=0,s.items=e.messages,!pf.settings.valueForKey("isEmbedded")&&e.alert&&s.isInitialNewsLoad){var t=pf.settings.valueForKey("previousAlertID");if(t){if(t<e.alert.messageId){var i=new PFWebViewController($("div#page_container_modal"),{title:e.alert.messageUrl,url:e.alert.messageUrl,width:"480px",height:"520px",hideBar:!0});pf.uiController.presentModalViewController(i),pf.settings.setValue("previousAlertID",e.alert.messageId)}}else pf.settings.setValue("previousAlertID",-1);s.isInitialNewsLoad=!1}var a=0;for(var n in s.items){if(n.isSticky){s.currentIndex=a;break}a++}}})},PFNewsFlashController.kUpdateTime=36e5,PFNewsFlashController.kNextItemTime=1e4,PFPlaneMarker.prototype.willRemove=function(){this.isSelected()&&pf.uiController.hideSidebar(),this.hideFlightPath()},PFPlaneMarker.prototype.handleDataUpdate=function(e){this.headingRad=this.info.heading*Math.PI/180,this.clampRotation="BALLOON"==this.info.markerType||"TRIANGLE"==this.info.markerType,this.canShowAirlineLogo=this.allowLogoDisplay(),this.info.speed<pf.settings.valueForKey("flightPathEstimationSpeedCutOff")||this.info.altitude<pf.settings.valueForKey("flightPathEstimationAltitudeCutOff")?this.lastUpdatedTS=e:this.lastUpdatedTS=this.info.mtime,this.isSelected()&&pf.uiController.sidebarViewController&&pf.uiController.sidebarViewController.update(),this.cachedLabelMetrics_=null},PFPlaneMarker.prototype.handleMetaDataResponse=function(e){if(e){if(e.paths&&e.paths[this.info.adshex]){var t=e.paths[this.info.adshex];this.parseFlightPath(t)}this.info.image=e.image,this.info.photos=e.photos,this.info.planeData=e.plane,this.info.aircraft=e.aircraft,e.squawk&&(this.info.squawk=""+e.squawk),this.info.flight=e.flight,this.info.status=e.status,this.info.vertrate=e.vertrate,void 0!==e.route&&this.canShowAirlineLogo&&(this.info.route=e.route),this.setPosition(this.getPosition()),this.hasFetchedMetadata=!0,this.isSelected()&&pf.uiController.sidebarViewController&&pf.uiController.sidebarViewController.update()}},PFPlaneMarker.prototype.updateEstimatedFlightPath=function(){var e=pf.unixTimestamp(),t=this.position,i=1852*this.speed(),a=this.heading(),n=0;(this.info.altitude<1e3||this.info.speed<130)&&(i=0);var s=parseFloat(e)-parseFloat(this.lastUpdatedTS);if(0<s){n=i/60/60*s;t=google.maps.geometry.spherical.computeOffset(t,n,a)}this.setPosition(t),this.lastUpdatedTS=e},PFPlaneMarker.prototype.matchesFilter=function(e){var t=parseInt(this.info.altitude),i=parseInt(this.info.speed);if(-1!==e.excludedTrafficSources.indexOf(this.info.planeType))return!1;if(i>=e.speed[0]&&i<=e.speed[1]&&t>=e.altitude[0]&&t<=e.altitude[1]){for(var a=!1,n=0;n<e.airlines.length;n++)if(0==this.info.flightno.indexOf(e.airlines[n])||0==this.info.callsign.indexOf(e.airlines[n])){a=!0;break}if(!e.airlines.length||a){var s=!1;for(n=0;n<e.aircrafts.length;n++)if(0==this.info.type.indexOf(e.aircrafts[n])){s=!0;break}if(!e.aircrafts.length||s){var r=!1;for(n=0;n<e.airports.length;n++)for(var o=e.airports[n],l=o[0],p=o[1],h=0;h<this.info.route_array.length;h++)if(this.info.route_array[h]==l&&(0==p||1==p&&0<h||2==p&&h<this.info.route_array.length-1)){r=!0;break}if(!e.airports.length||r){var c=!1;for(n=0;n<e.squawks.length;n++)if(this.info.squawk&&-1<this.info.squawk.indexOf(e.squawks[n])){c=!0;break}if(!e.squawks.length||c){if(!e.fleet.length)return!0;for(n=0;n<e.fleet.length;n++)if(this.info.reg&&-1<this.info.reg.indexOf(e.fleet[n]))return!0}}}}}return!1},PFPlaneMarker.prototype.showFlightPath=function(){if(this.flightPathAttached=!0,this.flightPath){for(var e=this.flightPath.length;e--;)this.flightPath[e].setMap(pf.map);this.estimatedFlightPath&&this.estimatedFlightPath.setMap(pf.map)}else this.fetchFlightPath()},PFPlaneMarker.prototype.fetchFlightPath=function(){var i=this,e={r:"planePositions",adshex:this.info.adshex,flightno:this.info.flightno,callsign:this.info.callsign,type:this.info.planeType};pf.uiController.playbackViewController.playbackActive()&&(e.isPlayback=1,e.flightID=this.info.flight_id,this.flightPath&&this.cachedFlightPathData)?this.parseFlightPath(this.cachedFlightPathData):$.ajax({type:"GET",cache:!1,url:pf.settings.valueForKey("baseURL")+"api/api.php",data:e,dataType:"json",timeout:pf.settings.valueForKey("planePollTimeout"),success:function(e){if(!0===e.success){var t=e.payload;i.parseFlightPath(t)}},error:function(){}})},PFPlaneMarker.prototype.hideFlightPath=function(){if(this.flightPath)for(var e=this.flightPath.length;e--;)google.maps.event.clearListeners(this.flightPath[e],"mouseover"),google.maps.event.clearListeners(this.flightPath[e],"mouseout"),this.flightPath[e].setMap(null);this.estimatedFlightPath&&this.estimatedFlightPath.setMap(null),this.cachedFlightPathData=!1,this.flightPathBounds=!1,this.flightPathAttached=!1,this.flightPath=!1,this.estimatedFlightPath=!1,this.lastFlightPathPointTS=0},PFPlaneMarker.prototype.toggleFlightPath=function(){this.flightPath&&this.flightPath[0].getMap()==pf.map?this.hideFlightPath():this.showFlightPath()},PFPlaneMarker.prototype.flightPathColorForAltitude=function(e){if(e<=42e4&&0<=e){var t=parseFloat(e/42e3),i=255*parseFloat(0+1*t),a=255*parseFloat(0+0*t),n=255*parseFloat(1+-1*t);return"rgb("+parseInt(i)+","+parseInt(a)+","+parseInt(n)+")"}return"rgb(0,0,0)"},PFPlaneMarker.prototype.parseFlightPath=function(a){if(a){for(var n=this.flightPath?this.flightPath:[],e=new google.maps.LatLngBounds,t=null,i=null,s=this,r=!1,o=!0,l=a.length-1;0<=l;l--){var p=new google.maps.LatLng(a[l][0],a[l][1]),h=parseInt(a[l][4]);if(t&&p){if(this.lastFlightPathPointTS<h){var c=function(e,t){var i=s.createFlightPathSegment(e,s.flightPathColorForAltitude(a[l][2]),t);i&&(i.pfData={from:a[l+1],to:a[l]},n.push(i),pf.settings.transientValueForKey("isMobile")||s.attachPolylineHoverHandler(i))};o&&r&&(c([r,t],!1),o=!1),c([t,p],120<Math.abs(i-h)),this.lastFlightPathPointTS=h,this.lastFlightPathLatLng=p,!0}else r=p;e.extend(t),e.extend(p)}i=h,t=p}this.flightPath=n,this.flightPathBounds=e,this.cachedFlightPathData=a;var u=pf.uiController.playbackViewController.playbackActive();if(u)for(l=0;l<this.flightPath.length;l++){var d=u&&pf.uiController.playbackViewController.currentTS<this.flightPath[l].pfData.to[4]?.25:.75;this.flightPath[l].setOptions({strokeOpacity:d})}}},PFPlaneMarker.prototype.attachPolylineHoverHandler=function(s){s.addListener("mouseout",function(){s.setOptions({strokeColor:s.pfColor}),$("#polyline-inspector").css("display","none")}),s.addListener("mouseover",function(e){var t=pf.mapProjectionOverlay.getProjection().fromLatLngToContainerPixel(e.latLng),i=s.pfData.to[3]-s.pfData.from[3],a=s.pfData.to[2]-s.pfData.from[2],n=new Date(1e3*s.pfData.to[4]);s.setOptions({strokeColor:"rgb(255, 255, 255)"}),$("#polyline-inspector").css({left:t.x+15+"px",top:t.y-$("#polyline-inspector").height()/2+"px",display:"block"}).html("Speed: "+pf.getFormattedSpeed(s.pfData.to[3])+(0!=i?' (<span class="arrow'+(0<i?" increase":" decrease")+'"></span> '+pf.getFormattedSpeed(Math.abs(i))+")":"")+"<br/>Altitude: "+pf.getFormattedAltitude(s.pfData.to[2])+(0!=a?' (<span class="arrow'+(0<a?" increase":" decrease")+'"></span> '+pf.getFormattedAltitude(Math.abs(a))+")":"")+"<br/>Time: "+pf.getFormattedHHMMTime(n)+" ("+pf.getFormattedHHMMTime(n,!0)+" UTC)<br />")})},PFPlaneMarker.prototype.createFlightPathSegment=function(e,t,i){var a=null;this.flightPathAttached&&(a=pf.map);var n=!1;if(i){n=new google.maps.Polyline({clickable:!0,geodesic:pf.settings.valueForKey("useGeodesicFlightPaths"),map:a,path:e,icons:[{icon:{path:"M 0, -0.5 0, 0.5",strokeOpacity:.8,strokeColor:"#29323e",scale:3},offset:"0",repeat:"10px"}],strokeOpacity:0,zIndex:0})}else n=new google.maps.Polyline({clickable:!0,geodesic:pf.settings.valueForKey("useGeodesicFlightPaths"),map:a,path:e,strokeColor:t,strokeOpacity:.75,strokeWeight:3.5,zIndex:0});return n.pfColor=t,n},PFPlaneMarker.prototype.fitMapToFlightPath=function(){if(this.flightPath){this.showFlightPath();var e=this.flightPathBounds;e=e.extend(this.getPosition()),pf.map.fitBounds(e);var t=270,i=60,a=pf.mapProjectionOverlay.getProjection(),n=a.fromLatLngToContainerPixel(e.getSouthWest()),s=a.fromLatLngToContainerPixel(e.getNorthEast()),r=n.x<t?-Math.abs(t-n.x):0,o=s.y<i?-Math.abs(i-s.y):0;if(0!=r||0!=o){var l=new google.maps.Point(r,o),p=a.fromContainerPixelToLatLng(l);e=e.extend(p),pf.map.fitBounds(e)}}},PFPlaneMarker.prototype.isFAA=function(){return 12==this.info.planeType},PFPlaneMarker.prototype.speed=function(){return this.info.speed},PFPlaneMarker.prototype.heading=function(){return this.info.heading},PFPlaneMarker.prototype.setHeading=function(e){this.info.heading=e},PFPlaneMarker.prototype.getPosition=function(){var e=!pf.planeController.liveUpdatesActive(),t=pf.settings.valueForKey("disableFlightEstimation");if(!e&&!t){var i=pf.unixTimestamp();Math.abs(this.lastUpdatedTS-i)>=pf.planeController.getEstimationInterval()&&this.updateEstimatedFlightPath()}return!e&&t?this.lastAccuratePosition:this.position},PFPlaneMarker.prototype.setPosition=function(e){if(this.position=e,pf.settings.valueForKey("plotFlightPathEstimation")&&this.flightPath&&0<this.flightPath.length&&this.lastAccuratePosition&&!pf.uiController.playbackViewController.playbackActive()){var t=this.flightPath[this.flightPath.length-1].getPath().getArray(),i=t[t.length-1];if(this.estimatedFlightPath)this.estimatedFlightPath.setPath([i,e]);else{var a="#FF0000";this.flightPath&&void 0!==this.flightPath[this.flightPath.length-1]&&(a=this.flightPath[this.flightPath.length-1].strokeColor),this.estimatedFlightPath=this.createFlightPathSegment([i,e],a,!0)}}pf.settings.valueForKey("followSelectedPlane")&&this.isSelected()&&!pf.canvasOverlay.panning&&pf.map.setCenterWithOffset(this.position,pf.uiController.sidebarViewController?pf.settings.valueForKey("sidebarWidth")/2:0,0),this.tooltip&&this.tooltip.draw()},PFPlaneMarker.prototype.isSelected=function(){return this.selected_},PFPlaneMarker.prototype.setSelected=function(e){if(pf.settings.valueForKey("isMobile")&&this.selected_&&!e&&(this.lastSelectedTS=(new Date).getTime()),this.selected_=e,this.selected_){if(pf.settings.valueForKey("internalEmbed"))pf.sendMessageToTarget(window.parent,"selectedPlane",{callsign:this.info.callsign});else{var t=new PFPlaneDetailViewController({plane:this});pf.uiController.showSidebar(t)}this.showFlightPath()}else pf.settings.valueForKey("showPersistentFlightPaths")||this.hideFlightPath()},PFPlaneMarker.prototype.setVisible=function(e){!e&&this.flightPathAttached&&this.hideFlightPath(),this.visible_=e},PFPlaneMarker.prototype.isVisible=function(){return this.visible_},PFPlaneMarker.prototype.setVisible=function(e){this.visible_=e},PFPlaneMarker.prototype.isHighlighted=function(){return this.highlighted_},PFPlaneMarker.prototype.setHighlighted=function(e){this.highlighted_=e},PFPlaneMarker.prototype.allowLogoDisplay=function(){return(!this.info.callsign||!this.info.reg||this.info.callsign!=this.info.reg.replace("-",""))&&("GLID"!=this.info.type&&"????"!=this.info.type&&"GRND"!=this.info.type&&"LEADER"!=this.info.type&&"----"!=this.info.type&&(this.info.callsign&&0==this.info.callsign.indexOf("AMX")&&this.info.reg&&0==this.info.reg.indexOf("VH")||this.info.callsign&&0==this.info.callsign.indexOf("AIQ")&&this.info.reg&&0==this.info.reg.indexOf("VH")?(this.info.route="",this.info.route_raw="",!1):(!this.info.callsign||0!=this.info.callsign.indexOf("PAO")||!this.info.reg||0!=this.info.reg.indexOf("PH"))&&(!this.info.callsign||0!=this.info.callsign.indexOf("TOK")||!this.info.reg||0!=this.info.reg.indexOf("G-"))))},PFPlaneMarker.prototype.worldPositionForLatLng=function(e){var t=Math.sin(e.lat()*Math.PI/180);return t=Math.min(Math.max(t,-.9999),.9999),new google.maps.Point(256*(.5+e.lng()/360),256*(.5-Math.log((1+t)/(1-t))/(4*Math.PI)))},PFPlaneMarker.prototype.worldPosition=function(){return this.worldPositionForLatLng(this.getPosition())},PFPlaneMarker.prototype.drawRepeating=function(e,t,i){var a=pf.canvasOverlay.worldWidth;if(!(t<0||t>pf.canvasOverlay.viewportSize.x||i<0||i>pf.canvasOverlay.viewportSize.y)){for(var n=t;0<n-a;)n-=a;for(var s=n,r=i;this.draw(e,s,r),!((s+=a)>pf.canvasOverlay.viewportSize.x););}},PFPlaneMarker.prototype.draw=function(e,t,i){var a=this.isSelected()||this.isHighlighted()?"B":"R";0<this.lastSelectedTS&&(350<(new Date).getTime()-this.lastSelectedTS&&(this.lastSelectedTS=0),a="B");var n=pf.assets.imageForURL(this.spritesheetURL);if(!n)return!1;var s=this.isSanta?pf.canvasOverlay.markerAtlasMetadata.SANTA:pf.canvasOverlay.markerAtlasMetadata[this.info.markerType+"_"+a];if(!s)return!1;var r=pf.canvasOverlay.pixelScale,o=0,l=0;if(!0===pf.canvasOverlay.renderer.isGL){var p=s.gl_coords[0],h=s.gl_coords[1];o=s.gl_coords[2],l=s.gl_coords[3],this.size.w=s.px_rect[2]*r,this.size.h=s.px_rect[3]*r}else{p=s.px_rect[0]*r,h=s.px_rect[1]*r;this.size.w=s.px_rect[2]*r,this.size.h=s.px_rect[3]*r,o=this.size.w,l=this.size.h}var c=.75,u=.75;11<pf.map.getZoom()&&(u=c=1.4),e.drawImage(n,p,h,o,l,t,i,this.size.w,this.size.h,c,u,this.clampRotation?0:this.headingRad);var d=this.isHighlighted();return(d||"hide"!=pf.settings.valueForKey("planeLabelContent")&&pf.map.getZoom()>pf.settings.valueForKey("minPersistentPlaneLabelsZoomLevelV2"))&&pf.canvasOverlay.requestLabelRender(this,d),!0},PFPlaneMarker.prototype.drawLabel=function(e,t,i,a){var n=a.rect;if(this.isHighlighted()){var s=5*pf.canvasOverlay.pixelScale;pf.canvasOverlay.drawLabelBackground(e,t+n.x,i+n.y,n.w,n.h,!0,"rgba(255, 255, 255, 1)");var r=parseInt(t+n.x+s);if(this.canShowAirlineLogo)if((l=pf.assets.imageForURL("//planefinder.net/flightstat/v2/getLogo3x.php?airlineCode="+this.info.airline+"&requestThumb=1&isSSL="+pf.settings.valueForKey("https")+"&hex="+this.info.adshex))&&1<l.width&&1<l.height){e.fillStyle="#f3f3f3",e.roundRect(t+n.x,i+n.y,a.imgSize.w+2*s,n.h,{upperLeft:3*pf.canvasOverlay.pixelScale,lowerLeft:3*pf.canvasOverlay.pixelScale,upperRight:0,lowerRight:0},!0,!1);var o=parseInt(i+n.y+(n.h/2-a.imgSize.h/2));e.drawImage(l,r,o,a.imgSize.w,a.imgSize.h),r+=a.imgSize.w+10*pf.canvasOverlay.pixelScale}pf.canvasOverlay.pixelScale,o=i+n.y+(n.h/2-2.5*pf.canvasOverlay.pixelScale);e.textBaseline="alphabetic",e.fillStyle="rgb(51, 51, 51)",e.font="bold "+13*pf.canvasOverlay.pixelScale+"px Helvetica",e.fillText(a.labelLine1Content,r,o),e.font=12*pf.canvasOverlay.pixelScale+"px Helvetica",e.fillStyle="rgb(121, 123, 131)",e.fillText(a.labelLine2Content,r,o+14*pf.canvasOverlay.pixelScale)}else{s=2*pf.canvasOverlay.pixelScale;var l,p="logo"==pf.settings.valueForKey("planeLabelContent"),h=p?"rgba(255, 255, 255, 0.8)":"rgba(51, 51, 51, 0.8)";if(pf.canvasOverlay.drawLabelBackground(e,parseInt(t+n.x),parseInt(i+n.y),parseInt(n.w),parseInt(n.h),!1,h),p&&this.canShowAirlineLogo)(l=pf.assets.imageForURL("//planefinder.net/flightstat/v2/getLogo3x.php?airlineCode="+this.info.airline+"&requestThumb=1&isSSL="+pf.settings.valueForKey("https")+"&hex="+this.info.adshex))&&1<l.width&&1<l.height&&e.drawImage(l,parseInt(t+n.x+s),parseInt(i+n.y+(n.h/2-a.imgSize.h/2)),parseInt(a.imgSize.w),parseInt(a.imgSize.h));else if(!p){e.textBaseline="top",e.font=12*pf.canvasOverlay.pixelScale+"px Helvetica",e.fillStyle="rgb(255, 255, 255)";var c=0;a.labelLine1Content.length&&c++,a.labelLine2Content.length&&c++,a.labelLine3Content.length&&c++;var u=this.screenPosition.y-12*pf.canvasOverlay.pixelScale*c/2-.5*pf.canvasOverlay.pixelScale;a.labelLine1Content.length&&(e.fillText(a.labelLine1Content,t+n.x+s,u),u+=12*pf.canvasOverlay.pixelScale),a.labelLine2Content.length&&(e.fillText(a.labelLine2Content,t+n.x+s,u),u+=12*pf.canvasOverlay.pixelScale),a.labelLine3Content.length&&e.fillText(a.labelLine3Content,t+n.x+s,u)}}},PFPlaneMarker.prototype.collidesWithPoint=function(e,t){for(var i=pf.canvasOverlay.worldWidth,a=e;0<a-i;)a-=i;for(var n=this.screenPosition.x-.5*this.size.w,s=this.screenPosition.y-.5*this.size.h,r=a,o=t;;){if(n<=r&&n+this.size.w>=r&&s<=o&&s+this.size.h>=o)return!0;if((r+=i)>pf.canvasOverlay.viewportSize.x)return!1}return!1},PFPlaneMarker.prototype.metricsForLabel=function(e){if(this.isHighlighted())return this.metricsForTooltip(e);var t=2*pf.canvasOverlay.pixelScale,i="logo"==pf.settings.valueForKey("planeLabelContent");if(i&&this.canShowAirlineLogo){var a=this.sizeForAirlineLogo();if(a){var n={w:a.w+2*t,h:a.h+2*t};return{rect:{x:-n.w/2,y:this.size.h/2,w:n.w,h:n.h},imgSize:a}}}else if(!i){e.font=12*pf.canvasOverlay.pixelScale+"px Helvetica";var s=this.tooltipConvertTags(pf.settings.valueForKey("planeLabelLine1Item1"));s+=(0<s.length?" ":"")+this.tooltipConvertTags(pf.settings.valueForKey("planeLabelLine1Item2"));var r=this.tooltipConvertTags(pf.settings.valueForKey("planeLabelLine2Item1"));r+=(0<r.length?" ":"")+this.tooltipConvertTags(pf.settings.valueForKey("planeLabelLine2Item2"));var o=this.tooltipConvertTags(pf.settings.valueForKey("planeLabelLine3Item1"));o+=(0<o.length?" ":"")+this.tooltipConvertTags(pf.settings.valueForKey("planeLabelLine3Item2"));var l=0;if(s.length&&(l+=12*pf.canvasOverlay.pixelScale),r.length&&(l+=12*pf.canvasOverlay.pixelScale),o.length&&(l+=12*pf.canvasOverlay.pixelScale),l<=0)return null;var p=e.measureText(s),h=e.measureText(r),c=e.measureText(o),u={w:Math.max(p.width,h.width,c.width)+2*t,h:l+t};return{rect:{x:this.size.w/2+5,y:-u.h/2,w:u.w,h:u.h},labelLine1Content:s,labelLine2Content:r,labelLine3Content:o}}return null},PFPlaneMarker.prototype.metricsForTooltip=function(e){var t=5*pf.canvasOverlay.pixelScale,i=0,a=16*pf.canvasOverlay.pixelScale,n=this.sizeForAirlineLogo();n&&(i+=n.w+10*pf.canvasOverlay.pixelScale,a=Math.max(a,n.h));var s=this.tooltipConvertTags("flightno");s+=(0<s.length?" ":"")+this.tooltipConvertTags("reg");var r=this.tooltipConvertTags("route");if(r+=(0<r.length?" ":"")+this.tooltipConvertTags("alt"),r+=(0<r.length?" ":"")+this.tooltipConvertTags("speed"),!s.length&&!r.length)return null;e.font="bold "+13*pf.canvasOverlay.pixelScale+"px Helvetica";var o=e.measureText(s);e.font=12*pf.canvasOverlay.pixelScale+"px Helvetica";var l=e.measureText(r);return i+=Math.max(o.width,l.width),a+=10*pf.canvasOverlay.pixelScale,a+=2*t,{rect:{x:-(i+=2*t)/2,y:-(this.size.h/2+a+5*pf.canvasOverlay.pixelScale),w:i,h:a},labelLine1Content:s,labelLine2Content:r,imgSize:n}},PFPlaneMarker.prototype.sizeForAirlineLogo=function(){if(this.canShowAirlineLogo){var e=pf.assets.imageForURL("//planefinder.net/flightstat/v2/getLogo3x.php?airlineCode="+this.info.airline+"&requestThumb=1&isSSL="+pf.settings.valueForKey("https")+"&hex="+this.info.adshex);if(e&&1<e.width&&1<e.height){var t=Math.min(55/e.width,34/e.height);return{w:parseInt(e.width*t)*pf.canvasOverlay.pixelScale,h:parseInt(e.height*t)*pf.canvasOverlay.pixelScale}}}return null},PFPlaneMarker.prototype.tooltipConvertTags=function(e){return e?e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("blank","")).replace("flightno",this.info.flightno)).replace("reg",this.info.reg)).replace("callsign",this.info.callsign)).replace("alt",pf.getFormattedAltitude(this.info.altitude))).replace("speed",pf.getFormattedSpeed(this.info.speed,!1))).replace("heading",this.info.heading+"°")).replace("route",this.info.route_raw)).replace("squawk",this.info.squawk)).replace("vertrate",this.info.vertrate)).replace("type",this.info.type):""},PFAirportMarker.prototype.worldPositionForLatLng=function(e){var t=Math.sin(e.lat()*Math.PI/180);return t=Math.min(Math.max(t,-.9999),.9999),new google.maps.Point(256*(.5+e.lng()/360),256*(.5-Math.log((1+t)/(1-t))/(4*Math.PI)))},PFAirportMarker.prototype.worldPosition=function(){return this.worldPositionForLatLng(this.position)},PFAirportMarker.prototype.draw=function(e,t,i){e.context;var a=pf.canvasOverlay.pixelScale,n="@"+a+"x",s=pf.assets.imageForURL(pf.settings.valueForKey("baseURL")+"public/img/markers/atlas"+n+".png?v="+pf.settings.valueForKey("deploymentVersion")),r=pf.canvasOverlay.markerAtlasMetadata["AIRPORT_"+(this.popularAirport?"LARGE":"SMALL")];if(s&&r){var o=r.px_rect[0]*a,l=r.px_rect[1]*a;return this.size.w=r.px_rect[2]*a,this.size.h=r.px_rect[3]*a,e.drawImage(s,o,l,this.size.w,this.size.h,t,i,this.size.w,this.size.h,1,1,0),this.isHighlighted()&&pf.canvasOverlay.requestLabelRender(this,!0),!0}return!1},PFAirportMarker.prototype.drawLabel=function(e,t,i,a){var n=this.info.name+", "+this.info.city;if(n&&n.length){e.textBaseline="middle",e.font=12*pf.canvasOverlay.pixelScale+"px Helvetica";var s=a.rect;pf.canvasOverlay.pixelScale;pf.canvasOverlay.drawLabelBackground(e,t+s.x,i+s.y,s.w,s.h,!0,"rgba(255, 255, 255, 1)"),e.fillStyle="black",e.fillText(n,t+(s.x+s.w/2-a.textSize.width/2),i+(s.y+s.h/2))}},PFAirportMarker.prototype.metricsForLabel=function(e){if(this.cachedLabelMetrics)return this.cachedLabelMetrics;var t=this.info.name+", "+this.info.city;if(t&&t.length){e.textBaseline="middle",e.font=12*pf.canvasOverlay.pixelScale+"px Helvetica";var i=e.measureText(t),a=5*pf.canvasOverlay.pixelScale,n=10*pf.canvasOverlay.pixelScale,s={w:parseInt(i.width+2*n),h:parseInt(10*pf.canvasOverlay.pixelScale+2*n)};return s.x=parseInt(-s.w/2),s.y=parseInt(-(s.h+a+20)),cachedLabelMetrics={rect:s,textSize:i},cachedLabelMetrics}},PFAirportMarker.prototype.collidesWithPoint=function(e,t){for(var i=pf.canvasOverlay.worldWidth,a=e;0<a-i;)a-=i;for(var n=this.screenPosition.x-.5*this.size.w,s=this.screenPosition.y-.5*this.size.h,r=a,o=t;;){if(n<=r&&n+this.size.w>=r&&s<=o&&s+this.size.h>=o)return!0;if((r+=i)>pf.canvasOverlay.viewportSize.x)return!1}return!1},PFAirportMarker.prototype.drawRepeating=function(e,t,i){for(var a=pf.canvasOverlay.worldWidth,n=t;0<n-a;)n-=a;for(var s=n,r=i;this.draw(e,s,r),!((s+=a)>pf.canvasOverlay.viewportSize.x););},PFAirportMarker.prototype.isSelected=function(){return this.selected},PFAirportMarker.prototype.setSelected=function(e){if(this.selected=e,this.selected)if(pf.settings.valueForKey("internalEmbed"))pf.sendMessageToTarget(window.parent,"selectedAirport",{iata:this.info.iata});else{var t=new PFAirportDetailViewController({airport:this});pf.uiController.showSidebar(t)}},PFAirportMarker.prototype.isVisible=function(){return!!pf.settings.valueForKey("showAirports")&&this.visible},PFAirportMarker.prototype.setVisible=function(e){this.visible=e},PFAirportMarker.prototype.isHighlighted=function(){return this.highlighted},PFAirportMarker.prototype.setHighlighted=function(e){this.highlighted=e},PFAirportMarker.prototype.tooltipValue=function(){return this.info.name},PFAirportMarker.prototype.getPosition=function(){return this.position},PFAirportMarker.prototype.setPosition=function(e){this.position=e},PFMat4.identity=function(){return new PFMat4([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},PFMat4.translation=function(e,t,i){return new PFMat4([1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1])},PFMat4.orthographic=function(e,t,i,a,n,s){var r=t-e,o=a-i,l=s-n;return new PFMat4([2/r,0,0,0,0,2/o,0,0,0,0,-2/l,0,-(e+t)/r,-(a+i)/o,-(s+n)/l,1])},PFCanvasRenderer2D.prototype.beginFrame=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},PFCanvasRenderer2D.prototype.endFrame=function(){},PFCanvasRenderer2D.prototype.saveState=function(){this.context.save()},PFCanvasRenderer2D.prototype.restoreState=function(){this.context.restore()},PFCanvasRenderer2D.prototype.drawImage=function(e,t,i,a,n,s,r,o,l,p,h,c){var u=Math.cos(c),d=Math.sin(c);this.context.setTransform(u*p,d*p,-d*h,u*h,s,r),this.context.drawImage(e,t,i,a,n,Math.floor(-o/2),Math.floor(-l/2),o,l)},PFInputHandler.prototype.cancelPendingClicks=function(){this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null)},PFInputHandler.prototype.addDesktopListeners=function(){var i=this;google.maps.event.addListener(pf.map,"click",function(t){i.validClick=!0,i.clickTimeout=setTimeout(function(){if(i.validClick){var e=i.canvas.performHitTest(t.pixel.x,t.pixel.y);pf.uiController.setSelectedMarker(e)}i.cancelPendingClicks()},pf.settings.valueForKey("validSingleClickTimeout"))}),google.maps.event.addListener(pf.map,"dblclick",function(e){i.validClick=!1}),google.maps.event.addListener(pf.map,"mousemove",function(e){if(!i.canvas.panning){var t=i.canvas.performHitTest(e.pixel.x,e.pixel.y);t?(pf.uiController.setHighlightedMarker(t),i.body.addClass("simulateHover")):pf.uiController.highlightedMarker()&&(pf.uiController.setHighlightedMarker(null),i.body.removeClass("simulateHover"))}}),google.maps.event.addListener(pf.map,"mouseout",function(e){pf.uiController.setHighlightedMarker(null),i.body.removeClass("simulateHover")})},PFInputHandler.prototype.addMobileListeners=function(){var r=pf.map.getDiv(),o=this;r.addEventListener("touchstart",function(e){1==e.touches.length&&(o.touches.reset(),o.touches.startX=o.touches.currentX=e.touches[0].clientX,o.touches.startY=o.touches.currentY=e.touches[0].clientY,o.cancelPendingClicks()),pf.uiController.isShowingDropdownMenu&&($(".navigation_dropdown > ul > li").removeClass("expand"),pf.uiController.isShowingDropdownMenu=!1)}),r.addEventListener("touchmove",function(e){0<o.touches.startX&&(o.touches.currentX=e.touches[0].clientX,o.touches.currentY=e.touches[0].clientY)}),r.addEventListener("touchend",function(e){var t=parseInt(pf.settings.valueForKey("validSingleClickTimeout")),i=(new Date).getTime(),a=o.touches.lastTS||i;if(0<o.touches.startX&&Math.abs(o.touches.currentX-o.touches.startX)<4&&Math.abs(o.touches.currentY-o.touches.startY)<4&&e.changedTouches&&0<e.changedTouches.length){var n=e.changedTouches[0],s=i-a;(!s||t<s)&&(o.clickTimeout=setTimeout(function(){var e=n.pageX-r.offsetParent.offsetLeft,t=n.pageY-r.offsetParent.offsetTop,i=o.canvas.performHitTest(e,t);pf.uiController.setSelectedMarker(i),o.cancelPendingClicks()},o.clickTimeout))}o.touches.lastTS=i,o.touches.reset()})},PFInputHandler.prototype.addListeners=function(){pf.settings.valueForKey("isMobile")?this.addMobileListeners():this.addDesktopListeners()},PFInputHandler.prototype.removeListeners=function(){pf.settings.valueForKey("isMobile")?this.removeMobileListeners():this.removeDesktopListeners()},PFCore.prototype.start=function(){if(this.quadtreeController=new PFQuadtreeModel,this.canvasOverlay=PFCanvasOverlayFactory({map:this.map}),this.planeController=new PFPlaneModel,this.airportController=new PFAirportModel,this.uiController=new PFUIController,this.assets=new PFAssetModel,this.settings.init(),this.airportController.init(),this.uiController.start(),this.canvasOverlay.init(),this.dimmerOverlay=PFMapDimmerOverlayFactory(this.map),this.setDayNightOverlayActive(pf.settings.valueForKey("showDayNightOverlay")),"scrollRestoration"in history&&(history.scrollRestoration="manual"),this.setMapType(this.settings.valueForKey("mapTypeV2")),logMapType(this.settings.valueForKey("mapTypeV2")),this.settings.transientValueForKey("bounds")){var e=this.settings.transientValueForKey("bounds").split(",");this.map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(e[0],e[1]),new google.maps.LatLng(e[2],e[3])))}else if(this.settings.transientValueForKey("center")){var t=this.settings.transientValueForKey("center").split(",");this.map.setCenter(new google.maps.LatLng(t[0],t[1])),this.settings.transientValueForKey("zoom")&&this.map.setZoom(this.settings.transientValueForKey("zoom"))}else{var i=this.settings.valueForKey("bookmarks");if(i&&i.length)for(var a=0;a<i.length;a++){var n=i[a];1==n[4]&&(this.map.setCenter(new google.maps.LatLng(n[1],n[2])),this.map.setZoom(n[3]))}else{if(this.settings.valueForKey("center")){t=this.settings.valueForKey("center").split(",");this.map.setCenter(new google.maps.LatLng(t[0],t[1]))}this.settings.valueForKey("zoom")&&this.map.setZoom(this.settings.valueForKey("zoom"))}}if(pf.settings.valueForKey("playbackTimestamp")&&!pf.settings.valueForKey("isMobile")){var s=this.uiController.playbackViewController;this.uiController.presentViewController(s);var r=pf.settings.valueForKey("playbackTimestamp");s.startPlaybackAtDate(r);var o=pf.settings.valueForKey("playbackSpeed");o&&s.setPlaybackSpeed(o)}else{this.planeController.setLiveUpdatesActive(!0);var l=pf.settings.valueForKey("vaac");if(l)for(a=0;a<l.length;a++)PFNewAshCloudOverlay(l[a]);if(pf.settings.valueForKey("isMobile")&&pf.settings.valueForKey("playbackTimestamp")){var p=new PFMobileViewController($("div#page_container_mobile_modal"),{flightNo:pf.settings.valueForKey("playbackSelectedFlightNo"),isPlayback:1,time:pf.settings.valueForKey("playbackTimestamp"),speed:pf.settings.valueForKey("playbackSpeed")});pf.uiController.presentMobileViewController(p)}}var h=!0,c=!1;1==pf.settings.transientValueForKey("internalEmbed")&&(c=!0),this.settings.transientValueForKey("noTimeout")&&(h=!1),this.setupIdleTimeout(h,c)},PFCore.prototype.setupIdleTimeout=function(e,t){var i=15,a="/public/messaging/timeoutWithAd.html";0==e&&(i=240,a="/public/messaging/timeoutNoAd.html"),1==t&&(i=15,a="/public/messaging/timeoutNoAd.html");var n=this;$(document).on("click mousemove keypress mouseup mousedown",function(){n.hasShownIdleTimeout||(n.idleTimeoutCounter=0)}),window.setInterval(function(){n.idleTimeoutCounter+=1,n.idleTimeoutCounter>=i&&!n.hasShownIdleTimeout&&(n.siteTimeout(a),n.hasShownIdleTimeout=!0)},6e4)},PFCore.prototype.setupPlaceholderHandler=function(){$(document).on("focus","[placeholder]",function(){var e=$(this);e.val()==e.attr("placeholder")&&(e.val(""),e.removeClass("placeholder"))}),$(document).on("blur","[placeholder]",function(){var e=$(this);""!=e.val()&&e.val()!=e.attr("placeholder")||(e.addClass("placeholder"),e.val(e.attr("placeholder")))}),$(document).on("submit","form",function(){$(this).find("[placeholder]").each(function(){var e=$(this);e.val()==e.attr("placeholder")&&e.val("")})}),$("[placeholder]").blur()},PFCore.prototype.siteTimeout=function(e){0==this.planeController.liveUpdatesActive()?this.uiController.playbackViewController.setPlaybackPaused(!0):this.planeController.setLiveUpdatesActive(!1),this.uiController.deselectAllMarkers();var t=new PFTimeoutViewController($("div#page_container_modal"),{url:e,width:"600px",height:"480px"});logPageView("site_timeout"),pf.uiController.presentModalViewController(t)},PFCore.prototype.setupMapsAfterAsyncLoad=function(){google.maps.Map.prototype.setCenterWithOffset=function(e,t,i){var a=this.getProjection().fromLatLngToPoint(e),n=Math.pow(2,this.getZoom()),s=new google.maps.Point(t/n||0,i/n||0);this.setCenter(this.getProjection().fromPointToLatLng(new google.maps.Point(a.x-s.x,a.y+s.y))),pf.canvasOverlay.needsRedraw=!0};this.map.mapTypes.set("Minimal",new google.maps.StyledMapType([{featureType:"all",elementType:"all",stylers:[{saturation:-100}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]}],{map:this.map,name:"Minimal"})),this.map.mapTypes.set("Routes",new google.maps.StyledMapType([{featureType:"administrative",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:-100},{lightness:-100}]},{featureType:"landscape",elementType:"geometry",stylers:[{saturation:-100},{lightness:-100}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-100},{lightness:-80}]}],{map:this.map,name:"Routes"}));this.map.setOptions({styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]}]})},PFCore.prototype.updateURLWithBounds=function(e){return!1},PFCore.prototype.sendMessageToTarget=function(e,t,i){},PFCore.prototype.setDayNightOverlayActive=function(e){if(e){nite.map?nite.show():nite.init(this.map);var t=this;this.dayNightOverlayTimer=setInterval(function(){t.updateDayNightOverlay()},5e3)}else nite.map&&nite.hide(),this.dayNightOverlayTimer&&clearInterval(this.dayNightOverlayTimer),this.dayNightOverlayTimer=null},PFCore.prototype.updateDayNightOverlay=function(){if(nite.map){var e=null,t=pf.uiController.playbackViewController;t.playbackActive()&&(e=new Date(1e3*t.currentTS)),nite.setDate(e),nite.refresh()}},PFCore.prototype.playSantaClauseAudio=function(){var e=pf.supportsOGGAudio(),t=pf.supportsMP3Audio();(e||t)&&(this.scAudio||(this.scAudio=new Audio(e?"/public/sfx/sc_loop.ogg":"/public/sfx/sc_loop.mp3"),this.scAudio.addEventListener("ended",function(){this.currentTime=0,this.play()},!1)),"boolean"==typeof this.scAudio.loop&&(this.scAudio.loop=!0),this.scAudio.play())},PFCore.prototype.stopSantaClauseAudio=function(){this.scAudio.pause()},PFCore.prototype.setFocusModeEnabled=function(e){(this.focusModeEnabled||(pf.previousMapCenter=pf.map.getCenter(),pf.previousMapZoom=pf.map.getZoom()),e?$("a#map_zoom_route").addClass("active"):$("a#map_zoom_route").removeClass("active"),this.focusModeEnabled=e,this.canvasOverlay.needsRedraw=!0,this.focusModeEnabled)?pf.uiController.selectedMarker().fitMapToFlightPath():(pf.map.setCenter(pf.previousMapCenter),pf.map.setZoom(pf.previousMapZoom),pf.previousMapCenter=!1,pf.previousMapZoom=!1)},PFCore.prototype.setMapType=function(e){"terrain"==e?this.map.setMapTypeId(google.maps.MapTypeId.TERRAIN):"road"==e?this.map.setMapTypeId(google.maps.MapTypeId.ROADMAP):"satellite"==e?this.map.setMapTypeId(google.maps.MapTypeId.SATELLITE):"hybrid"==e?this.map.setMapTypeId(google.maps.MapTypeId.HYBRID):"greyscale"==e?this.map.setMapTypeId("Minimal"):"routes"==e&&this.map.setMapTypeId("Routes")},PFCore.prototype.getFormattedHeading=function(e){return e+"&deg;"},PFCore.prototype.getFormattedSpeed=function(e){isNaN(e)&&(e=0);var t=pf.settings.valueForKey("speedUnit");return"mph"==t?(1.15077945*e).toFixed(0)+"mph":"kts"==t?Number(e).toFixed(0)+"kts":(1.852*e).toFixed(0)+"kph"},PFCore.prototype.getFormattedAltitude=function(e){return isNaN(e)&&(e=0),e=parseInt(e),"feet"==pf.settings.valueForKey("altitudeUnit")?e.format()+"ft":(formattedValue=(.3048*e).toFixed(0),Number(formattedValue).format()+"m")},PFCore.prototype.getFormattedDistance=function(e,t){return isNaN(e)&&(e=0),t||(t=null),"miles"==pf.settings.valueForKey("distanceUnit")?e.toFixed(t)+" miles":(formattedValue=1.609344*e,Number(formattedValue).toFixed(t)+"km")},PFCore.prototype.getFormattedHHMMTime=function(e,t){var i=t?e.getUTCHours():e.getHours();i<10&&(i="0"+i);var a=t?e.getUTCMinutes():e.getMinutes();return a<10&&(a="0"+a),i+":"+a},PFCore.prototype.getFormattedTimeDiff=function(e){var t=(new Date-new Date(1e3*e))/1e3,i=Math.floor(Math.abs(t/60/60%24));i<=9&&(i="0"+i);var a=Math.floor(Math.abs(t/60%60));return a<=9&&(a="0"+a),i+":"+a},PFCore.prototype.isBlockingAds=function(){return!$("#pfZlfqHBACxeai").length},PFCore.prototype.supportsCanvas=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},PFCore.prototype.supportsOGGAudio=function(){var e=document.createElement("audio");return!(!e.canPlayType||!e.canPlayType("audio/ogg;").replace(/no/,""))},PFCore.prototype.supportsMP3Audio=function(){var e=document.createElement("audio");return!(!e.canPlayType||!e.canPlayType("audio/mpeg;").replace(/no/,""))},PFCore.prototype.supportsHistory=function(){return!1},PFCore.prototype.unixTimestamp=function(){var e=(new Date).getTime();return Math.floor(e/1e3)},PFCore.prototype.boundsExtendedBy=function(e,t,i){var a=new google.maps.LatLngBounds(e.getSouthWest(),e.getNorthEast());if(this.canvasOverlay){var n=this.canvasOverlay.getProjection();if(n){var s=a.getNorthEast(),r=a.getSouthWest(),o=n.fromLatLngToDivPixel(s);o.x+=t,o.y-=t;var l=n.fromLatLngToDivPixel(r);l.x-=t,l.y+=t;var p=n.fromDivPixelToLatLng(o),h=n.fromDivPixelToLatLng(l);if(a.extend(p),a.extend(h),!0===i){var c=a.getNorthEast(),u=a.getSouthWest();c.lat=Math.ceil(s.lat()),c.lng=Math.ceil(s.lng()),u.lat=Math.floor(r.lat()),u.lng=Math.floor(r.lng()),a=new google.maps.LatLngBounds(new google.maps.LatLng(u.lat,u.lng),new google.maps.LatLng(c.lat,c.lng))}return a}}};